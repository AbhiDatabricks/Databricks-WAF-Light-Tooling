{
  "datasets": [
    {
      "name": "303a6758",
      "displayName": "Count of Tables",
      "queryLines": [
        "SELECT COUNT(*) FROM system.information_schema.tables;"
      ]
    },
    {
      "name": "f5bf425c",
      "displayName": "Count of Volumes",
      "queryLines": [
        "SELECT COUNT(*) FROM system.information_schema.volumes;"
      ]
    },
    {
      "name": "5fdcd556",
      "displayName": "Count of Functions",
      "queryLines": [
        "SELECT COUNT(*) FROM system.information_schema.routines;"
      ]
    },
    {
      "name": "a92ace17",
      "displayName": "Count of Unused Tables",
      "queryLines": [
        "SELECT \n",
        "  COUNT(DISTINCT CONCAT(ist.table_catalog, '.', ist.table_schema, '.', ist.table_name)) AS full_name_count\n",
        "FROM \n",
        "  system.information_schema.tables ist\n",
        "  LEFT JOIN \n",
        "    (SELECT \n",
        "       tl.source_table_catalog,\n",
        "       tl.source_table_schema,\n",
        "       tl.source_table_name\n",
        "     FROM \n",
        "       system.access.table_lineage tl\n",
        "     WHERE \n",
        "       tl.event_time BETWEEN :date_range_start AND :date_range_end\n",
        "       AND tl.source_type IN ('TABLE', 'STREAMING_TABLE')\n",
        "    ) tl\n",
        "    ON \n",
        "      tl.source_table_catalog = ist.table_catalog \n",
        "      AND tl.source_table_schema = ist.table_schema \n",
        "      AND tl.source_table_name = ist.table_name\n",
        "WHERE\n",
        "  tl.source_table_catalog IS NULL;"
      ],
      "parameters": [
        {
          "displayName": "date_range_start",
          "keyword": "date_range_start",
          "dataType": "DATETIME",
          "defaultSelection": {
            "values": {
              "dataType": "DATETIME",
              "values": [
                {
                  "value": "now-30d/d"
                }
              ]
            }
          }
        },
        {
          "displayName": "date_range_end",
          "keyword": "date_range_end",
          "dataType": "DATETIME",
          "defaultSelection": {
            "values": {
              "dataType": "DATETIME",
              "values": [
                {
                  "value": "now/s"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "55e66413",
      "displayName": "Count of Tables with Usage",
      "queryLines": [
        "SELECT \n",
        "  COUNT(DISTINCT CONCAT(source_table_catalog, '.', source_table_schema, '.', source_table_name)) AS distinct_tables\n",
        "FROM \n",
        "  system.access.table_lineage\n",
        "WHERE \n",
        "  event_time BETWEEN :date_range_start AND :date_range_end\n",
        "  AND source_table_full_name IS NOT NULL\n",
        "  AND source_type IN ('TABLE', 'STREAMING_TABLE');"
      ],
      "parameters": [
        {
          "displayName": "date_range_start",
          "keyword": "date_range_start",
          "dataType": "DATETIME",
          "defaultSelection": {
            "values": {
              "dataType": "DATETIME",
              "values": [
                {
                  "value": "now-30d/d"
                }
              ]
            }
          }
        },
        {
          "displayName": "date_range_end",
          "keyword": "date_range_end",
          "dataType": "DATETIME",
          "defaultSelection": {
            "values": {
              "dataType": "DATETIME",
              "values": [
                {
                  "value": "now/s"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "90d7e6f1",
      "displayName": "Count of Unique Users with Table Read/Write Event",
      "queryLines": [
        "SELECT \n",
        "  COUNT(DISTINCT created_by) AS distinct_users\n",
        "\n",
        "FROM \n",
        "  system.access.table_lineage AS tl\n",
        "\n",
        "WHERE \n",
        "  event_time >= :date_range_start\n",
        "  AND event_time <= :date_range_end\n",
        "  AND (source_table_full_name IS NOT NULL);"
      ],
      "parameters": [
        {
          "displayName": "date_range_start",
          "keyword": "date_range_start",
          "dataType": "DATETIME",
          "defaultSelection": {
            "values": {
              "dataType": "DATETIME",
              "values": [
                {
                  "value": "now-30d/d"
                }
              ]
            }
          }
        },
        {
          "displayName": "date_range_end",
          "keyword": "date_range_end",
          "dataType": "DATETIME",
          "defaultSelection": {
            "values": {
              "dataType": "DATETIME",
              "values": [
                {
                  "value": "now/s"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "628c2773",
      "displayName": "Count of Unsecured Tables",
      "queryLines": [
        "SELECT \n",
        "    COUNT(DISTINCT CONCAT(TABLE_CATALOG, '.', TABLE_SCHEMA, '.', TABLE_NAME)) AS full_name_count\n",
        "FROM \n",
        "    system.information_schema.table_privileges\n",
        "WHERE \n",
        "    grantee = 'account users' \n",
        "    AND privilege_type = 'SELECT';"
      ]
    },
    {
      "name": "1f951287",
      "displayName": "Count of Sensitive Tables",
      "queryLines": [
        "SELECT COUNT(DISTINCT CONCAT(table_catalog, '.', table_schema, '.', table_name)) AS distinct_table_count\n",
        "FROM (\n",
        "    SELECT \n",
        "        table_catalog, table_schema, table_name\n",
        "    FROM \n",
        "        system.information_schema.column_masks\n",
        "\n",
        "    UNION\n",
        "\n",
        "    SELECT \n",
        "        table_catalog, table_schema, table_name\n",
        "    FROM \n",
        "        system.information_schema.row_filters\n",
        ") AS combined;\n"
      ]
    },
    {
      "name": "913b3827",
      "displayName": "Pie Chart of Tagged vs. Untagged Tables",
      "queryLines": [
        "WITH tagged_count AS (\n",
        "    SELECT COUNT(*) AS count FROM system.information_schema.table_tags\n",
        ")\n",
        "SELECT 'Tagged' AS label, count \n",
        "FROM tagged_count\n",
        "UNION ALL\n",
        "SELECT 'Untagged' AS label, \n",
        "       (SELECT COUNT(*) FROM system.information_schema.tables) - count \n",
        "FROM tagged_count;"
      ]
    },
    {
      "name": "788914b8",
      "displayName": "Bar Chart of Popular Tags",
      "queryLines": [
        "SELECT \n",
        "  tag_name,\n",
        "  COUNT(*) AS usage_count\n",
        "FROM \n",
        "  system.information_schema.table_tags\n",
        "WHERE \n",
        "  tag_name IS NOT NULL\n",
        "GROUP BY \n",
        "  tag_name\n",
        "ORDER BY \n",
        "  usage_count DESC\n",
        "LIMIT 10;"
      ]
    },
    {
      "name": "8d97349c",
      "displayName": "Usage Over Last Year",
      "queryLines": [
        "SELECT \n",
        "    DATE_TRUNC('month', event_time) AS usage_date,\n",
        "    COUNT(*) AS usage_count\n",
        "FROM \n",
        "    system.access.table_lineage\n",
        "WHERE \n",
        "    (event_time >= :date_range_start AND event_time <= :date_range_end )\n",
        "GROUP BY \n",
        "    usage_date\n",
        "ORDER BY\n",
        "    usage_date;"
      ],
      "parameters": [
        {
          "displayName": "date_range_start",
          "keyword": "date_range_start",
          "dataType": "DATETIME",
          "defaultSelection": {
            "values": {
              "dataType": "DATETIME",
              "values": [
                {
                  "value": "now-12M/M"
                }
              ]
            }
          }
        },
        {
          "displayName": "date_range_end",
          "keyword": "date_range_end",
          "dataType": "DATETIME",
          "defaultSelection": {
            "values": {
              "dataType": "DATETIME",
              "values": [
                {
                  "value": "now/s"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "763a2da9",
      "displayName": "Most Popular Tables with Staleness",
      "queryLines": [
        "WITH TableReads AS (\n",
        "    SELECT\n",
        "        CONCAT(source_table_catalog, '.', source_table_schema, '.', source_table_name) AS table_full_name,\n",
        "        COUNT(*) AS read_count\n",
        "    FROM\n",
        "        system.access.table_lineage\n",
        "    WHERE\n",
        "        source_table_catalog IS NOT NULL\n",
        "        AND :date_range_start <= event_date AND event_date <= :date_range_end\n",
        "    GROUP BY\n",
        "        table_full_name\n",
        "),\n",
        "LatestTargetDate AS (\n",
        "    SELECT\n",
        "        CONCAT(target_table_catalog, '.', target_table_schema, '.', target_table_name) AS table_full_name,\n",
        "        MAX(event_date) AS latest_target_date\n",
        "    FROM\n",
        "        system.access.table_lineage\n",
        "    WHERE\n",
        "        target_table_catalog IS NOT NULL\n",
        "    GROUP BY\n",
        "        table_full_name\n",
        ")\n",
        "SELECT\n",
        "    tr.table_full_name,\n",
        "    tr.read_count,\n",
        "    COALESCE(ltd.latest_target_date, 'N/A') AS latest_target_date\n",
        "FROM\n",
        "    TableReads tr\n",
        "LEFT JOIN\n",
        "    LatestTargetDate ltd ON tr.table_full_name = ltd.table_full_name\n",
        "ORDER BY\n",
        "    tr.read_count DESC\n",
        "LIMIT 10;\n"
      ],
      "parameters": [
        {
          "displayName": "date_range_start",
          "keyword": "date_range_start",
          "dataType": "DATETIME",
          "defaultSelection": {
            "values": {
              "dataType": "DATETIME",
              "values": [
                {
                  "value": "now-30d/d"
                }
              ]
            }
          }
        },
        {
          "displayName": "date_range_end",
          "keyword": "date_range_end",
          "dataType": "DATETIME",
          "defaultSelection": {
            "values": {
              "dataType": "DATETIME",
              "values": [
                {
                  "value": "now/s"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "1eab9fe1",
      "displayName": "waf_controls_g",
      "queryLines": [
        "WITH delta_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN data_source_format IN ('DELTA', 'ICEBERG') THEN 1 ELSE 0 END) as delta_tables\n",
        "  FROM system.information_schema.tables\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "lineage_usage AS (\n",
        "  SELECT \n",
        "    COUNT(DISTINCT CONCAT(t.table_catalog, '.', t.table_schema, '.', t.table_name)) as total_tables,\n",
        "    COUNT(DISTINCT CASE WHEN tl.target_table_full_name IS NOT NULL THEN CONCAT(t.table_catalog, '.', t.table_schema, '.', t.table_name) END) as lineage_tables\n",
        "  FROM system.information_schema.tables t\n",
        "  LEFT JOIN system.access.table_lineage tl ON CONCAT(t.table_catalog, '.', t.table_schema, '.', t.table_name) = tl.target_table_full_name\n",
        "  WHERE t.table_catalog != 'hive_metastore'\n",
        "),\n",
        "metadata_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN comment IS NOT NULL THEN 1 ELSE 0 END) as tables_with_comments,\n",
        "    CASE WHEN EXISTS (SELECT 1 FROM system.information_schema.table_tags LIMIT 1) \n",
        "      THEN (SELECT COUNT(*) FROM system.information_schema.tables WHERE table_catalog != 'hive_metastore')\n",
        "      ELSE 0 \n",
        "    END as tables_with_tags\n",
        "  FROM system.information_schema.tables t\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    principle,\n",
        "    description,\n",
        "    CASE \n",
        "    WHEN waf_id = 'DG-01-03' THEN (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (lineage_tables * 100.0 / total_tables) ELSE 0 END FROM lineage_usage\n",
        "    )\n",
        "    WHEN waf_id = 'DG-01-04' THEN (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (tables_with_comments * 100.0 / total_tables) ELSE 0 END FROM metadata_usage\n",
        "    )\n",
        "    WHEN waf_id = 'DG-01-05' THEN (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (tables_with_tags * 100.0 / total_tables) ELSE 0 END FROM metadata_usage\n",
        "    )\n",
        "    WHEN waf_id = 'DG-02-01' THEN (\n",
        "      CASE WHEN EXISTS (SELECT 1 FROM system.information_schema.row_filters LIMIT 1) THEN 100 ELSE 0 END\n",
        "    )\n",
        "    WHEN waf_id = 'DG-02-02' THEN (\n",
        "      CASE WHEN EXISTS (SELECT 1 FROM system.access.audit LIMIT 1) THEN 100 ELSE 0 END\n",
        "    )\n",
        "    WHEN waf_id = 'DG-02-03' THEN (\n",
        "      CASE WHEN EXISTS (\n",
        "        SELECT 1 FROM system.information_schema.tables\n",
        "        WHERE table_catalog = 'system' AND table_schema = 'marketplace' AND table_name = 'listing_access_events'\n",
        "        LIMIT 1\n",
        "      ) THEN 100 ELSE 0 END\n",
        "    )\n",
        "    WHEN waf_id = 'DG-03-02' THEN (\n",
        "      CASE WHEN EXISTS (\n",
        "        SELECT 1 FROM system.information_schema.tables \n",
        "        WHERE table_name LIKE '%_drift_metrics' OR table_name LIKE '%_profile_metrics' \n",
        "        LIMIT 1\n",
        "      ) THEN 100 ELSE 0 END\n",
        "    )\n",
        "    WHEN waf_id = 'DG-03-03' THEN (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END FROM delta_usage\n",
        "    )\n",
        "    ELSE 0\n",
        "    END AS current_percentage,\n",
        "    CASE \n",
        "    WHEN waf_id = 'DG-01-03' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (lineage_tables * 100.0 / total_tables) ELSE 0 END FROM lineage_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-01-04' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (tables_with_comments * 100.0 / total_tables) ELSE 0 END FROM metadata_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-01-05' AND EXISTS (SELECT 1 FROM system.information_schema.table_tags LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-02-01' AND EXISTS (SELECT 1 FROM system.information_schema.row_filters LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-02-02' AND EXISTS (SELECT 1 FROM system.access.audit LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-02-03' AND EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.tables\n",
        "      WHERE table_catalog = 'system' AND table_schema = 'marketplace' AND table_name = 'listing_access_events'\n",
        "      LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-03-02' AND EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.tables \n",
        "      WHERE table_name LIKE '%_drift_metrics' OR table_name LIKE '%_profile_metrics' \n",
        "      LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-03-03' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END FROM delta_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "    END AS implemented\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('DG-01-03', 'Unify data and AI management', 'Track data and AI lineage'),\n",
        "    ('DG-01-04', 'Unify data and AI management', 'Add comments to metadata'),\n",
        "    ('DG-01-05', 'Unify data and AI management', 'Enable easy data discovery'),\n",
        "    ('DG-02-01', 'Unify data and AI security', 'Centralize access control (row/column level)'),\n",
        "    ('DG-02-02', 'Unify data and AI security', 'Configure audit logging'),\n",
        "    ('DG-02-03', 'Unify data and AI security', 'Audit data platform events'),\n",
        "    ('DG-03-02', 'Establish data quality standards', 'Use data quality tools and profiling'),\n",
        "    ('DG-03-03', 'Establish data quality standards', 'Enforce standardized data formats')\n",
        "    AS waf(waf_id, principle, description)\n",
        "  )\n",
        ")\n",
        "SELECT\n",
        "  waf_id,\n",
        "  principle,\n",
        "  description,\n",
        "  ROUND(current_percentage, 1) as score_percentage,\n",
        "  CASE \n",
        "  WHEN waf_id = 'DG-01-03' THEN 50\n",
        "  WHEN waf_id = 'DG-01-04' THEN 50\n",
        "  WHEN waf_id = 'DG-01-05' THEN 50\n",
        "  WHEN waf_id = 'DG-02-01' THEN 100\n",
        "  WHEN waf_id = 'DG-02-02' THEN 100\n",
        "  WHEN waf_id = 'DG-02-03' THEN 100\n",
        "  WHEN waf_id = 'DG-03-02' THEN 100\n",
        "  WHEN waf_id = 'DG-03-03' THEN 80\n",
        "  END as threshold_percentage,\n",
        "  CASE \n",
        "  WHEN implemented = 'Yes' THEN 'Met'\n",
        "  ELSE 'Not Met'\n",
        "  END as threshold_met,\n",
        "  implemented\n",
        "FROM waf_status\n",
        "ORDER BY principle, waf_id;\n"
      ]
    },
    {
      "name": "95258030",
      "displayName": "waf_principal_percentage_g",
      "queryLines": [
        "WITH delta_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN data_source_format IN ('DELTA', 'ICEBERG') THEN 1 ELSE 0 END) as delta_tables\n",
        "  FROM system.information_schema.tables\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "lineage_usage AS (\n",
        "  SELECT \n",
        "    COUNT(DISTINCT CONCAT(t.table_catalog, '.', t.table_schema, '.', t.table_name)) as total_tables,\n",
        "    COUNT(DISTINCT CASE WHEN tl.target_table_full_name IS NOT NULL THEN CONCAT(t.table_catalog, '.', t.table_schema, '.', t.table_name) END) as lineage_tables\n",
        "  FROM system.information_schema.tables t\n",
        "  LEFT JOIN system.access.table_lineage tl ON CONCAT(t.table_catalog, '.', t.table_schema, '.', t.table_name) = tl.target_table_full_name\n",
        "  WHERE t.table_catalog != 'hive_metastore'\n",
        "),\n",
        "metadata_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN comment IS NOT NULL THEN 1 ELSE 0 END) as tables_with_comments,\n",
        "    CASE WHEN EXISTS (SELECT 1 FROM system.information_schema.table_tags LIMIT 1) \n",
        "      THEN (SELECT COUNT(*) FROM system.information_schema.tables WHERE table_catalog != 'hive_metastore')\n",
        "      ELSE 0 \n",
        "    END as tables_with_tags\n",
        "  FROM system.information_schema.tables t\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    principle,\n",
        "    CASE \n",
        "    WHEN waf_id = 'DG-01-03' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (lineage_tables * 100.0 / total_tables) ELSE 0 END FROM lineage_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-01-04' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (tables_with_comments * 100.0 / total_tables) ELSE 0 END FROM metadata_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-01-05' AND EXISTS (SELECT 1 FROM system.information_schema.table_tags LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-02-01' AND EXISTS (SELECT 1 FROM system.information_schema.row_filters LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-02-02' AND EXISTS (SELECT 1 FROM system.access.audit LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-02-03' AND EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.tables\n",
        "      WHERE table_catalog = 'system' AND table_schema = 'marketplace' AND table_name = 'listing_access_events'\n",
        "      LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-03-02' AND EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.tables \n",
        "      WHERE table_name LIKE '%_drift_metrics' OR table_name LIKE '%_profile_metrics' \n",
        "      LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-03-03' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END FROM delta_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "    END AS implemented\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('DG-01-03', 'Unify data and AI management'),\n",
        "    ('DG-01-04', 'Unify data and AI management'),\n",
        "    ('DG-01-05', 'Unify data and AI management'),\n",
        "    ('DG-02-01', 'Unify data and AI security'),\n",
        "    ('DG-02-02', 'Unify data and AI security'),\n",
        "    ('DG-02-03', 'Unify data and AI security'),\n",
        "    ('DG-03-02', 'Establish data quality standards'),\n",
        "    ('DG-03-03', 'Establish data quality standards')\n",
        "    AS waf(waf_id, principle)\n",
        "  )\n",
        ")\n",
        "SELECT\n",
        "  principle,\n",
        "  COUNT(*) AS total_controls,\n",
        "  SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) AS implemented_controls,\n",
        "  ROUND(100 * SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) / COUNT(*), 0) AS completion_percent\n",
        "FROM waf_status\n",
        "GROUP BY principle\n",
        "ORDER BY principle;\n"
      ]
    },
    {
      "name": "920a8759",
      "displayName": "total_percentage_g",
      "queryLines": [
        "WITH delta_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN data_source_format IN ('DELTA', 'ICEBERG') THEN 1 ELSE 0 END) as delta_tables\n",
        "  FROM system.information_schema.tables\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "lineage_usage AS (\n",
        "  SELECT \n",
        "    COUNT(DISTINCT CONCAT(t.table_catalog, '.', t.table_schema, '.', t.table_name)) as total_tables,\n",
        "    COUNT(DISTINCT CASE WHEN tl.target_table_full_name IS NOT NULL THEN CONCAT(t.table_catalog, '.', t.table_schema, '.', t.table_name) END) as lineage_tables\n",
        "  FROM system.information_schema.tables t\n",
        "  LEFT JOIN system.access.table_lineage tl ON CONCAT(t.table_catalog, '.', t.table_schema, '.', t.table_name) = tl.target_table_full_name\n",
        "  WHERE t.table_catalog != 'hive_metastore'\n",
        "),\n",
        "metadata_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN comment IS NOT NULL THEN 1 ELSE 0 END) as tables_with_comments,\n",
        "    CASE WHEN EXISTS (SELECT 1 FROM system.information_schema.table_tags LIMIT 1) \n",
        "      THEN (SELECT COUNT(*) FROM system.information_schema.tables WHERE table_catalog != 'hive_metastore')\n",
        "      ELSE 0 \n",
        "    END as tables_with_tags\n",
        "  FROM system.information_schema.tables t\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    CASE \n",
        "    -- DG-01-03: >50% of tables have lineage tracked\n",
        "    WHEN waf_id = 'DG-01-03' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (lineage_tables * 100.0 / total_tables) ELSE 0 END FROM lineage_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    -- DG-01-04: >50% of tables have comments\n",
        "    WHEN waf_id = 'DG-01-04' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (tables_with_comments * 100.0 / total_tables) ELSE 0 END FROM metadata_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    -- DG-01-05: >50% of tables have tags\n",
        "    WHEN waf_id = 'DG-01-05' AND EXISTS (SELECT 1 FROM system.information_schema.table_tags LIMIT 1) THEN 'Yes'\n",
        "    -- DG-02-01: Row filters exist\n",
        "    WHEN waf_id = 'DG-02-01' AND EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.row_filters LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    -- DG-02-02: Audit logging exists\n",
        "    WHEN waf_id = 'DG-02-02' AND EXISTS (\n",
        "      SELECT 1 FROM system.access.audit LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    -- DG-02-03: Marketplace audit events exist\n",
        "    WHEN waf_id = 'DG-02-03' AND EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.tables\n",
        "      WHERE table_catalog = 'system' AND table_schema = 'marketplace' AND table_name = 'listing_access_events'\n",
        "      LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    -- DG-03-02: Data quality tools exist\n",
        "    WHEN waf_id = 'DG-03-02' AND EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.tables \n",
        "      WHERE table_name LIKE '%_drift_metrics' OR table_name LIKE '%_profile_metrics' \n",
        "      LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    -- DG-03-03: >80% of tables use Delta/ICEBERG format\n",
        "    WHEN waf_id = 'DG-03-03' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END FROM delta_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "    END AS implemented\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('DG-01-03'), ('DG-01-04'), ('DG-01-05'),\n",
        "    ('DG-02-01'), ('DG-02-02'), ('DG-02-03'),\n",
        "    ('DG-03-02'), ('DG-03-03')\n",
        "    AS waf(waf_id)\n",
        "  )\n",
        ")\n",
        "SELECT\n",
        "  COUNT(*) AS total_controls,\n",
        "  SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) AS implemented_controls,\n",
        "  ROUND(100 * SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) / COUNT(*), 0) AS completion_percent\n",
        "FROM waf_status;\n"
      ]
    },
    {
      "name": "b39d7f91",
      "displayName": "total_percentage_across_pillars",
      "queryLines": [
        "WITH delta_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN data_source_format IN ('DELTA', 'ICEBERG') THEN 1 ELSE 0 END) as delta_tables\n",
        "  FROM system.information_schema.tables\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "lineage_usage AS (\n",
        "  SELECT \n",
        "    COUNT(DISTINCT CONCAT(t.table_catalog, '.', t.table_schema, '.', t.table_name)) as total_tables,\n",
        "    COUNT(DISTINCT CASE WHEN tl.target_table_full_name IS NOT NULL THEN CONCAT(t.table_catalog, '.', t.table_schema, '.', t.table_name) END) as lineage_tables\n",
        "  FROM system.information_schema.tables t\n",
        "  LEFT JOIN system.access.table_lineage tl ON CONCAT(t.table_catalog, '.', t.table_schema, '.', t.table_name) = tl.target_table_full_name\n",
        "  WHERE t.table_catalog != 'hive_metastore'\n",
        "),\n",
        "metadata_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN comment IS NOT NULL THEN 1 ELSE 0 END) as tables_with_comments,\n",
        "    CASE WHEN EXISTS (SELECT 1 FROM system.information_schema.table_tags LIMIT 1) \n",
        "      THEN (SELECT COUNT(*) FROM system.information_schema.tables WHERE table_catalog != 'hive_metastore')\n",
        "      ELSE 0 \n",
        "    END as tables_with_tags\n",
        "  FROM system.information_schema.tables t\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "serverless_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SERVERLESS%' OR sku_name LIKE '%SERVERLESS%' THEN 1 ELSE 0 END) as serverless_count\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "photon_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN product_features.is_photon = true THEN 1 ELSE 0 END) as photon_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "sql_warehouse_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SQL%' THEN 1 ELSE 0 END) as sql_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "cluster_policies AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN policy_id IS NOT NULL THEN 1 ELSE 0 END) as clusters_with_policy\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "cluster_tags AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN size(map_keys(tags)) > 0 THEN 1 ELSE 0 END) as clusters_with_tags\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "cluster_workers AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN worker_count > 1 THEN 1 ELSE 0 END) as clusters_multi_worker,\n",
        "    SUM(CASE WHEN worker_count > 3 THEN 1 ELSE 0 END) as clusters_large\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "instance_variety AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    COUNT(DISTINCT split(worker_node_type,'[.]')[0]) as distinct_families\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "dlt_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute_usage,\n",
        "    SUM(CASE WHEN billing_origin_product = 'DLT' THEN 1 ELSE 0 END) as dlt_compute_usage\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "model_serving_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_ml_compute,\n",
        "    SUM(CASE WHEN billing_origin_product = 'MODEL_SERVING' THEN 1 ELSE 0 END) as serving_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND (usage_type LIKE '%COMPUTE%' OR billing_origin_product = 'MODEL_SERVING')\n",
        "),\n",
        "autoscale_clusters AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN ifnull(max_autoscale_Workers, 0) > 0 THEN 1 ELSE 0 END) as autoscale_clusters\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "autoscale_warehouses AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_warehouses,\n",
        "    SUM(CASE WHEN max_clusters - min_clusters > 0 THEN 1 ELSE 0 END) as autoscale_warehouses\n",
        "  FROM system.compute.warehouses\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    CASE \n",
        "    -- Governance (DG)\n",
        "    WHEN waf_id = 'DG-01-03' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (lineage_tables * 100.0 / total_tables) ELSE 0 END FROM lineage_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-01-04' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (tables_with_comments * 100.0 / total_tables) ELSE 0 END FROM metadata_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-01-05' AND EXISTS (SELECT 1 FROM system.information_schema.table_tags LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-02-01' AND EXISTS (SELECT 1 FROM system.information_schema.row_filters LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-02-02' AND EXISTS (SELECT 1 FROM system.access.audit LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-02-03' AND EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.tables\n",
        "      WHERE table_catalog = 'system' AND table_schema = 'marketplace' AND table_name = 'listing_access_events'\n",
        "      LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-03-02' AND EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.tables \n",
        "      WHERE table_name LIKE '%_drift_metrics' OR table_name LIKE '%_profile_metrics' \n",
        "      LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'DG-03-03' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END FROM delta_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    -- Cost (CO)\n",
        "    WHEN waf_id = 'CO-01-01' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END FROM delta_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-01-03' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (sql_compute * 100.0 / total_compute) ELSE 0 END FROM sql_warehouse_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-01-04' AND EXISTS (SELECT 1 FROM system.compute.clusters WHERE dbr_version IS NOT NULL LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-01-06' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-01-09' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (photon_compute * 100.0 / total_compute) ELSE 0 END FROM photon_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-02-03' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_with_policy * 100.0 / total_clusters) ELSE 0 END FROM cluster_policies\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-03-01' AND EXISTS (SELECT 1 FROM system.billing.usage LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-03-02' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_with_tags * 100.0 / total_clusters) ELSE 0 END FROM cluster_tags\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-03-03' AND EXISTS (SELECT 1 FROM system.billing.usage LIMIT 1) THEN 'Yes'\n",
        "    -- Performance (PE)\n",
        "    WHEN waf_id = 'PE-01-01' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-01-02' AND EXISTS (\n",
        "      SELECT 1 FROM system.billing.usage WHERE sku_name LIKE '%SERVERLESS_REAL_TIME_INFERENCE%' LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-02' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_multi_worker * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-04' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_large * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-05' AND NOT EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.routines WHERE external_language = 'Python' LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-06' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (photon_compute * 100.0 / total_compute) ELSE 0 END FROM photon_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-07' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (distinct_families * 100.0 / total_clusters) ELSE 0 END FROM instance_variety\n",
        "    ) >= 5 THEN 'Yes'\n",
        "    -- Reliability (R)\n",
        "    WHEN waf_id = 'R-01-01' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END FROM delta_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-01-03' AND (\n",
        "      SELECT CASE WHEN total_compute_usage > 0 THEN (dlt_compute_usage * 100.0 / total_compute_usage) ELSE 0 END FROM dlt_usage\n",
        "    ) >= 30 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-01-05' AND (\n",
        "      SELECT CASE WHEN total_ml_compute > 0 THEN (serving_compute * 100.0 / total_ml_compute) ELSE 0 END FROM model_serving_usage\n",
        "    ) >= 20 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-01-06' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-02-03' AND EXISTS (SELECT 1 FROM system.information_schema.metastores LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'R-02-04' AND (\n",
        "      SELECT CASE WHEN total_compute_usage > 0 THEN (dlt_compute_usage * 100.0 / total_compute_usage) ELSE 0 END FROM dlt_usage\n",
        "    ) >= 30 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-03-01' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (autoscale_clusters * 100.0 / total_clusters) ELSE 0 END FROM autoscale_clusters\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-03-02' AND (\n",
        "      SELECT CASE WHEN total_warehouses > 0 THEN (autoscale_warehouses * 100.0 / total_warehouses) ELSE 0 END FROM autoscale_warehouses\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "    END AS implemented,\n",
        "    CASE \n",
        "    WHEN waf_id LIKE 'DG-%' THEN 'Data & AI Governance'\n",
        "    WHEN waf_id LIKE 'CO-%' THEN 'Cost Optimization'\n",
        "    WHEN waf_id LIKE 'PE-%' THEN 'Performance Efficiency'\n",
        "    WHEN waf_id LIKE 'R-%'  THEN 'Reliability'\n",
        "    END AS pillar\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('DG-01-03'), ('DG-01-04'), ('DG-01-05'),\n",
        "    ('DG-02-01'), ('DG-02-02'), ('DG-02-03'),\n",
        "    ('DG-03-02'), ('DG-03-03'),\n",
        "    ('CO-01-01'), ('CO-01-03'), ('CO-01-04'), ('CO-01-06'), ('CO-01-09'),\n",
        "    ('CO-02-03'), ('CO-03-01'), ('CO-03-02'), ('CO-03-03'),\n",
        "    ('PE-01-01'), ('PE-01-02'),\n",
        "    ('PE-02-02'), ('PE-02-04'), ('PE-02-05'), ('PE-02-06'), ('PE-02-07'),\n",
        "    ('R-01-01'), ('R-01-03'), ('R-01-05'), ('R-01-06'),\n",
        "    ('R-02-03'), ('R-02-04'),\n",
        "    ('R-03-01'), ('R-03-02')\n",
        "    AS waf(waf_id)\n",
        "  )\n",
        ")\n",
        "SELECT\n",
        "  pillar,\n",
        "  COUNT(*) AS total_controls,\n",
        "  SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) AS implemented_controls,\n",
        "  ROUND(100 * SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) / COUNT(*), 0) AS completion_percent\n",
        "FROM waf_status\n",
        "GROUP BY pillar\n",
        "ORDER BY pillar;\n"
      ]
    },
    {
      "name": "dbdc9433",
      "displayName": "waf_controls_c",
      "queryLines": [
        "WITH delta_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN data_source_format IN ('DELTA', 'ICEBERG') THEN 1 ELSE 0 END) as delta_tables\n",
        "  FROM system.information_schema.tables\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "serverless_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SERVERLESS%' OR sku_name LIKE '%SERVERLESS%' THEN 1 ELSE 0 END) as serverless_count\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "photon_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN product_features.is_photon = true THEN 1 ELSE 0 END) as photon_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "sql_warehouse_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SQL%' THEN 1 ELSE 0 END) as sql_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "cluster_policies AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN policy_id IS NOT NULL THEN 1 ELSE 0 END) as clusters_with_policy\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "cluster_tags AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN size(map_keys(tags)) > 0 THEN 1 ELSE 0 END) as clusters_with_tags\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    principle,\n",
        "    best_practice,\n",
        "    CASE \n",
        "    WHEN waf_id = 'CO-01-01' THEN (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END FROM delta_usage\n",
        "    )\n",
        "    WHEN waf_id = 'CO-01-03' THEN (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (sql_compute * 100.0 / total_compute) ELSE 0 END FROM sql_warehouse_usage\n",
        "    )\n",
        "    WHEN waf_id = 'CO-01-04' THEN (\n",
        "      CASE WHEN EXISTS (SELECT 1 FROM system.compute.clusters WHERE dbr_version IS NOT NULL LIMIT 1) THEN 100 ELSE 0 END\n",
        "    )\n",
        "    WHEN waf_id = 'CO-01-06' THEN (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    )\n",
        "    WHEN waf_id = 'CO-01-09' THEN (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (photon_compute * 100.0 / total_compute) ELSE 0 END FROM photon_usage\n",
        "    )\n",
        "    WHEN waf_id = 'CO-02-03' THEN (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_with_policy * 100.0 / total_clusters) ELSE 0 END FROM cluster_policies\n",
        "    )\n",
        "    WHEN waf_id = 'CO-03-01' THEN (\n",
        "      CASE WHEN EXISTS (SELECT 1 FROM system.billing.usage LIMIT 1) THEN 100 ELSE 0 END\n",
        "    )\n",
        "    WHEN waf_id = 'CO-03-02' THEN (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_with_tags * 100.0 / total_clusters) ELSE 0 END FROM cluster_tags\n",
        "    )\n",
        "    WHEN waf_id = 'CO-03-03' THEN (\n",
        "      CASE WHEN EXISTS (SELECT 1 FROM system.billing.usage LIMIT 1) THEN 100 ELSE 0 END\n",
        "    )\n",
        "    ELSE 0\n",
        "    END AS current_percentage,\n",
        "    CASE \n",
        "    WHEN waf_id = 'CO-01-01' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END FROM delta_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-01-03' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (sql_compute * 100.0 / total_compute) ELSE 0 END FROM sql_warehouse_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-01-04' AND EXISTS (SELECT 1 FROM system.compute.clusters WHERE dbr_version IS NOT NULL LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-01-06' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-01-09' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (photon_compute * 100.0 / total_compute) ELSE 0 END FROM photon_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-02-03' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_with_policy * 100.0 / total_clusters) ELSE 0 END FROM cluster_policies\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-03-01' AND EXISTS (SELECT 1 FROM system.billing.usage LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-03-02' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_with_tags * 100.0 / total_clusters) ELSE 0 END FROM cluster_tags\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-03-03' AND EXISTS (SELECT 1 FROM system.billing.usage LIMIT 1) THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "    END AS implemented\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('CO-01-01', 'Choose optimal resources', 'Use performance optimized data formats'),\n",
        "    ('CO-01-03', 'Choose optimal resources', 'Use SQL warehouse for SQL workloads'),\n",
        "    ('CO-01-04', 'Choose optimal resources', 'Use up-to-date runtimes'),\n",
        "    ('CO-01-06', 'Choose optimal resources', 'Use Serverless for your workloads'),\n",
        "    ('CO-01-09', 'Choose optimal resources', 'Evaluate performance optimized query engines'),\n",
        "    ('CO-02-03', 'Dynamically allocate resources', 'Use compute policies to control costs'),\n",
        "    ('CO-03-01', 'Monitor and control cost', 'Monitor costs'),\n",
        "    ('CO-03-02', 'Monitor and control cost', 'Tag clusters for cost attribution'),\n",
        "    ('CO-03-03', 'Monitor and control cost', 'Implement observability to track & chargeback cost')\n",
        "    AS waf(waf_id, principle, best_practice)\n",
        "  )\n",
        ")\n",
        "SELECT\n",
        "  waf_id,\n",
        "  principle,\n",
        "  best_practice,\n",
        "  ROUND(current_percentage, 1) as score_percentage,\n",
        "  CASE \n",
        "  WHEN waf_id = 'CO-01-01' THEN 80\n",
        "  WHEN waf_id = 'CO-01-03' THEN 50\n",
        "  WHEN waf_id = 'CO-01-04' THEN 100\n",
        "  WHEN waf_id = 'CO-01-06' THEN 50\n",
        "  WHEN waf_id = 'CO-01-09' THEN 80\n",
        "  WHEN waf_id = 'CO-02-03' THEN 80\n",
        "  WHEN waf_id = 'CO-03-01' THEN 100\n",
        "  WHEN waf_id = 'CO-03-02' THEN 80\n",
        "  WHEN waf_id = 'CO-03-03' THEN 100\n",
        "  END as threshold_percentage,\n",
        "  CASE \n",
        "  WHEN implemented = 'Yes' THEN 'Met'\n",
        "  ELSE 'Not Met'\n",
        "  END as threshold_met,\n",
        "  implemented\n",
        "FROM waf_status\n",
        "ORDER BY principle, waf_id;\n"
      ]
    },
    {
      "name": "81f0a6aa",
      "displayName": "waf_principal_percentage_c",
      "queryLines": [
        "WITH delta_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN data_source_format IN ('DELTA', 'ICEBERG') THEN 1 ELSE 0 END) as delta_tables\n",
        "  FROM system.information_schema.tables\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "serverless_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SERVERLESS%' OR sku_name LIKE '%SERVERLESS%' THEN 1 ELSE 0 END) as serverless_count\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "photon_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN product_features.is_photon = true THEN 1 ELSE 0 END) as photon_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "sql_warehouse_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SQL%' THEN 1 ELSE 0 END) as sql_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "cluster_policies AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN policy_id IS NOT NULL THEN 1 ELSE 0 END) as clusters_with_policy\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "cluster_tags AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN size(map_keys(tags)) > 0 THEN 1 ELSE 0 END) as clusters_with_tags\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    principle,\n",
        "    CASE \n",
        "    WHEN waf_id = 'CO-01-01' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END FROM delta_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-01-03' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (sql_compute * 100.0 / total_compute) ELSE 0 END FROM sql_warehouse_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-01-04' AND EXISTS (SELECT 1 FROM system.compute.clusters WHERE dbr_version IS NOT NULL LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-01-06' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-01-09' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (photon_compute * 100.0 / total_compute) ELSE 0 END FROM photon_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-02-03' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_with_policy * 100.0 / total_clusters) ELSE 0 END FROM cluster_policies\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-03-01' AND EXISTS (SELECT 1 FROM system.billing.usage LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-03-02' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_with_tags * 100.0 / total_clusters) ELSE 0 END FROM cluster_tags\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'CO-03-03' AND EXISTS (SELECT 1 FROM system.billing.usage LIMIT 1) THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "    END AS implemented\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('CO-01-01', 'Choose optimal resources'),\n",
        "    ('CO-01-03', 'Choose optimal resources'),\n",
        "    ('CO-01-04', 'Choose optimal resources'),\n",
        "    ('CO-01-06', 'Choose optimal resources'),\n",
        "    ('CO-01-09', 'Choose optimal resources'),\n",
        "    ('CO-02-03', 'Dynamically allocate resources'),\n",
        "    ('CO-03-01', 'Monitor and control cost'),\n",
        "    ('CO-03-02', 'Monitor and control cost'),\n",
        "    ('CO-03-03', 'Monitor and control cost')\n",
        "    AS waf(waf_id, principle)\n",
        "  )\n",
        ")\n",
        "SELECT\n",
        "  principle,\n",
        "  COUNT(*) AS total_controls,\n",
        "  SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) AS implemented_controls,\n",
        "  ROUND(100 * SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) / COUNT(*), 0) AS completion_percent\n",
        "FROM waf_status\n",
        "GROUP BY principle\n",
        "ORDER BY principle;\n"
      ]
    },
    {
      "name": "06f2987c",
      "displayName": "total_percentage_c",
      "queryLines": [
        "WITH delta_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN data_source_format IN ('DELTA', 'ICEBERG') THEN 1 ELSE 0 END) as delta_tables\n",
        "  FROM system.information_schema.tables\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "serverless_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SERVERLESS%' OR sku_name LIKE '%SERVERLESS%' THEN 1 ELSE 0 END) as serverless_count\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "photon_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN product_features.is_photon = true THEN 1 ELSE 0 END) as photon_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "sql_warehouse_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SQL%' THEN 1 ELSE 0 END) as sql_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "cluster_policies AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN policy_id IS NOT NULL THEN 1 ELSE 0 END) as clusters_with_policy\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "cluster_tags AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN size(map_keys(tags)) > 0 THEN 1 ELSE 0 END) as clusters_with_tags\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    CASE \n",
        "    -- CO-01-01: >80% of tables use Delta/ICEBERG format\n",
        "    WHEN waf_id = 'CO-01-01' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END FROM delta_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    -- CO-01-03: >50% of compute is SQL warehouse\n",
        "    WHEN waf_id = 'CO-01-03' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (sql_compute * 100.0 / total_compute) ELSE 0 END FROM sql_warehouse_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    -- CO-01-04: All clusters have DBR version\n",
        "    WHEN waf_id = 'CO-01-04' AND EXISTS (\n",
        "      SELECT 1 FROM system.compute.clusters WHERE dbr_version IS NOT NULL LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    -- CO-01-06: >50% of compute is serverless\n",
        "    WHEN waf_id = 'CO-01-06' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    -- CO-01-09: >80% of queries use Photon\n",
        "    WHEN waf_id = 'CO-01-09' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (photon_compute * 100.0 / total_compute) ELSE 0 END FROM photon_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    -- CO-02-03: >80% of clusters have compute policies\n",
        "    WHEN waf_id = 'CO-02-03' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_with_policy * 100.0 / total_clusters) ELSE 0 END FROM cluster_policies\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    -- CO-03-01: Cost monitoring exists\n",
        "    WHEN waf_id = 'CO-03-01' AND EXISTS (\n",
        "      SELECT 1 FROM system.billing.usage LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    -- CO-03-02: >80% of clusters have tags\n",
        "    WHEN waf_id = 'CO-03-02' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_with_tags * 100.0 / total_clusters) ELSE 0 END FROM cluster_tags\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    -- CO-03-03: Observability exists\n",
        "    WHEN waf_id = 'CO-03-03' AND EXISTS (\n",
        "      SELECT 1 FROM system.billing.usage LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "    END AS implemented\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('CO-01-01'), ('CO-01-03'), ('CO-01-04'), ('CO-01-06'), ('CO-01-09'),\n",
        "    ('CO-02-03'), ('CO-03-01'), ('CO-03-02'), ('CO-03-03')\n",
        "    AS waf(waf_id)\n",
        "  )\n",
        ")\n",
        "SELECT\n",
        "  COUNT(*) AS total_controls,\n",
        "  SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) AS implemented_controls,\n",
        "  ROUND(100 * SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) / COUNT(*), 0) AS completion_percent\n",
        "FROM waf_status;\n"
      ]
    },
    {
      "name": "4745a0f9",
      "displayName": "waf_controls_p_old",
      "queryLines": [
        "WITH serverless_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SERVERLESS%' OR sku_name LIKE '%SERVERLESS%' THEN 1 ELSE 0 END) as serverless_count\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "photon_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN product_features.is_photon = true THEN 1 ELSE 0 END) as photon_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "cluster_workers AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN worker_count > 1 THEN 1 ELSE 0 END) as clusters_multi_worker,\n",
        "    SUM(CASE WHEN worker_count > 3 THEN 1 ELSE 0 END) as clusters_large\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "instance_variety AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    COUNT(DISTINCT split(worker_node_type,'[.]')[0]) as distinct_families\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    principle,\n",
        "    best_practice,\n",
        "    CASE \n",
        "    WHEN waf_id = 'PE-01-01' THEN (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    )\n",
        "    WHEN waf_id = 'PE-01-02' THEN (\n",
        "      CASE WHEN EXISTS (SELECT 1 FROM system.billing.usage WHERE sku_name LIKE '%SERVERLESS_REAL_TIME_INFERENCE%' LIMIT 1) THEN 100 ELSE 0 END\n",
        "    )\n",
        "    WHEN waf_id = 'PE-02-02' THEN (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_multi_worker * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    )\n",
        "    WHEN waf_id = 'PE-02-04' THEN (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_large * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    )\n",
        "    WHEN waf_id = 'PE-02-05' THEN (\n",
        "      CASE WHEN NOT EXISTS (SELECT 1 FROM system.information_schema.routines WHERE external_language = 'Python' LIMIT 1) THEN 100 ELSE 0 END\n",
        "    )\n",
        "    WHEN waf_id = 'PE-02-06' THEN (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (photon_compute * 100.0 / total_compute) ELSE 0 END FROM photon_usage\n",
        "    )\n",
        "    WHEN waf_id = 'PE-02-07' THEN (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (distinct_families * 100.0 / total_clusters) ELSE 0 END FROM instance_variety\n",
        "    )\n",
        "    ELSE 0\n",
        "    END AS current_percentage,\n",
        "    CASE \n",
        "    WHEN waf_id = 'PE-01-01' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-01-02' AND EXISTS (\n",
        "      SELECT 1 FROM system.billing.usage WHERE sku_name LIKE '%SERVERLESS_REAL_TIME_INFERENCE%' LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-02' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_multi_worker * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-04' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_large * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-05' AND NOT EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.routines WHERE external_language = 'Python' LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-06' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (photon_compute * 100.0 / total_compute) ELSE 0 END FROM photon_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-07' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (distinct_families * 100.0 / total_clusters) ELSE 0 END FROM instance_variety\n",
        "    ) >= 5 THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "    END AS implemented\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('PE-01-01', 'Utilize serverless capabilities', 'Use serverless architecture'),\n",
        "    ('PE-01-02', 'Utilize serverless capabilities', 'Use an enterprise grade model serving service'),\n",
        "    ('PE-02-02', 'Design workloads for performance', 'Use parallel computation where it is beneficial'),\n",
        "    ('PE-02-04', 'Design workloads for performance', 'Prefer larger clusters'),\n",
        "    ('PE-02-05', 'Design workloads for performance', 'Use native Spark operations'),\n",
        "    ('PE-02-06', 'Design workloads for performance', 'Use native platform engines'),\n",
        "    ('PE-02-07', 'Design workloads for performance', 'Understand your hardware and workload type')\n",
        "    AS waf(waf_id, principle, best_practice)\n",
        "  )\n",
        ")\n",
        "SELECT\n",
        "  waf_id,\n",
        "  principle,\n",
        "  best_practice,\n",
        "  ROUND(current_percentage, 1) as score_percentage,\n",
        "  CASE \n",
        "  WHEN waf_id = 'PE-01-01' THEN 50\n",
        "  WHEN waf_id = 'PE-01-02' THEN 100\n",
        "  WHEN waf_id = 'PE-02-02' THEN 80\n",
        "  WHEN waf_id = 'PE-02-04' THEN 50\n",
        "  WHEN waf_id = 'PE-02-05' THEN 100\n",
        "  WHEN waf_id = 'PE-02-06' THEN 80\n",
        "  WHEN waf_id = 'PE-02-07' THEN 5\n",
        "  END as threshold_percentage,\n",
        "  CASE \n",
        "  WHEN implemented = 'Yes' THEN 'Met'\n",
        "  ELSE 'Not Met'\n",
        "  END as threshold_met,\n",
        "  implemented\n",
        "FROM waf_status\n",
        "ORDER BY principle, waf_id;\n"
      ]
    },
    {
      "name": "13e29e6c",
      "displayName": "waf_principal_percentage_p",
      "queryLines": [
        "WITH serverless_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SERVERLESS%' OR sku_name LIKE '%SERVERLESS%' THEN 1 ELSE 0 END) as serverless_count\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "photon_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN product_features.is_photon = true THEN 1 ELSE 0 END) as photon_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "cluster_workers AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN worker_count > 1 THEN 1 ELSE 0 END) as clusters_multi_worker,\n",
        "    SUM(CASE WHEN worker_count > 3 THEN 1 ELSE 0 END) as clusters_large\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "instance_variety AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    COUNT(DISTINCT split(worker_node_type,'[.]')[0]) as distinct_families\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    principle,\n",
        "    CASE \n",
        "    WHEN waf_id = 'PE-01-01' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-01-02' AND EXISTS (\n",
        "      SELECT 1 FROM system.billing.usage WHERE sku_name LIKE '%SERVERLESS_REAL_TIME_INFERENCE%' LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-02' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_multi_worker * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-04' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_large * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-05' AND NOT EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.routines WHERE external_language = 'Python' LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-06' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (photon_compute * 100.0 / total_compute) ELSE 0 END FROM photon_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-07' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (distinct_families * 100.0 / total_clusters) ELSE 0 END FROM instance_variety\n",
        "    ) >= 5 THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "    END AS implemented\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('PE-01-01', 'Utilize serverless capabilities'),\n",
        "    ('PE-01-02', 'Utilize serverless capabilities'),\n",
        "    ('PE-02-02', 'Design workloads for performance'),\n",
        "    ('PE-02-04', 'Design workloads for performance'),\n",
        "    ('PE-02-05', 'Design workloads for performance'),\n",
        "    ('PE-02-06', 'Design workloads for performance'),\n",
        "    ('PE-02-07', 'Design workloads for performance')\n",
        "    AS waf(waf_id, principle)\n",
        "  )\n",
        ")\n",
        "SELECT\n",
        "  principle,\n",
        "  COUNT(*) AS total_controls,\n",
        "  SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) AS implemented_controls,\n",
        "  ROUND(100 * SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) / COUNT(*), 0) AS completion_percent\n",
        "FROM waf_status\n",
        "GROUP BY principle\n",
        "ORDER BY principle;\n"
      ]
    },
    {
      "name": "87deca0d",
      "displayName": "total_percentage_p",
      "queryLines": [
        "WITH serverless_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SERVERLESS%' OR sku_name LIKE '%SERVERLESS%' THEN 1 ELSE 0 END) as serverless_count\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "photon_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN product_features.is_photon = true THEN 1 ELSE 0 END) as photon_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "cluster_workers AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN worker_count > 1 THEN 1 ELSE 0 END) as clusters_multi_worker,\n",
        "    SUM(CASE WHEN worker_count > 3 THEN 1 ELSE 0 END) as clusters_large\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "instance_variety AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    COUNT(DISTINCT split(worker_node_type,'[.]')[0]) as distinct_families\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    CASE \n",
        "    -- PE-01-01: >50% of compute is serverless\n",
        "    WHEN waf_id = 'PE-01-01' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    -- PE-01-02: Model serving exists\n",
        "    WHEN waf_id = 'PE-01-02' AND EXISTS (\n",
        "      SELECT 1 FROM system.billing.usage WHERE sku_name LIKE '%SERVERLESS_REAL_TIME_INFERENCE%' LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    -- PE-02-02: >80% of clusters have multiple workers\n",
        "    WHEN waf_id = 'PE-02-02' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_multi_worker * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    -- PE-02-04: >50% of clusters are large (>3 workers)\n",
        "    WHEN waf_id = 'PE-02-04' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_large * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    -- PE-02-05: No Python UDFs\n",
        "    WHEN waf_id = 'PE-02-05' AND NOT EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.routines WHERE external_language = 'Python' LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    -- PE-02-06: >80% of queries use Photon\n",
        "    WHEN waf_id = 'PE-02-06' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (photon_compute * 100.0 / total_compute) ELSE 0 END FROM photon_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    -- PE-02-07: >5% instance variety\n",
        "    WHEN waf_id = 'PE-02-07' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (distinct_families * 100.0 / total_clusters) ELSE 0 END FROM instance_variety\n",
        "    ) >= 5 THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "    END AS implemented\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('PE-01-01'), ('PE-01-02'),\n",
        "    ('PE-02-02'), ('PE-02-04'), ('PE-02-05'), ('PE-02-06'), ('PE-02-07')\n",
        "    AS waf(waf_id)\n",
        "  )\n",
        ")\n",
        "SELECT\n",
        "  COUNT(*) AS total_controls,\n",
        "  SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) AS implemented_controls,\n",
        "  ROUND(100 * SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) / COUNT(*), 0) AS completion_percent\n",
        "FROM waf_status;\n"
      ]
    },
    {
      "name": "a5da7a83",
      "displayName": "waf_CO-01-01_vector_db",
      "queryLines": [
        "select 'Coming Soon...'  as message;"
      ]
    },
    {
      "name": "c436a496",
      "displayName": "waf_CO-01-01_managed_tables",
      "queryLines": [
        "SELECT \n",
        "    table_type,\n",
        "    round(count(table_type)/(select count(*) from system.information_schema.tables) * 100) as percent_of_tables\n",
        "    FROM system.information_schema.tables\n",
        "    group by ALL\n",
        "    having percent_of_tables > 0\n",
        "    order by percent_of_tables desc"
      ]
    },
    {
      "name": "feca6b37",
      "displayName": "waf_CO-01-02_jobs_on_all_purpose",
      "queryLines": [
        "with clusters AS (\n",
        "  SELECT\n",
        "    *,\n",
        "    ROW_NUMBER() OVER(PARTITION BY workspace_id, cluster_id ORDER BY change_time DESC) as rn\n",
        "  FROM system.compute.clusters\n",
        "  WHERE cluster_source=\"UI\" OR cluster_source=\"API\"\n",
        "  QUALIFY rn=1\n",
        "),\n",
        "job_tasks_exploded AS (\n",
        "  SELECT\n",
        "    workspace_id,\n",
        "    job_id,\n",
        "    EXPLODE(compute_ids) as cluster_id\n",
        "  FROM system.lakeflow.job_task_run_timeline\n",
        "  WHERE period_start_time >= CURRENT_DATE() - INTERVAL 30 DAY\n",
        "  GROUP BY ALL\n",
        "),\n",
        "all_purpose_cluster_jobs AS (\n",
        "  SELECT\n",
        "    t1.*,\n",
        "    t2.cluster_name,\n",
        "    t2.owned_by,\n",
        "    t2.dbr_version\n",
        "  FROM job_tasks_exploded t1\n",
        "    INNER JOIN clusters t2 USING (workspace_id, cluster_id)\n",
        ")\n",
        "SELECT * FROM all_purpose_cluster_jobs LIMIT 10;"
      ]
    },
    {
      "name": "d654eb5a",
      "displayName": "waf_CO-01-03_sql_vs_allpurpose",
      "queryLines": [
        "-- ToDo: Use $DBUs with account_prices system table when it is available\n",
        "-- show SKU distribution between All-Purpose and SQL Warehouses, companies with primary DWH are expected even over 50 % of $DBUs on DWH\n",
        "-- docs: https://docs.databricks.com/aws/en/admin/system-tables/billing#billing-origin-product-reference\n",
        "select billing_origin_product, sum(usage_quantity) as dbu from system.billing.usage where billing_origin_product in ('SQL','ALL_PURPOSE') and usage_date >= current_date() - interval 30 days \n",
        "group by billing_origin_product;"
      ]
    },
    {
      "name": "898f3132",
      "displayName": "waf_CO-01-03_sql_on_allpurpose",
      "queryLines": [
        "-- ToDo\n",
        "-- show SKU distribution between All-Purpose and SQL Warehouses, companies with primary DWH are expected even over 50 % on DWH\n",
        "-- ToDo: What query? Check utilization metrics? Or track Academy?\n",
        "select 'Coming Soon...'  as message;\n",
        "-- select * from system.billing.usage where billing_origin_product in ('ALL_PURPOSE','SQL');\n",
        "-- optional Verbose logging shows command text, this can extract/guess the language https://docs.databricks.com/aws/en/admin/account-settings/verbose-logs\n",
        "-- workloadTags=commandLanguage or notebookLanguage=sql and SKU All-Purpose"
      ]
    },
    {
      "name": "f4e7201f",
      "displayName": "waf_CO-01-04_latest_dbr",
      "queryLines": [
        "select \n",
        "regexp_extract(dbr_version, '^(\\\\d+\\\\.\\\\d+)',1) as runtime\n",
        ", workspace_id\n",
        ", cluster_id\n",
        ", cluster_name\n",
        " from system.compute.clusters\n",
        "QUALIFY\n",
        "    ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, cluster_id ORDER BY change_time DESC) = 1\n",
        "    and delete_time is null\n",
        "    and cluster_source not in('PIPELINE','PIPELINE_MAINTENANCE') \n",
        " AND  not contains(dbr_version, 'custom') \n",
        "limit 100"
      ]
    },
    {
      "name": "62126ae8",
      "displayName": "waf_CO-01-05_gpu",
      "queryLines": [
        "-- ToDo: List all VM instances with GPUs across clouds and check their usage in system tables. How to keep it up to date?\n",
        "-- https://docs.databricks.com/aws/en/compute/gpu\n",
        "-- SRTI Mockup for now:\n",
        "--select * as DBUs from system.billing.usage u where contains(u.sku_name, 'SERVERLESS_REAL_TIME_INFERENCE') and date_diff(day, u.usage_start_time, now()) <28;\n",
        "-- ToDo: What query? Check utilization metrics? Or track Academy?\n",
        "select 'Coming Soon...' as message;\n"
      ]
    },
    {
      "name": "a36b2899",
      "displayName": "waf_CO-01-06_serverless",
      "queryLines": [
        "with serverless as (\n",
        "    select sum(usage_quantity) as dbu from system.billing.usage u where contains(u.sku_name, 'SERVERLESS') and u.billing_origin_product in ('ALL_PURPOSE','SQL','JOBS', 'DLT','INTERACTIVE') and date_diff(day, u.usage_start_time, now()) <28\n",
        "),\n",
        "total as (\n",
        "    select sum(usage_quantity) as dbu from system.billing.usage u where  u.billing_origin_product in ('ALL_PURPOSE','SQL','JOBS', 'DLT','INTERACTIVE') and date_diff(day, u.usage_start_time, now()) <28\n",
        ")\n",
        "select serverless.dbu * 100 / total.dbu as serverless_dbu_percent from serverless cross join total;\n"
      ]
    },
    {
      "name": "aed75aae",
      "displayName": "waf_CO-01-06_serverless_sql",
      "queryLines": [
        "--ToDo: Use account_prices system table when available\n",
        "select \n",
        "--t1.usage_date,\n",
        "case when t1.sku_name like '%SERVERLESS_SQL%' then 'SQL_SERVERLESS' \n",
        "when t1.sku_name like '%ENTERPRISE_SQL_COMPUTE%' then 'SQL_CLASSIC'\n",
        "when t1.sku_name like '%SQL_PRO%' then 'SQL_PRO'\n",
        "else 'Other' end as sql_sku_name,\n",
        "SUM(t1.usage_quantity * list_prices.pricing.default) as list_cost\n",
        "FROM system.billing.usage t1\n",
        "INNER JOIN system.billing.list_prices on\n",
        "   t1.cloud = list_prices.cloud and\n",
        "   t1.sku_name = list_prices.sku_name and\n",
        "   t1.usage_start_time >= list_prices.price_start_time and\n",
        "   (t1.usage_end_time <= list_prices.price_end_time or list_prices.price_end_time is null)\n",
        "where t1.sku_name like '%SQL%' and t1.usage_date >= current_date() - interval 30 days\n",
        "group by all"
      ]
    },
    {
      "name": "efb892e1",
      "displayName": "waf_CO-01-07_instance_type",
      "queryLines": [
        "-- ToDo: What query? Check utilization metrics? Or track Academy?\n",
        "-- Instance type: Compute-optimized, Memory-optimized etc?\n",
        "select 'Coming Soon...'  as message;"
      ]
    },
    {
      "name": "1de7073d",
      "displayName": "waf_CO-01-08_cluster_size",
      "queryLines": [
        "-- ToDo: What query? Check utilization metrics? Or track Academy?\n",
        "-- Use CASE statement and bucket into Personal cluster / Small / Medium / Large\n",
        "-- --ToDo: Show also % of Single VM vs multi? Eg in cluster sizes with tags.ResourceClass='SingleNode'\n",
        "select 'Coming Soon...'  as message;"
      ]
    },
    {
      "name": "31958c67",
      "displayName": "waf_CO-01-08_cluster_utilization",
      "queryLines": [
        "with cluster_name as (\n",
        "  select cluster_id, cluster_name from system.compute.clusters \n",
        "  QUALIFY\n",
        "    ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, cluster_id ORDER BY change_time DESC) = 1\n",
        "    and delete_time is null)\n",
        "  select nt.cluster_id\n",
        "  , cn.cluster_name\n",
        "  , avg(nt.cpu_user_percent + nt.cpu_system_percent) AS `Avg CPU Utilization`\n",
        "  -- , avg(nt.mem_used_percent) AS `Avg Memory Utilization`\n",
        "  from system.compute.node_timeline nt\n",
        "  join cluster_name cn on nt.cluster_id = cn.cluster_id\n",
        "  WHERE\n",
        "    nt.start_time BETWEEN current_date() - INTERVAL 90 DAYS AND current_date() \n",
        "  group by 1,2\n",
        "  order by 3 desc;\n",
        "\n"
      ]
    },
    {
      "name": "781ee68b",
      "displayName": "waf_CO-01-08_cluster_utilization_memory",
      "queryLines": [
        "with cluster_name as (\n",
        "  select cluster_id, cluster_name from system.compute.clusters \n",
        "  QUALIFY\n",
        "    ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, cluster_id ORDER BY change_time DESC) = 1\n",
        "    and delete_time is null)\n",
        "  select nt.cluster_id\n",
        "  , cn.cluster_name\n",
        "  -- , avg(nt.cpu_user_percent + nt.cpu_system_percent) AS `Avg CPU Utilization`\n",
        "  , avg(nt.mem_used_percent) AS `Avg Memory Utilization`\n",
        "  from system.compute.node_timeline nt\n",
        "  join cluster_name cn on nt.cluster_id = cn.cluster_id\n",
        "  WHERE\n",
        "    nt.start_time BETWEEN current_date() - INTERVAL 90 DAYS AND current_date() \n",
        "  group by 1,2\n",
        "  order by 3 desc\n",
        "  limit 100;"
      ]
    },
    {
      "name": "951a00c5",
      "displayName": "waf_CO-01-09_AP_photon",
      "queryLines": [
        "select ju.usage_metadata.cluster_id,\n",
        "c.cluster_name,\n",
        "ju.product_features.is_photon, \n",
        "sum(ju.usage_quantity) as dbu \n",
        "from system.billing.usage ju \n",
        "join system.compute.clusters c on c.cluster_id = ju.usage_metadata.cluster_id\n",
        "-- join system.lakeflow.jobs j on j.job_id = ju.usage_metadata.job_id\n",
        "where ju.usage_date BETWEEN current_date() - interval 90 days AND current_date()\n",
        "--  AND array_contains(:workspace_id,ju.workspace_id)\n",
        "and ju.billing_origin_product in (\"ALL_PURPOSE\")\n",
        "and ju.product_features.is_serverless = false\n",
        "group by 1,2,3\n"
      ]
    },
    {
      "name": "b54341e5",
      "displayName": "waf_CO-02-01_auto_scaling",
      "queryLines": [
        "with autoscaling_count as (select count(*) as autoscaling_count from system.compute.clusters where max_autoscale_workers is not null and delete_time is null),\n",
        "total_clusters_count as (select count(*) as total_clusters_count from system.compute.clusters where delete_time is null)\n",
        "select autoscaling_count.autoscaling_count * 100 / total_clusters_count.total_clusters_count as autoscaling_percent from total_clusters_count cross join autoscaling_count;"
      ]
    },
    {
      "name": "d0192813",
      "displayName": "waf_CO-02-02_AP_auto_termination",
      "queryLines": [
        "select workspace_id,cluster_id,cluster_name\n",
        ", auto_termination_minutes\n",
        ",case when auto_termination_minutes is null then \"No\" else \"Yes\" end as autotermination_enabled\n",
        "from system.compute.clusters\n",
        "qualify\n",
        "ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, cluster_id ORDER BY change_time DESC) = 1\n",
        "and delete_time is null \n",
        "and cluster_source in (\"API\", \"UI\")\n",
        "--  AND array_contains(:workspace_id,workspace_id)\n"
      ]
    },
    {
      "name": "cc24226f",
      "displayName": "waf_CO-02-03_job_cluster_policy",
      "queryLines": [
        "select workspace_id\n",
        ",cluster_id\n",
        ",cluster_name\n",
        ",policy_id\n",
        ",case when policy_id is null then \"No\" else \"Yes\" end as cluster_policy\n",
        "from system.compute.clusters\n",
        "qualify\n",
        "ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, cluster_id ORDER BY change_time DESC) = 1\n",
        "and delete_time is null \n",
        "and cluster_source in (\"JOB\")\n",
        "--  AND array_contains(:workspace_id,workspace_id)"
      ]
    },
    {
      "name": "e46a4a40",
      "displayName": "waf_CO-03-01_billing_tables",
      "queryLines": [
        "-- How often is system.billing.usage accessed L28d? Eg 19k in field-eng L30d\n",
        "select\n",
        "  event_date,\n",
        "  count(*) as usage_read\n",
        "from\n",
        "  system.access.audit\n",
        "where\n",
        "  service_name = 'unityCatalog'\n",
        "  and action_name = 'getTable'\n",
        "  and request_params.full_name_arg = 'system.billing.usage'\n",
        "  and user_identity.email != 'System-User'\n",
        "  and (date_diff(day, event_date, current_date()) <= 90)\n",
        "group by event_date\n",
        "order by event_date;"
      ]
    },
    {
      "name": "bb77bb31",
      "displayName": "waf_CO-03-02_clusters_tagging",
      "queryLines": [
        "select workspace_id,cluster_id,cluster_name, cluster_source\n",
        "from system.compute.clusters\n",
        "qualify\n",
        "ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, cluster_id ORDER BY change_time DESC) = 1\n",
        "and array_size(map_entries(tags))  = 0\n",
        "and delete_time is null \n",
        "and cluster_source in (\"API\", \"UI\", \"JOB\")\n",
        "--  AND array_contains(:workspace_id,workspace_id)\n"
      ]
    },
    {
      "name": "7abec3c3",
      "displayName": "waf_CO-03-02_warehouses_tagging",
      "queryLines": [
        "select workspace_id,warehouse_id,warehouse_name\n",
        "from system.compute.warehouses\n",
        "qualify\n",
        "ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, warehouse_id ORDER BY change_time DESC) = 1\n",
        "and array_size(map_entries(tags))  = 0\n",
        "and delete_time is null \n",
        "--  AND array_contains(:workspace_id,workspace_id)\n"
      ]
    },
    {
      "name": "9f038f29",
      "displayName": "waf_CO-03-03_chargeback",
      "queryLines": [
        "select 'Coming Soon...'  as message;"
      ]
    },
    {
      "name": "e3cd19cf",
      "displayName": "waf_CO-03-04_share_cost",
      "queryLines": [
        "select 'Coming Soon...'  as message;"
      ]
    },
    {
      "name": "d83ae5eb",
      "displayName": "waf_CO-03-05_data_transfer_cost",
      "queryLines": [
        "select 'Coming Soon...'  as message;"
      ]
    },
    {
      "name": "d0a01e50",
      "displayName": "waf_CO-04-02_spot_AP",
      "queryLines": [
        "select workspace_id, cluster_id, cluster_name,\n",
        "case when aws_attributes is not null then aws_attributes.availability else azure_attributes.availability end as spot_placement\n",
        "from system.compute.clusters\n",
        "qualify\n",
        "ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, cluster_id ORDER BY change_time DESC) = 1\n",
        "and delete_time is null \n",
        "and cluster_source in (\"API\", \"UI\")\n",
        "--  AND array_contains(:workspace_id,workspace_id)\n"
      ]
    },
    {
      "name": "67073248",
      "displayName": "waf_CO-04-02_spot_job",
      "queryLines": [
        "select workspace_id, cluster_id, cluster_name,\n",
        "case when aws_attributes is not null then aws_attributes.availability else azure_attributes.availability end as spot_placement\n",
        "from system.compute.clusters\n",
        "qualify\n",
        "ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, cluster_id ORDER BY change_time DESC) = 1\n",
        "and delete_time is null \n",
        "-- and cluster_source in (\"JOB\") AND array_contains(:workspace_id,workspace_id)\n"
      ]
    },
    {
      "name": "03babf4f",
      "displayName": "total_percentage_r",
      "queryLines": [
        "WITH delta_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN data_source_format IN ('DELTA', 'ICEBERG') THEN 1 ELSE 0 END) as delta_tables\n",
        "  FROM system.information_schema.tables\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "dlt_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute_usage,\n",
        "    SUM(CASE WHEN billing_origin_product = 'DLT' THEN 1 ELSE 0 END) as dlt_compute_usage\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "model_serving_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_ml_compute,\n",
        "    SUM(CASE WHEN billing_origin_product = 'MODEL_SERVING' THEN 1 ELSE 0 END) as serving_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND (usage_type LIKE '%COMPUTE%' OR billing_origin_product = 'MODEL_SERVING')\n",
        "),\n",
        "serverless_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SERVERLESS%' OR sku_name LIKE '%SERVERLESS%' THEN 1 ELSE 0 END) as serverless_count\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "autoscale_clusters AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN ifnull(max_autoscale_Workers, 0) > 0 THEN 1 ELSE 0 END) as autoscale_clusters\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "autoscale_warehouses AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_warehouses,\n",
        "    SUM(CASE WHEN max_clusters - min_clusters > 0 THEN 1 ELSE 0 END) as autoscale_warehouses\n",
        "  FROM system.compute.warehouses\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    CASE \n",
        "    -- R-01-01: >80% of tables use Delta/ICEBERG format\n",
        "    WHEN waf_id = 'R-01-01' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END\n",
        "      FROM delta_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    -- R-01-03: >30% of compute usage is DLT\n",
        "    WHEN waf_id = 'R-01-03' AND (\n",
        "      SELECT CASE WHEN total_compute_usage > 0 THEN (dlt_compute_usage * 100.0 / total_compute_usage) ELSE 0 END\n",
        "      FROM dlt_usage\n",
        "    ) >= 30 THEN 'Yes'\n",
        "    -- R-01-05: Model Serving actively used (>20% of ML compute usage)\n",
        "    WHEN waf_id = 'R-01-05' AND (\n",
        "      SELECT CASE WHEN total_ml_compute > 0 THEN (serving_compute * 100.0 / total_ml_compute) ELSE 0 END\n",
        "      FROM model_serving_usage\n",
        "    ) >= 20 THEN 'Yes'\n",
        "    -- R-01-06: >50% of compute is serverless or managed\n",
        "    WHEN waf_id = 'R-01-06' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END\n",
        "      FROM serverless_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    -- R-02-03: Unity Catalog metastore exists\n",
        "    WHEN waf_id = 'R-02-03' AND EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.metastores LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    -- R-02-04: >30% of compute usage is DLT (same as R-01-03)\n",
        "    WHEN waf_id = 'R-02-04' AND (\n",
        "      SELECT CASE WHEN total_compute_usage > 0 THEN (dlt_compute_usage * 100.0 / total_compute_usage) ELSE 0 END\n",
        "      FROM dlt_usage\n",
        "    ) >= 30 THEN 'Yes'\n",
        "    -- R-03-01: >80% of clusters have auto-scaling enabled\n",
        "    WHEN waf_id = 'R-03-01' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (autoscale_clusters * 100.0 / total_clusters) ELSE 0 END\n",
        "      FROM autoscale_clusters\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    -- R-03-02: >80% of warehouses have auto-scaling enabled\n",
        "    WHEN waf_id = 'R-03-02' AND (\n",
        "      SELECT CASE WHEN total_warehouses > 0 THEN (autoscale_warehouses * 100.0 / total_warehouses) ELSE 0 END\n",
        "      FROM autoscale_warehouses\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "  END AS implemented\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('R-01-01'),\n",
        "    --('R-01-02'), -- Removed: Apache Spark always available in Databricks\n",
        "    ('R-01-03'),\n",
        "    --('R-01-04'),\n",
        "    ('R-01-05'),\n",
        "    ('R-01-06'),\n",
        "    ('R-02-03'),\n",
        "    ('R-02-04'),\n",
        "    ('R-03-01'),\n",
        "    ('R-03-02')\n",
        "    AS waf(waf_id)\n",
        "  )\n",
        ")\n",
        "\n",
        "SELECT\n",
        "  COUNT(*) AS total_controls,\n",
        "  SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) AS implemented_controls,\n",
        "  ROUND(100 * SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) / COUNT(*), 0) AS completion_percent\n",
        "FROM waf_status;\n"
      ]
    },
    {
      "name": "011cf80a",
      "displayName": "waf_principal_percentage_r",
      "queryLines": [
        "WITH delta_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN data_source_format IN ('DELTA', 'ICEBERG') THEN 1 ELSE 0 END) as delta_tables\n",
        "  FROM system.information_schema.tables\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "dlt_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute_usage,\n",
        "    SUM(CASE WHEN billing_origin_product = 'DLT' THEN 1 ELSE 0 END) as dlt_compute_usage\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "model_serving_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_ml_compute,\n",
        "    SUM(CASE WHEN billing_origin_product = 'MODEL_SERVING' THEN 1 ELSE 0 END) as serving_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND (usage_type LIKE '%COMPUTE%' OR billing_origin_product = 'MODEL_SERVING')\n",
        "),\n",
        "serverless_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SERVERLESS%' OR sku_name LIKE '%SERVERLESS%' THEN 1 ELSE 0 END) as serverless_count\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "autoscale_clusters AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN ifnull(max_autoscale_Workers, 0) > 0 THEN 1 ELSE 0 END) as autoscale_clusters\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "autoscale_warehouses AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_warehouses,\n",
        "    SUM(CASE WHEN max_clusters - min_clusters > 0 THEN 1 ELSE 0 END) as autoscale_warehouses\n",
        "  FROM system.compute.warehouses\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    principle,\n",
        "    CASE \n",
        "    WHEN waf_id = 'R-01-01' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END FROM delta_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-01-03' AND (\n",
        "      SELECT CASE WHEN total_compute_usage > 0 THEN (dlt_compute_usage * 100.0 / total_compute_usage) ELSE 0 END FROM dlt_usage\n",
        "    ) >= 30 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-01-05' AND (\n",
        "      SELECT CASE WHEN total_ml_compute > 0 THEN (serving_compute * 100.0 / total_ml_compute) ELSE 0 END FROM model_serving_usage\n",
        "    ) >= 20 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-01-06' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-02-03' AND EXISTS (SELECT 1 FROM system.information_schema.metastores LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'R-02-04' AND (\n",
        "      SELECT CASE WHEN total_compute_usage > 0 THEN (dlt_compute_usage * 100.0 / total_compute_usage) ELSE 0 END FROM dlt_usage\n",
        "    ) >= 30 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-03-01' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (autoscale_clusters * 100.0 / total_clusters) ELSE 0 END FROM autoscale_clusters\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-03-02' AND (\n",
        "      SELECT CASE WHEN total_warehouses > 0 THEN (autoscale_warehouses * 100.0 / total_warehouses) ELSE 0 END FROM autoscale_warehouses\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "    END AS implemented\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('R-01-01', 'Design for failure'),\n",
        "    ('R-01-03', 'Design for failure'),\n",
        "    ('R-01-05', 'Design for failure'),\n",
        "    ('R-01-06', 'Design for failure'),\n",
        "    ('R-02-03', 'Manage data quality'),\n",
        "    ('R-02-04', 'Manage data quality'),\n",
        "    ('R-03-01', 'Design for autoscaling'),\n",
        "    ('R-03-02', 'Design for autoscaling')\n",
        "    AS waf(waf_id, principle)\n",
        "  )\n",
        ")\n",
        "SELECT\n",
        "  principle,\n",
        "  COUNT(*) AS total_controls,\n",
        "  SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) AS implemented_controls,\n",
        "  ROUND(100 * SUM(CASE WHEN implemented = 'Yes' THEN 1 ELSE 0 END) / COUNT(*), 0) AS completion_percent\n",
        "FROM waf_status\n",
        "GROUP BY principle\n",
        "ORDER BY principle;\n"
      ]
    },
    {
      "name": "60cfe928",
      "displayName": "waf_controls_r",
      "queryLines": [
        "WITH delta_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_tables,\n",
        "    SUM(CASE WHEN data_source_format IN ('DELTA', 'ICEBERG') THEN 1 ELSE 0 END) as delta_tables\n",
        "  FROM system.information_schema.tables\n",
        "  WHERE table_catalog != 'hive_metastore'\n",
        "),\n",
        "dlt_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute_usage,\n",
        "    SUM(CASE WHEN billing_origin_product = 'DLT' THEN 1 ELSE 0 END) as dlt_compute_usage\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "model_serving_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_ml_compute,\n",
        "    SUM(CASE WHEN billing_origin_product = 'MODEL_SERVING' THEN 1 ELSE 0 END) as serving_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND (usage_type LIKE '%COMPUTE%' OR billing_origin_product = 'MODEL_SERVING')\n",
        "),\n",
        "serverless_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SERVERLESS%' OR sku_name LIKE '%SERVERLESS%' THEN 1 ELSE 0 END) as serverless_count\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "autoscale_clusters AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN ifnull(max_autoscale_Workers, 0) > 0 THEN 1 ELSE 0 END) as autoscale_clusters\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "autoscale_warehouses AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_warehouses,\n",
        "    SUM(CASE WHEN max_clusters - min_clusters > 0 THEN 1 ELSE 0 END) as autoscale_warehouses\n",
        "  FROM system.compute.warehouses\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    principle,\n",
        "    best_practice,\n",
        "    CASE \n",
        "    -- R-01-01: >80% of tables use Delta/ICEBERG format\n",
        "    WHEN waf_id = 'R-01-01' THEN (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END\n",
        "      FROM delta_usage\n",
        "    )\n",
        "    -- R-01-03: >30% of compute usage is DLT\n",
        "    WHEN waf_id = 'R-01-03' THEN (\n",
        "      SELECT CASE WHEN total_compute_usage > 0 THEN (dlt_compute_usage * 100.0 / total_compute_usage) ELSE 0 END\n",
        "      FROM dlt_usage\n",
        "    )\n",
        "    -- R-01-05: >20% of ML compute is Model Serving\n",
        "    WHEN waf_id = 'R-01-05' THEN (\n",
        "      SELECT CASE WHEN total_ml_compute > 0 THEN (serving_compute * 100.0 / total_ml_compute) ELSE 0 END\n",
        "      FROM model_serving_usage\n",
        "    )\n",
        "    -- R-01-06: >50% of compute is serverless or managed\n",
        "    WHEN waf_id = 'R-01-06' THEN (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END\n",
        "      FROM serverless_usage\n",
        "    )\n",
        "    -- R-02-03: Unity Catalog metastore exists (100 if exists, 0 if not)\n",
        "    WHEN waf_id = 'R-02-03' THEN (\n",
        "      CASE WHEN EXISTS (SELECT 1 FROM system.information_schema.metastores LIMIT 1) THEN 100 ELSE 0 END\n",
        "    )\n",
        "    -- R-02-04: >30% of compute usage is DLT\n",
        "    WHEN waf_id = 'R-02-04' THEN (\n",
        "      SELECT CASE WHEN total_compute_usage > 0 THEN (dlt_compute_usage * 100.0 / total_compute_usage) ELSE 0 END\n",
        "      FROM dlt_usage\n",
        "    )\n",
        "    -- R-03-01: >80% of clusters have auto-scaling\n",
        "    WHEN waf_id = 'R-03-01' THEN (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (autoscale_clusters * 100.0 / total_clusters) ELSE 0 END\n",
        "      FROM autoscale_clusters\n",
        "    )\n",
        "    -- R-03-02: >80% of warehouses have auto-scaling\n",
        "    WHEN waf_id = 'R-03-02' THEN (\n",
        "      SELECT CASE WHEN total_warehouses > 0 THEN (autoscale_warehouses * 100.0 / total_warehouses) ELSE 0 END\n",
        "      FROM autoscale_warehouses\n",
        "    )\n",
        "    ELSE 0\n",
        "    END AS current_percentage,\n",
        "    CASE \n",
        "    WHEN waf_id = 'R-01-01' AND (\n",
        "      SELECT CASE WHEN total_tables > 0 THEN (delta_tables * 100.0 / total_tables) ELSE 0 END FROM delta_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-01-03' AND (\n",
        "      SELECT CASE WHEN total_compute_usage > 0 THEN (dlt_compute_usage * 100.0 / total_compute_usage) ELSE 0 END FROM dlt_usage\n",
        "    ) >= 30 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-01-05' AND (\n",
        "      SELECT CASE WHEN total_ml_compute > 0 THEN (serving_compute * 100.0 / total_ml_compute) ELSE 0 END FROM model_serving_usage\n",
        "    ) >= 20 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-01-06' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-02-03' AND EXISTS (SELECT 1 FROM system.information_schema.metastores LIMIT 1) THEN 'Yes'\n",
        "    WHEN waf_id = 'R-02-04' AND (\n",
        "      SELECT CASE WHEN total_compute_usage > 0 THEN (dlt_compute_usage * 100.0 / total_compute_usage) ELSE 0 END FROM dlt_usage\n",
        "    ) >= 30 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-03-01' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (autoscale_clusters * 100.0 / total_clusters) ELSE 0 END FROM autoscale_clusters\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'R-03-02' AND (\n",
        "      SELECT CASE WHEN total_warehouses > 0 THEN (autoscale_warehouses * 100.0 / total_warehouses) ELSE 0 END FROM autoscale_warehouses\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "    END AS implemented\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('R-01-01', 'Design for failure', 'Use a data format that supports ACID transactions'),\n",
        "    ('R-01-03', 'Design for failure', 'Automatically rescue invalid or nonconforming data'),\n",
        "    ('R-01-05', 'Design for failure', 'Use a scalable and production-grade model serving infrastructure'),\n",
        "    ('R-01-06', 'Design for failure', 'Use managed services for your workloads'),\n",
        "    ('R-02-03', 'Manage data quality', 'Actively manage schemas'),\n",
        "    ('R-02-04', 'Manage data quality', 'Use constraints and data expectations'),\n",
        "    ('R-03-01', 'Design for autoscaling', 'Enable autoscaling for ETL workloads'),\n",
        "    ('R-03-02', 'Design for autoscaling', 'Use autoscaling for SQL Warehouses')\n",
        "    AS waf(waf_id, principle, best_practice)\n",
        "  )\n",
        ")\n",
        "SELECT\n",
        "  waf_id,\n",
        "  principle,\n",
        "  best_practice,\n",
        "  ROUND(current_percentage, 1) as score_percentage,\n",
        "  CASE \n",
        "    WHEN waf_id = 'R-01-01' THEN 80\n",
        "    WHEN waf_id = 'R-01-03' THEN 30\n",
        "    WHEN waf_id = 'R-01-05' THEN 20\n",
        "    WHEN waf_id = 'R-01-06' THEN 50\n",
        "    WHEN waf_id = 'R-02-03' THEN 100\n",
        "    WHEN waf_id = 'R-02-04' THEN 30\n",
        "    WHEN waf_id = 'R-03-01' THEN 80\n",
        "    WHEN waf_id = 'R-03-02' THEN 80\n",
        "  END as threshold_percentage,\n",
        "  CASE \n",
        "    WHEN implemented = 'Yes' THEN 'Met'\n",
        "    ELSE 'Not Met'\n",
        "  END as threshold_met,\n",
        "  implemented\n",
        "FROM waf_status\n",
        "ORDER BY principle, waf_id;\n"
      ]
    },
    {
      "name": "8486d58c",
      "displayName": "Count of tables with lineage",
      "queryLines": [
        "WITH lineage_tables AS (\n",
        "  SELECT DISTINCT\n",
        "    source_table_catalog,\n",
        "    source_table_schema,\n",
        "    source_table_name\n",
        "  FROM\n",
        "    (\n",
        "      select distinct\n",
        "        source_table_catalog,\n",
        "        source_table_schema,\n",
        "        source_table_name\n",
        "      from\n",
        "        system.access.table_lineage\n",
        "      union\n",
        "      select distinct\n",
        "        target_table_catalog,\n",
        "        target_table_catalog,\n",
        "        target_table_name\n",
        "      from\n",
        "        system.access.table_lineage\n",
        "    )\n",
        "  WHERE\n",
        "    source_table_catalog IS NOT NULL\n",
        "),\n",
        "table_list AS (\n",
        "  SELECT\n",
        "    table_catalog,\n",
        "    table_schema,\n",
        "    table_name,\n",
        "    table_type\n",
        "  from\n",
        "    system.information_schema.tables\n",
        " -- where\n",
        "   -- table_type not in ('FOREIGN')\n",
        ")\n",
        "SELECT\n",
        "  table_list.table_type,\n",
        "  COUNT(*) AS total_tables,\n",
        "  SUM(\n",
        "    CASE\n",
        "      WHEN lineage_tables.source_table_catalog IS NULL THEN 0\n",
        "      ELSE 1\n",
        "    END\n",
        "  ) AS lineage_tables\n",
        "FROM\n",
        "  table_list\n",
        "    LEFT JOIN lineage_tables\n",
        "      ON table_list.table_catalog = lineage_tables.source_table_catalog\n",
        "      AND table_list.table_schema = lineage_tables.source_table_schema\n",
        "      AND table_list.table_name = lineage_tables.source_table_name\n",
        "GROUP BY\n",
        "  table_list.table_type\n"
      ]
    },
    {
      "name": "16facbed",
      "displayName": "Count of table formats with table types",
      "queryLines": [
        "SELECT\n",
        "  COUNT(*) AS count_of_tables,\n",
        "  table_type,\n",
        "  data_source_format\n",
        "FROM\n",
        "  system.information_schema.tables\n",
        "GROUP BY\n",
        "  table_type,\n",
        "  data_source_format"
      ]
    },
    {
      "name": "f7dd8a02",
      "displayName": "waf_DG-03-02_lakehouse_monitoring",
      "queryLines": [
        "SELECT COUNT(*) as count_tables FROM system.information_schema.tables \n",
        "WHERE table_name LIKE '%_drift_metrics' OR table_name LIKE '%_profile_metrics'"
      ]
    },
    {
      "name": "1ab4ec65",
      "displayName": "waf_DG-02-03_marketplace_listings",
      "queryLines": [
        "SELECT\n",
        "  \n",
        "  count(*) AS cnt\n",
        "FROM system.access.audit\n",
        "WHERE service_name = 'unityCatalog'\n",
        "  AND (\n",
        "    -- Provider-side access events\n",
        "    action_name IN ('deltaSharingQueriedTable','deltaSharingQueriedTableChanges',\n",
        "                    'generateTemporaryTableCredential','generateTemporaryVolumeCredential')\n",
        "    OR action_name LIKE 'deltaSharing%'  -- future provider events\n",
        "  )\n",
        "  AND event_date >= date_add(current_date(), -30)\n",
        "  AND coalesce(\n",
        "        request_params['metastore_id'],\n",
        "        get_json_object(response.result, '$.metastoreId')\n",
        "      ) = element_at(split(current_metastore(), ':'), 3)  -- current metastore UUID\n",
        "ORDER BY cnt DESC;"
      ]
    },
    {
      "name": "5b3944b6",
      "displayName": "waf_DG-02-02_audit_events",
      "queryLines": [
        "SELECT\n",
        "  count(*) as count_of_events,\n",
        "  audit_level,\n",
        "  workspace_id\n",
        "from\n",
        "  system.access.audit\n",
        "where\n",
        "  event_date between current_date() - 30 and current_date()\n",
        "group by\n",
        "  audit_level,\n",
        "  workspace_id"
      ]
    },
    {
      "name": "6b0c95c6",
      "displayName": "waf_DG-02-01_rbac_col_mask",
      "queryLines": [
        "SELECT\n",
        "  count(distinct table_catalog, table_schema, table_name) AS count,\n",
        "  'table_with_filters' AS object_type\n",
        "from\n",
        "  system.information_schema.row_filters\n",
        "UNION ALL\n",
        "SELECT\n",
        "  count(distinct table_catalog, table_schema, table_name),\n",
        "  'table_with_masks'\n",
        "from\n",
        "  system.information_schema.column_masks\n",
        "UNION ALL\n",
        "SELECT\n",
        "  count(*),\n",
        "  'column_masks'\n",
        "from\n",
        "  system.information_schema.column_masks\n",
        "UNION ALL\n",
        "SELECT\n",
        "  count(*),\n",
        "  'row_filters'\n",
        "from\n",
        "  system.information_schema.row_filters"
      ]
    },
    {
      "name": "e097b5c1",
      "displayName": "waf_DG-01-04_comments",
      "queryLines": [
        "SELECT *, count_comment/overall_count AS perc_comment\n",
        "FROM (\n",
        "select 'Tables' AS  object_type, SUM(CASE WHEN comment is NOT NULL THEN 1 ELSE 0 END) AS count_comment, COUNT(*) AS overall_count FROM system.information_schema.tables \n",
        "UNION ALL\n",
        "--select 'Columns' AS  object_type, SUM(CASE WHEN comment is NOT NULL THEN 1 ELSE 0 END), count(*) FROM system.information_schema.columns \n",
        "--UNION ALL\n",
        "select 'Volumes' AS  object_type, SUM(CASE WHEN comment is NOT NULL THEN 1 ELSE 0 END), count(*) FROM system.information_schema.volumes \n",
        "UNION ALL\n",
        "select 'Catalogs' AS  object_type, SUM(CASE WHEN comment is NOT NULL THEN 1 ELSE 0 END), count(*) FROM system.information_schema.catalogs \n",
        "UNION ALL\n",
        "select 'Connections' AS  object_type, SUM(CASE WHEN comment is NOT NULL THEN 1 ELSE 0 END), count(*) FROM system.information_schema.connections \n",
        "UNION ALL\n",
        "select 'Credentials' AS  object_type, SUM(CASE WHEN comment is NOT NULL THEN 1 ELSE 0 END), count(*) FROM system.information_schema.credentials \n",
        "UNION ALL\n",
        "select 'External Locations' AS  object_type, SUM(CASE WHEN comment is NOT NULL THEN 1 ELSE 0 END), count(*) FROM system.information_schema.external_locations \n",
        "UNION ALL\n",
        "select 'Providers' AS  object_type, SUM(CASE WHEN comment is NOT NULL THEN 1 ELSE 0 END), count(*) FROM system.information_schema.providers \n",
        "UNION ALL\n",
        "select 'Recipients' AS  object_type, SUM(CASE WHEN comment is NOT NULL THEN 1 ELSE 0 END), count(*) FROM system.information_schema.recipients \n",
        "UNION ALL\n",
        "select 'Routines' AS  object_type, SUM(CASE WHEN comment is NOT NULL THEN 1 ELSE 0 END), count(*) FROM system.information_schema.routines \n",
        "UNION ALL\n",
        "select 'Schemas' AS  object_type, SUM(CASE WHEN comment is NOT NULL THEN 1 ELSE 0 END), count(*) FROM system.information_schema.schemata \n",
        "UNION ALL\n",
        "select 'Shares' AS  object_type, SUM(CASE WHEN comment is NOT NULL THEN 1 ELSE 0 END), count(*) FROM system.information_schema.shares \n",
        "UNION ALL\n",
        "select 'Storage Credentials' AS  object_type, SUM(CASE WHEN comment is NOT NULL THEN 1 ELSE 0 END), count(*) FROM system.information_schema.storage_credentials \n",
        ")"
      ]
    },
    {
      "name": "27265888",
      "displayName": "waf_R-03-02_auto_scaling_SQL",
      "queryLines": [
        "SELECT\n",
        "    warehouse_id,\n",
        "    warehouse_name,\n",
        "    warehouse_type,\n",
        "    warehouse_size,\n",
        "    min_clusters,\n",
        "    max_clusters,\n",
        "    auto_stop_minutes\n",
        "FROM\n",
        "    system.compute.warehouses\n",
        "QUALIFY\n",
        "    ROW_NUMBER() OVER (PARTITION BY warehouse_id ORDER BY change_time DESC) = 1\n",
        "    and delete_time is null\n",
        "    and min_clusters = max_clusters;"
      ]
    },
    {
      "name": "6e7d4785",
      "displayName": "waf_PE-01-_serverless_compute",
      "queryLines": [
        "WITH CTE AS (\n",
        "SELECT COUNT(*) AS runs,SUM(usage_quantity) AS dbu_usage, CASE WHEN billing_origin_product = 'ALL_PURPOSE' THEN 'INTERACTIVE' ELSE billing_origin_product END AS billing_origin_product\n",
        ", CASE WHEN sku_name LIKE '%SERVERLESS%' OR product_features.is_serverless = true THEN true ELSE false END AS is_serverless\n",
        "FROM system.billing.usage \n",
        "WHERE usage_date BETWEEN current_date()-:rollback_days AND current_date()\n",
        "AND usage_unit = 'DBU'\n",
        "AND billing_origin_product IN ('JOBS','MODEL_SERVING','LAKEFLOW_CONNECT','SQL','INTERACTIVE','DLT','ALL_PURPOSE')\n",
        "GROUP BY CASE WHEN billing_origin_product = 'ALL_PURPOSE' THEN 'INTERACTIVE' ELSE billing_origin_product END, CASE WHEN sku_name LIKE '%SERVERLESS%' OR product_features.is_serverless = true THEN true ELSE false END \n",
        ")\n",
        "SELECT \n",
        "    billing_origin_product\n",
        "  , SUM(runs) AS runs_total\n",
        "  , SUM(dbu_usage) AS dbu_usage_total\n",
        "  , SUM(CASE WHEN is_serverless = true THEN runs ELSE 0 END) AS sum_serverless_run\n",
        "  , SUM(CASE WHEN is_serverless = true THEN dbu_usage ELSE 0 END) AS sum_serverless_dbu\n",
        "  , SUM(CASE WHEN is_serverless = false THEN runs ELSE 0 END) AS sum_non_serverless_run\n",
        "  , SUM(CASE WHEN is_serverless = false THEN dbu_usage ELSE 0 END) AS sum_non_serverless_dbu\n",
        "  , SUM(CASE WHEN is_serverless = true THEN runs ELSE 0 END)/SUM(runs) AS pct_serverless_runs\n",
        "  , SUM(CASE WHEN is_serverless = true THEN dbu_usage ELSE 0 END)/SUM(dbu_usage) AS pct_serverless_dbu\n",
        "FROM CTE\n",
        "GROUP BY\n",
        "billing_origin_product \n",
        "ORDER BY runs_total DESC;"
      ],
      "parameters": [
        {
          "displayName": "rollback_days",
          "keyword": "rollback_days",
          "dataType": "INTEGER",
          "defaultSelection": {
            "values": {
              "dataType": "INTEGER",
              "values": [
                {
                  "value": "30"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "e8a98fa1",
      "displayName": "waf_PE-02-_cluster_metrics",
      "queryLines": [
        "--waf_PE-02-*_cluster_metrics\n",
        "WITH usage AS (    \n",
        "  SELECT usage_metadata.cluster_id AS cluster_id, account_id, workspace_id\n",
        "  , count(*) as runs, SUM(usage_quantity) AS dbu_usage FROM system.billing.usage \n",
        "    WHERE \n",
        "     usage_date BETWEEN current_date()-30 AND current_date()\n",
        "    AND usage_metadata.cluster_id IS NOT NULL\n",
        "    GROUP BY account_id, workspace_id, usage_metadata.cluster_id\n",
        "),\n",
        "compute_met AS (\n",
        "  SELECT * FROM \n",
        "    (select  row_number() over(partition by account_id, workspace_id, cluster_id order by change_time desc) AS rn\n",
        "        , account_id, workspace_id, c.cluster_id, c.cluster_name, c.worker_node_type, worker_count, max_autoscale_workers, min_autoscale_workers\n",
        "    from system.compute.clusters c)\n",
        "  WHERE rn = 1\n",
        ")\n",
        "SELECT *, row_number() over( order by dbu_usage desc) AS rank\n",
        "FROM(\n",
        "SELECT SUM(u.dbu_usage) AS dbu_usage, SUM(u.runs) AS runs, c.cluster_id, c.cluster_name, c.worker_node_type\n",
        ",CASE WHEN ifnull(worker_count,ifnull(max_autoscale_workers,0)) > 1 THEN 'Multi-Node' ELSE 'Single-Node' END AS is_multi_worker\n",
        ", ifnull(worker_count,ifnull(max_autoscale_workers,0)) AS max_worker_count\n",
        ", CASE WHEN ifnull(c.min_autoscale_workers,0) = ifnull(c.max_autoscale_workers,0) THEN 0 ELSE 1 END AS is_autoscaling\n",
        " FROM\n",
        "usage u\n",
        "INNER JOIN\n",
        "compute_met c\n",
        "ON u.cluster_id = c.cluster_id\n",
        "AND u.account_id = c.account_id\n",
        "AND u.workspace_id = c.workspace_id\n",
        "GROUP BY\n",
        "c.cluster_id, c.cluster_name, c.worker_node_type\n",
        ",CASE WHEN ifnull(worker_count,ifnull(max_autoscale_workers,0)) > 1 THEN 'Multi-Node' ELSE 'Single-Node' END\n",
        ", ifnull(worker_count,ifnull(max_autoscale_workers,0)) \n",
        ", CASE WHEN ifnull(c.min_autoscale_workers,0) = ifnull(c.max_autoscale_workers,0) THEN 0 ELSE 1 END \n",
        ")\n"
      ]
    },
    {
      "name": "caef943a",
      "displayName": "waf_PE-02-05_python_udfs",
      "queryLines": [
        "--waf_PE-02-05_python_udfs\n",
        "SELECT COUNT(*) as count, routine_catalog as catalog_name, routine_schema AS schema_name, concat(routine_catalog,'.',routine_schema) AS full_schema\n",
        "FROM system.information_schema.routines WHERE external_language = 'Python' \n",
        "GROUP BY routine_catalog, routine_schema \n",
        "ORDER BY count DESC;"
      ]
    },
    {
      "name": "3eb728b7",
      "displayName": "waf_PE-02-06_photon_workloads",
      "queryLines": [
        "--waf_PE-02-06_photon_workloads\n",
        "WITH CTE AS (\n",
        "SELECT COUNT(*) AS runs,SUM(usage_quantity) AS dbu_usage, billing_origin_product\n",
        ", CASE WHEN sku_name LIKE '%PHOTON%' OR product_features.is_photon = true THEN true ELSE false END AS is_photon\n",
        "FROM system.billing.usage \n",
        "WHERE usage_date BETWEEN current_date()-30 AND current_date()\n",
        "AND billing_origin_product  IN ('JOBS','LAKEFLOW_CONNECT','VECTOR_SEARCH','DATABASE','DLT','ALL_PURPOSE','ONLINE_TABLES','INTERACTIVE')\n",
        "AND usage_unit = 'DBU'\n",
        "GROUP BY billing_origin_product, CASE WHEN sku_name LIKE '%PHOTON%' OR product_features.is_photon = true THEN true ELSE false END \n",
        ")\n",
        "SELECT \n",
        "    billing_origin_product\n",
        "  , SUM(runs) AS runs_total\n",
        "  , SUM(dbu_usage) AS dbu_usage_total\n",
        "  , SUM(CASE WHEN is_photon = true THEN runs ELSE 0 END) AS sum_photon_run\n",
        "  , SUM(CASE WHEN is_photon = true THEN dbu_usage ELSE 0 END) AS sum_photon_dbu\n",
        "  , SUM(CASE WHEN is_photon = false THEN runs ELSE 0 END) AS sum_non_photon_run\n",
        "  , SUM(CASE WHEN is_photon = false THEN dbu_usage ELSE 0 END) AS sum_non_photon_dbu\n",
        "  , SUM(CASE WHEN is_photon = true THEN runs ELSE 0 END)/SUM(runs) AS pct_photon_runs\n",
        "  , SUM(CASE WHEN is_photon = true THEN dbu_usage ELSE 0 END)/SUM(dbu_usage) AS pct_photon_dbu\n",
        "FROM CTE\n",
        "GROUP BY\n",
        "billing_origin_product \n",
        "ORDER BY runs_total DESC;\n"
      ]
    },
    {
      "name": "95b08392",
      "displayName": "waf_R-03-01_auto_scaling_ETL",
      "queryLines": [
        "select workspace_id, cluster_id, cluster_name, owned_by, worker_count, create_time  \n",
        "from system.compute.clusters \n",
        "where cluster_source = 'JOB'\n",
        "and create_time >= current_timestamp() - interval 7 days\n",
        "and max_autoscale_workers is null"
      ]
    },
    {
      "name": "db7bc0c3",
      "displayName": "waf_R-01-04_auto_termination",
      "queryLines": [
        "WITH all_purpose_cluster AS (\n",
        "  SELECT\n",
        "    *,\n",
        "    ROW_NUMBER() OVER(PARTITION BY workspace_id, cluster_id ORDER BY change_time DESC) as rn\n",
        "  FROM system.compute.clusters\n",
        "  WHERE cluster_source=\"UI\" OR cluster_source=\"API\"\n",
        "  QUALIFY rn=1 AND delete_time is null\n",
        ")\n",
        "\n",
        "\n",
        "SELECT   \n",
        "  workspace_id,\n",
        "  cluster_id,\n",
        "  cluster_name,\n",
        "  owned_by\n",
        "FROM all_purpose_cluster WHERE auto_termination_minutes IS NULL"
      ]
    },
    {
      "name": "ea93f04e",
      "displayName": "waf_R-01-05_model_serving",
      "queryLines": [
        "select usage_metadata.endpoint_name endpoint_name, billing_origin_product, sum(usage_quantity) usage_dbus from system.billing.usage\n",
        "WHERE sku_name LIKE '%SERVERLESS_REAL_TIME_INFERENCE%'\n",
        "AND usage_date >= current_timestamp() - interval 7 days\n",
        "AND usage_metadata.endpoint_name is not null\n",
        "group by endpoint_name, billing_origin_product\n",
        "order by usage_dbus desc"
      ]
    },
    {
      "name": "waf_co_01_02_ba132837",
      "displayName": "CO-01-02: Job vs All-Purpose Cluster Usage",
      "queryLines": [
        "\n",
        "SELECT \n",
        "  CASE \n",
        "    WHEN cluster_type = 'JOB' THEN 'Job Clusters (Cost Effective)'\n",
        "    WHEN cluster_type = 'ALL_PURPOSE' THEN 'All-Purpose (Expensive)'\n",
        "    ELSE 'Other'\n",
        "  END as cluster_category,\n",
        "  COUNT(*) as usage_count,\n",
        "  ROUND(SUM(usage_quantity * list_price), 2) as total_cost\n",
        "FROM system.billing.usage\n",
        "WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "  AND usage_type LIKE '%COMPUTE%'\n",
        "GROUP BY cluster_category\n",
        "ORDER BY total_cost DESC\n",
        "            "
      ]
    },
    {
      "name": "waf_co_01_06_f6a7b684",
      "displayName": "CO-01-06: Serverless Cost Efficiency",
      "queryLines": [
        "\n",
        "SELECT \n",
        "  CASE \n",
        "    WHEN usage_type LIKE '%SERVERLESS%' THEN 'Serverless'\n",
        "    ELSE 'Traditional'\n",
        "  END as compute_type,\n",
        "  ROUND(SUM(usage_quantity * list_price), 2) as total_cost,\n",
        "  ROUND(AVG(usage_quantity * list_price), 2) as avg_cost_per_workload\n",
        "FROM system.billing.usage\n",
        "WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "  AND usage_type LIKE '%COMPUTE%'\n",
        "GROUP BY compute_type\n",
        "            "
      ]
    },
    {
      "name": "waf_co_01_09_4d154e61",
      "displayName": "CO-01-09: Photon vs Standard Performance Cost",
      "queryLines": [
        "\n",
        "SELECT \n",
        "  CASE \n",
        "    WHEN photon_enabled = true THEN 'Photon (3x Faster)'\n",
        "    ELSE 'Standard Engine'\n",
        "  END as engine_type,\n",
        "  COUNT(*) as query_count,\n",
        "  AVG(execution_duration_ms / 1000.0) as avg_duration_seconds,\n",
        "  ROUND(SUM(usage_quantity * list_price), 2) as total_cost\n",
        "FROM system.query.history q\n",
        "JOIN system.billing.usage u ON q.workspace_id = u.workspace_id\n",
        "WHERE q.start_time >= CURRENT_DATE - INTERVAL '7' DAY\n",
        "  AND u.usage_start_time >= CURRENT_DATE - INTERVAL '7' DAY\n",
        "GROUP BY engine_type\n",
        "            "
      ]
    },
    {
      "name": "waf_co_02_01_e3330123",
      "displayName": "CO-02-01: Auto-Termination Savings",
      "queryLines": [
        "\n",
        "SELECT \n",
        "  CASE \n",
        "    WHEN auto_termination_minutes > 0 THEN 'Auto-Terminate Enabled'\n",
        "    ELSE 'No Auto-Terminate'\n",
        "  END as termination_status,\n",
        "  COUNT(DISTINCT cluster_id) as cluster_count,\n",
        "  AVG(DATEDIFF(MINUTE, start_time, end_time)) as avg_runtime_minutes,\n",
        "  ROUND(SUM(CASE WHEN state = 'RUNNING' AND DATEDIFF(MINUTE, start_time, CURRENT_TIMESTAMP) > 60 THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as idle_cluster_percent\n",
        "FROM system.compute.clusters\n",
        "WHERE start_time >= CURRENT_TIMESTAMP - INTERVAL '7' DAY\n",
        "GROUP BY termination_status\n",
        "            "
      ]
    },
    {
      "name": "c3adf755",
      "displayName": "waf_controls_p",
      "queryLines": [
        "WITH serverless_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN usage_type LIKE '%SERVERLESS%' OR sku_name LIKE '%SERVERLESS%' THEN 1 ELSE 0 END) as serverless_count\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "photon_usage AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_compute,\n",
        "    SUM(CASE WHEN product_features.is_photon = true THEN 1 ELSE 0 END) as photon_compute\n",
        "  FROM system.billing.usage\n",
        "  WHERE usage_start_time >= CURRENT_DATE - INTERVAL '30' DAY\n",
        "    AND usage_type LIKE '%COMPUTE%'\n",
        "),\n",
        "cluster_workers AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    SUM(CASE WHEN worker_count > 1 THEN 1 ELSE 0 END) as clusters_multi_worker,\n",
        "    SUM(CASE WHEN worker_count > 3 THEN 1 ELSE 0 END) as clusters_large\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "instance_variety AS (\n",
        "  SELECT \n",
        "    COUNT(*) as total_clusters,\n",
        "    COUNT(DISTINCT split(worker_node_type,'[.]')[0]) as distinct_families\n",
        "  FROM system.compute.clusters\n",
        "),\n",
        "waf_status AS (\n",
        "  SELECT\n",
        "    waf_id,\n",
        "    principle,\n",
        "    best_practice,\n",
        "    CASE \n",
        "    WHEN waf_id = 'PE-01-01' THEN (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    )\n",
        "    WHEN waf_id = 'PE-01-02' THEN (\n",
        "      CASE WHEN EXISTS (SELECT 1 FROM system.billing.usage WHERE sku_name LIKE '%SERVERLESS_REAL_TIME_INFERENCE%' LIMIT 1) THEN 100 ELSE 0 END\n",
        "    )\n",
        "    WHEN waf_id = 'PE-02-02' THEN (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_multi_worker * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    )\n",
        "    WHEN waf_id = 'PE-02-04' THEN (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_large * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    )\n",
        "    WHEN waf_id = 'PE-02-05' THEN (\n",
        "      CASE WHEN NOT EXISTS (SELECT 1 FROM system.information_schema.routines WHERE external_language = 'Python' LIMIT 1) THEN 100 ELSE 0 END\n",
        "    )\n",
        "    WHEN waf_id = 'PE-02-06' THEN (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (photon_compute * 100.0 / total_compute) ELSE 0 END FROM photon_usage\n",
        "    )\n",
        "    WHEN waf_id = 'PE-02-07' THEN (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (distinct_families * 100.0 / total_clusters) ELSE 0 END FROM instance_variety\n",
        "    )\n",
        "    ELSE 0\n",
        "    END AS current_percentage,\n",
        "    CASE \n",
        "    WHEN waf_id = 'PE-01-01' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (serverless_count * 100.0 / total_compute) ELSE 0 END FROM serverless_usage\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-01-02' AND EXISTS (\n",
        "      SELECT 1 FROM system.billing.usage WHERE sku_name LIKE '%SERVERLESS_REAL_TIME_INFERENCE%' LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-02' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_multi_worker * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-04' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (clusters_large * 100.0 / total_clusters) ELSE 0 END FROM cluster_workers\n",
        "    ) >= 50 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-05' AND NOT EXISTS (\n",
        "      SELECT 1 FROM system.information_schema.routines WHERE external_language = 'Python' LIMIT 1\n",
        "    ) THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-06' AND (\n",
        "      SELECT CASE WHEN total_compute > 0 THEN (photon_compute * 100.0 / total_compute) ELSE 0 END FROM photon_usage\n",
        "    ) >= 80 THEN 'Yes'\n",
        "    WHEN waf_id = 'PE-02-07' AND (\n",
        "      SELECT CASE WHEN total_clusters > 0 THEN (distinct_families * 100.0 / total_clusters) ELSE 0 END FROM instance_variety\n",
        "    ) >= 5 THEN 'Yes'\n",
        "    ELSE 'No'\n",
        "    END AS implemented\n",
        "  FROM (\n",
        "    SELECT * FROM VALUES\n",
        "    ('PE-01-01', 'Utilize serverless capabilities', 'Use serverless architecture'),\n",
        "    ('PE-01-02', 'Utilize serverless capabilities', 'Use an enterprise grade model serving service'),\n",
        "    ('PE-02-02', 'Design workloads for performance', 'Use parallel computation where it is beneficial'),\n",
        "    ('PE-02-04', 'Design workloads for performance', 'Prefer larger clusters'),\n",
        "    ('PE-02-05', 'Design workloads for performance', 'Use native Spark operations'),\n",
        "    ('PE-02-06', 'Design workloads for performance', 'Use native platform engines'),\n",
        "    ('PE-02-07', 'Design workloads for performance', 'Understand your hardware and workload type')\n",
        "    AS waf(waf_id, principle, best_practice)\n",
        "  )\n",
        ")\n",
        "SELECT\n",
        "  waf_id,\n",
        "  principle,\n",
        "  best_practice,\n",
        "  ROUND(current_percentage, 1) as score_percentage,\n",
        "  CASE \n",
        "  WHEN waf_id = 'PE-01-01' THEN 50\n",
        "  WHEN waf_id = 'PE-01-02' THEN 100\n",
        "  WHEN waf_id = 'PE-02-02' THEN 80\n",
        "  WHEN waf_id = 'PE-02-04' THEN 50\n",
        "  WHEN waf_id = 'PE-02-05' THEN 100\n",
        "  WHEN waf_id = 'PE-02-06' THEN 80\n",
        "  WHEN waf_id = 'PE-02-07' THEN 5\n",
        "  END as threshold_percentage,\n",
        "  CASE \n",
        "  WHEN implemented = 'Yes' THEN 'Met'\n",
        "  ELSE 'Not Met'\n",
        "  END as threshold_met,\n",
        "  implemented\n",
        "FROM waf_status\n",
        "ORDER BY principle, waf_id;\n"
      ]
    },
    {
      "name": "1327fa8d",
      "displayName": "PE-01_01_PE_02_dbu_usage",
      "queryLines": [
        "WITH PE_01 AS (\n",
        "SELECT \n",
        "    billing_origin_product\n",
        "  , SUM(runs) AS runs_total\n",
        "  , SUM(dbu_usage) AS dbu_usage_total\n",
        "  , CASE WHEN is_serverless = true THEN 'SERVERLESS' ELSE 'CLASSIC' END AS classic_or_serverless\n",
        "  , CASE WHEN is_photon = true THEN 'PHOTON' ELSE 'NON-PHOTON' END AS photon_or_non_photon\n",
        "  , CASE WHEN performance_target = 'COST_OPTIMIZED' THEN 'STANDARD' ELSE performance_target END AS performance_target\n",
        "  , CASE WHEN product_tier is null and classic_or_serverless = 'SERVERLESS' THEN 'SERVERLESS' ELSE product_tier END AS product_tier\n",
        "  , unique_id\n",
        "  , compute_id\n",
        "  , instance_pool_id\n",
        "  , workspace_id\n",
        "  , CASE WHEN instance_pool_id is null THEN 'NO' ELSE 'YES' END AS instance_pool_present\n",
        "  , 'PE_01' AS waf_id\n",
        "  , 'Detailed' AS dataset_type\n",
        "  \n",
        "FROM \n",
        "(SELECT \n",
        "   COUNT(*) AS runs\n",
        "  ,SUM(usage_quantity) AS dbu_usage, \n",
        "   CASE WHEN billing_origin_product = 'ALL_PURPOSE' THEN 'INTERACTIVE' \n",
        "        WHEN billing_origin_product = 'DATABASE' THEN 'LAKEBASE' \n",
        "        WHEN billing_origin_product = 'DLT' THEN 'SDP'\n",
        "        ELSE billing_origin_product END AS billing_origin_product\n",
        "  ,CASE WHEN sku_name LIKE '%SERVERLESS%' OR product_features.is_serverless = true THEN true ELSE false END AS is_serverless\n",
        "  ,CASE WHEN sku_name LIKE '%PHOTON%' OR product_features.is_photon = true THEN true ELSE false END AS is_photon\n",
        "  ,CASE WHEN product_features.performance_target IS NULL THEN 'UNDEFINED' ELSE product_features.performance_target END AS performance_target\n",
        "  ,coalesce(product_features.jobs_tier,product_features.sql_tier,product_features.dlt_tier) AS product_tier\n",
        "  ,coalesce(usage_metadata.job_id,usage_metadata.dlt_pipeline_id) AS unique_id\n",
        "  ,coalesce(usage_metadata.cluster_id,usage_metadata.warehouse_id) AS compute_id\n",
        "  ,usage_metadata.instance_pool_id AS instance_pool_id\n",
        "  ,workspace_id\n",
        " FROM system.billing.usage \n",
        " WHERE usage_date BETWEEN current_date() - INTERVAL 90 DAY  AND current_date()\n",
        " AND --array_contains(:workspace_id,workspace_id) AND \n",
        " usage_unit = 'DBU'\n",
        " AND billing_origin_product IN ('LAKEFLOW_CONNECT','DATA_QUALITY_MONITORING','PREDICTIVE_OPTIMIZATION','DATABASE','APPS','VECTOR_SEARCH','JOBS','MODEL_SERVING','LAKEFLOW_CONNECT','SQL','INTERACTIVE','DLT','ALL_PURPOSE')\n",
        " GROUP BY CASE WHEN billing_origin_product = 'ALL_PURPOSE' THEN 'INTERACTIVE' \n",
        "               WHEN billing_origin_product = 'DATABASE' THEN 'LAKEBASE'  \n",
        "              WHEN billing_origin_product = 'DLT' THEN 'SDP'\n",
        "          ELSE billing_origin_product END\n",
        "          , workspace_id\n",
        "          , CASE WHEN sku_name LIKE '%SERVERLESS%' OR product_features.is_serverless = true THEN true ELSE false END\n",
        "          ,CASE WHEN sku_name LIKE '%PHOTON%' OR product_features.is_photon = true THEN true ELSE false END\n",
        "          ,CASE WHEN product_features.performance_target IS NULL THEN 'UNDEFINED' ELSE product_features.performance_target END\n",
        "          ,coalesce(product_features.jobs_tier,product_features.sql_tier,product_features.dlt_tier)\n",
        "          ,coalesce(usage_metadata.job_id,usage_metadata.dlt_pipeline_id)\n",
        "          ,coalesce(usage_metadata.cluster_id,usage_metadata.warehouse_id)\n",
        "          ,usage_metadata.instance_pool_id \n",
        ")CTE\n",
        "GROUP BY\n",
        "billing_origin_product,workspace_id,is_serverless,is_photon,performance_target,product_tier,unique_id,compute_id,instance_pool_id\n",
        "),\n",
        "compute_met AS (\n",
        "  SELECT * FROM \n",
        "    (select  row_number() over(partition by account_id, workspace_id, cluster_id order by change_time desc) AS rn\n",
        "        , account_id\n",
        "        , workspace_id\n",
        "        , c.cluster_id\n",
        "        , c.cluster_name\n",
        "        , c.worker_node_type\n",
        "        , worker_count\n",
        "        , max_autoscale_workers\n",
        "        , min_autoscale_workers\n",
        "        , CASE WHEN auto_termination_minutes IS NULL THEN 0 ELSE 1 END AS is_auto_terminated\n",
        "        , cluster_source\n",
        "        \n",
        "    from system.compute.clusters c \n",
        "    WHERE --array_contains(:workspace_id,workspace_id)\n",
        "     change_date <= current_date()) --TBD to check this filter\n",
        "    WHERE rn = 1\n",
        ")\n",
        "SELECT\n",
        "  waf_id,\n",
        "  dataset_type,\n",
        "  billing_origin_product,\n",
        "  CASE WHEN ifnull(CM.min_autoscale_workers,0) = ifnull(CM.max_autoscale_workers,0) THEN 0 ELSE 1 END AS is_autoscaling,\n",
        "  worker_count,\n",
        "  usage.workspace_id,\n",
        "  runs_total,\n",
        "  dbu_usage_total, \n",
        "  classic_or_serverless,\n",
        "  photon_or_non_photon,\n",
        "  performance_target,\n",
        "  product_tier,\n",
        "  unique_id,\n",
        "  compute_id,\n",
        "  cluster_source,\n",
        "  instance_pool_id,\n",
        "  instance_pool_present\n",
        "FROM PE_01 usage\n",
        "LEFT JOIN\n",
        "compute_met CM\n",
        "ON CM.cluster_id = usage.compute_id\n",
        "AND CM.workspace_id = usage.workspace_id\n",
        "ORDER BY dbu_usage_total DESC\n"
      ]
    },
    {
      "name": "6576f362",
      "displayName": "PE-01-02_R-01-05_serving_usage",
      "queryLines": [
        "SELECT \n",
        "    AVG(input_token_count) AS avg_input_token\n",
        "  , AVG(output_token_count) AS avg_output_token\n",
        "  , COUNT(1) AS number_requests\n",
        "  , eu.workspace_id\n",
        "  , se.entity_type\n",
        "  , se.entity_name\n",
        "  , se.custom_model_config.min_concurrency AS custom_model_min_concurrency\n",
        "  , se.custom_model_config.max_concurrency AS custom_model_max_concurrency\n",
        "  , se.custom_model_config.compute_type AS custom_model_compute_type\n",
        "  , CASE WHEN se.entity_type = 'CUSTOM_MODEL' THEN se.endpoint_name ELSE '' END AS endpoint_name \n",
        "  , SUM(bu.dbu) AS dbu\n",
        " FROM system.serving.endpoint_usage eu\n",
        "INNER JOIN system.serving.served_entities se\n",
        "ON eu.served_entity_id = se.served_entity_id\n",
        "LEFT JOIN \n",
        "(SELECT \n",
        "    SUM(usage_quantity) AS dbu\n",
        "  ,  workspace_id\n",
        "  , usage_metadata.endpoint_id As endpoint_id\n",
        "FROM system.billing.usage\n",
        "WHERE billing_origin_product = 'MODEL_SERVING'\n",
        "AND usage_date BETWEEN current_date() - INTERVAL 90 DAY  AND current_date()\n",
        "--AND array_contains(:workspace_id,workspace_id)\n",
        "AND usage_metadata.endpoint_id IS NOT NULL \n",
        "AND usage_unit = 'DBU'\n",
        "GROUP BY\n",
        "    workspace_id\n",
        "  , usage_metadata.endpoint_id\n",
        ")bu\n",
        "ON    eu.workspace_id = bu.workspace_id \n",
        "  AND se.endpoint_id = bu.endpoint_id\n",
        "WHERE request_time BETWEEN current_date() - INTERVAL 90 DAY  AND current_date()\n",
        "--AND array_contains(:workspace_id,eu.workspace_id)\n",
        "AND eu.status_code = 200\n",
        "AND entity_type IN ('FOUNDATION_MODEL','CUSTOM_MODEL')\n",
        "GROUP BY \n",
        "    eu.workspace_id\n",
        "  , se.entity_type\n",
        "  , se.entity_name\n",
        "  , se.custom_model_config.min_concurrency\n",
        "  , se.custom_model_config.max_concurrency\n",
        "  , se.custom_model_config.compute_type\n",
        "  , CASE WHEN se.entity_type = 'CUSTOM_MODEL' THEN se.endpoint_name ELSE '' END\n",
        "\n",
        "ORDER BY dbu DESC\n",
        "\n"
      ]
    },
    {
      "name": "c3a6d1af",
      "displayName": "PE_02_04_query_history",
      "queryLines": [
        "SELECT\n",
        "  compute.warehouse_id AS warehouse_id,\n",
        "  workspace_id,\n",
        "  account_id,\n",
        "  COUNT(*) AS total_queries,\n",
        "  MAX(COALESCE(waiting_at_capacity_duration_ms, 0) ) / 1000 AS max_queue_time_seconds,\n",
        "  AVG(COALESCE(waiting_at_capacity_duration_ms, 0) ) / 1000 AS avg_queue_time_seconds\n",
        "FROM system.query.history\n",
        "WHERE compute.type = 'WAREHOUSE'\n",
        "AND end_time BETWEEN current_date() - INTERVAL 90 DAY  AND current_date()\n",
        "--AND array_contains(:workspace_id,workspace_id)\n",
        "\n",
        "GROUP BY \n",
        "   compute.warehouse_id\n",
        "  ,workspace_id\n",
        "  ,account_id\n",
        "ORDER BY avg_queue_time_seconds DESC"
      ]
    },
    {
      "name": "c4255501",
      "displayName": "Count of table formats with table types",
      "queryLines": [
        "SELECT\n",
        "  COUNT(*) AS count_of_tables,\n",
        "  table_type,\n",
        "  data_source_format,\n",
        "  CASE WHEN data_source_format NOT IN ('DELTA','ICEBERG') THEN 'OTHERS' ELSE data_source_format END AS data_lake_format\n",
        "\n",
        "FROM\n",
        "  system.information_schema.tables\n",
        "GROUP BY\n",
        "  table_type,\n",
        "  data_source_format"
      ]
    },
    {
      "name": "d33a3398",
      "displayName": "Count of table formats with table types",
      "queryLines": [
        "SELECT\n",
        "  COUNT(*) AS count_of_tables,\n",
        "  table_type,\n",
        "  data_source_format,\n",
        "  CASE WHEN data_source_format NOT IN ('DELTA','ICEBERG') THEN 'OTHERS' ELSE data_source_format END AS data_lake_format\n",
        "\n",
        "FROM\n",
        "  system.information_schema.tables\n",
        "GROUP BY\n",
        "  table_type,\n",
        "  data_source_format"
      ]
    },
    {
      "name": "1954cef2",
      "displayName": "waf_CO-01-09_jobs_photon",
      "queryLines": [
        "select ju.usage_metadata.cluster_id,\n",
        "c.cluster_name,\n",
        "ju.product_features.is_photon, \n",
        "sum(ju.usage_quantity) as dbu \n",
        "from system.billing.usage ju \n",
        "join system.compute.clusters c on c.cluster_id = ju.usage_metadata.cluster_id\n",
        "-- join system.lakeflow.jobs j on j.job_id = ju.usage_metadata.job_id\n",
        "where ju.usage_date BETWEEN current_date() - interval 90 days AND current_date()\n",
        "--  AND array_contains(:workspace_id,ju.workspace_id)\n",
        "and ju.billing_origin_product in (\"JOBS\")\n",
        "and ju.product_features.is_serverless = false\n",
        "group by 1,2,3\n"
      ]
    },
    {
      "name": "cd07a984",
      "displayName": "waf_CO-01-09_jobs_serverless_performance",
      "queryLines": [
        "select 'Coming soon...' as message"
      ]
    },
    {
      "name": "fbc6ed5e",
      "displayName": "waf_CO-02-01_AP_auto_scaling",
      "queryLines": [
        "select workspace_id,cluster_id,cluster_name\n",
        ", max_autoscale_workers\n",
        ",case when max_autoscale_workers is null then \"Autoscaling Disabled\" else \"Autoscaling Enabled\" end as autoscaling_enabled\n",
        "from system.compute.clusters\n",
        "qualify\n",
        "ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, cluster_id ORDER BY change_time DESC) = 1\n",
        "and delete_time is null \n",
        "--  AND array_contains(:workspace_id,workspace_id)\n",
        "and cluster_source in (\"API\", \"UI\")"
      ]
    },
    {
      "name": "4858cc4e",
      "displayName": "waf_CO-02-01_warehouse_auto_scaling",
      "queryLines": [
        "SELECT\n",
        "    warehouse_id,\n",
        "    warehouse_name,\n",
        "    warehouse_type,\n",
        "    warehouse_size,\n",
        "    min_clusters,\n",
        "    max_clusters,\n",
        "    case when max_clusters > min_clusters then 'Yes' else 'No' end as autoscaling_enabled\n",
        "FROM\n",
        "    system.compute.warehouses\n",
        "QUALIFY\n",
        "    ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, warehouse_id ORDER BY change_time DESC) = 1\n",
        "    and delete_time is null\n",
        "    -- AND array_contains(:workspace_id,workspace_id)"
      ]
    },
    {
      "name": "809dc7c9",
      "displayName": "waf_CO-02-01_jobs_auto_scaling",
      "queryLines": [
        "select workspace_id,cluster_id,cluster_name\n",
        ", max_autoscale_workers\n",
        ",case when max_autoscale_workers is null then \"No\" else \"Yes\" end as autoscaling_enabled\n",
        "from system.compute.clusters\n",
        "qualify\n",
        "ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, cluster_id ORDER BY change_time DESC) = 1\n",
        "and delete_time is null \n",
        "and cluster_source in (\"JOB\")\n",
        "--  AND array_contains(:workspace_id,workspace_id)\n"
      ]
    },
    {
      "name": "fd056256",
      "displayName": "waf_CO-02-01_model_serving_auto_scaling",
      "queryLines": [
        "select 'Coming soon...' as message"
      ]
    },
    {
      "name": "07c3451a",
      "displayName": "waf_CO-02-02_warehouse_auto_termination 1",
      "queryLines": [
        "SELECT\n",
        "    warehouse_id,\n",
        "    warehouse_name,\n",
        "    warehouse_type,\n",
        "    warehouse_size,\n",
        "    case when auto_stop_minutes is not null then 'Yes' else 'No' end as autotermination_enabled\n",
        "FROM\n",
        "    system.compute.warehouses\n",
        "QUALIFY\n",
        "    ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, warehouse_id ORDER BY change_time DESC) = 1\n",
        "    and delete_time is null\n",
        "--  AND array_contains(:workspace_id,workspace_id)\n"
      ]
    },
    {
      "name": "98c1b821",
      "displayName": "waf_CO-02-03_AP_policy",
      "queryLines": [
        "select workspace_id,cluster_id,cluster_name\n",
        ",policy_id\n",
        ",case when policy_id is null then \"No\" else \"Yes\" end as cluster_policy\n",
        "from system.compute.clusters\n",
        "qualify\n",
        "ROW_NUMBER() OVER (PARTITION BY account_id, workspace_id, cluster_id ORDER BY change_time DESC) = 1\n",
        "and delete_time is null \n",
        "and cluster_source in (\"API\", \"UI\")\n",
        "--  AND array_contains(:workspace_id,workspace_id)\n"
      ]
    }
  ],
  "pages": [
    {
      "name": "3f38204d",
      "displayName": "Summary",
      "layout": [
        {
          "widget": {
            "name": "2ca8f2ea",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "b39d7f91",
                  "fields": [
                    {
                      "name": "sum(completion_percent)",
                      "expression": "SUM(`completion_percent`)"
                    },
                    {
                      "name": "pillar",
                      "expression": "`pillar`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "sum(completion_percent)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Sum of completion_percent"
                },
                "y": {
                  "fieldName": "pillar",
                  "scale": {
                    "type": "categorical",
                    "sort": {
                      "by": "x-reversed"
                    }
                  },
                  "displayName": "pillar"
                }
              },
              "frame": {
                "title": "Completion percentage across pillars",
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "5c1053c3",
            "multilineTextboxSpec": {
              "lines": [
                "WAF Coverage\n"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 6,
            "height": 2
          }
        }
      ],
      "pageType": "PAGE_TYPE_CANVAS"
    },
    {
      "name": "e9e15078",
      "displayName": "Data And AI Governance",
      "layout": [
        {
          "widget": {
            "name": "ec3a56bc",
            "multilineTextboxSpec": {
              "lines": [
                "# Data And AI Governance"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 12,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "d682affb",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "303a6758",
                  "fields": [
                    {
                      "name": "count(1)",
                      "expression": "`count(1)`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "count(1)",
                  "style": {
                    "rules": [
                      {
                        "condition": {
                          "operator": "=",
                          "operand": {
                            "type": "data-value",
                            "value": "0"
                          }
                        },
                        "color": "#888888"
                      }
                    ]
                  },
                  "displayName": "count(1)"
                }
              },
              "frame": {
                "showTitle": true,
                "showDescription": false,
                "title": "Total Tables"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 16,
            "width": 4,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "f0321af0",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "f5bf425c",
                  "fields": [
                    {
                      "name": "count(1)",
                      "expression": "`count(1)`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "count(1)",
                  "style": {
                    "rules": [
                      {
                        "condition": {
                          "operator": "=",
                          "operand": {
                            "type": "data-value",
                            "value": "0"
                          }
                        },
                        "color": "#888888"
                      }
                    ]
                  },
                  "displayName": "count(1)"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Total Volumes",
                "contentAlignment": "center"
              }
            }
          },
          "position": {
            "x": 4,
            "y": 16,
            "width": 4,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "ee5b3bb1",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "5fdcd556",
                  "fields": [
                    {
                      "name": "count(1)",
                      "expression": "`count(1)`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "count(1)",
                  "style": {
                    "rules": [
                      {
                        "condition": {
                          "operator": "=",
                          "operand": {
                            "type": "data-value",
                            "value": "0"
                          }
                        },
                        "color": "#888888"
                      }
                    ]
                  },
                  "displayName": "count(1)"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Total Functions"
              }
            }
          },
          "position": {
            "x": 8,
            "y": 16,
            "width": 4,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "33abd742",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "a92ace17",
                  "fields": [
                    {
                      "name": "full_name_count",
                      "expression": "`full_name_count`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "full_name_count",
                  "displayName": "full_name_count"
                }
              },
              "frame": {
                "showTitle": true,
                "showDescription": true,
                "description": "See the count of tables with no reads",
                "title": "Unused Tables (Last 30 Days)"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 26,
            "width": 4,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "bb0b2fd5",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "55e66413",
                  "fields": [
                    {
                      "name": "distinct_tables",
                      "expression": "`distinct_tables`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "distinct_tables",
                  "style": {
                    "rules": [
                      {
                        "condition": {
                          "operator": "=",
                          "operand": {
                            "type": "data-value",
                            "value": "0"
                          }
                        },
                        "color": "#888888"
                      }
                    ]
                  },
                  "displayName": "distinct_tables"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Active Tables (Last 30 days)",
                "showDescription": true,
                "description": "See the count of tables with reads"
              }
            }
          },
          "position": {
            "x": 4,
            "y": 26,
            "width": 4,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "7414554c",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "90d7e6f1",
                  "fields": [
                    {
                      "name": "distinct_users",
                      "expression": "`distinct_users`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "distinct_users",
                  "style": {
                    "rules": [
                      {
                        "condition": {
                          "operator": "=",
                          "operand": {
                            "type": "data-value",
                            "value": "0"
                          }
                        },
                        "color": "#000000"
                      }
                    ]
                  },
                  "displayName": "distinct_users"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Active Users (Last 30 Days)",
                "showDescription": true,
                "description": "See the count of users who read from tables"
              }
            }
          },
          "position": {
            "x": 8,
            "y": 26,
            "width": 4,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "bdaa8aa0",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "628c2773",
                  "fields": [
                    {
                      "name": "full_name_count",
                      "expression": "`full_name_count`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "full_name_count",
                  "displayName": "full_name_count"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Ungoverned Tables",
                "showDescription": true,
                "description": "See the count of tables to which all users have read access"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 36,
            "width": 6,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "e60dfd50",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1f951287",
                  "fields": [
                    {
                      "name": "distinct_table_count",
                      "expression": "`distinct_table_count`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "distinct_table_count",
                  "displayName": "distinct_table_count"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Sensitive Tables",
                "showDescription": true,
                "description": "See the count of tables with either row filters or column masks"
              }
            }
          },
          "position": {
            "x": 6,
            "y": 36,
            "width": 6,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "4a969668",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "763a2da9",
                  "fields": [
                    {
                      "name": "sum(read_count)",
                      "expression": "SUM(`read_count`)"
                    },
                    {
                      "name": "table_full_name",
                      "expression": "`table_full_name`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "sum(read_count)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Usage Count"
                },
                "y": {
                  "fieldName": "table_full_name",
                  "scale": {
                    "type": "categorical",
                    "sort": {
                      "by": "x-reversed"
                    }
                  },
                  "displayName": "Table Name"
                },
                "label": {
                  "show": false
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Most Popular Tables",
                "showDescription": true,
                "description": "Identify the 10 most read from tables and see when they were last written to"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 29,
            "width": 12,
            "height": 7
          }
        },
        {
          "widget": {
            "name": "f9046177",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "8d97349c",
                  "fields": [
                    {
                      "name": "monthly(usage_date)",
                      "expression": "DATE_TRUNC(\"MONTH\", `usage_date`)"
                    },
                    {
                      "name": "sum(usage_count)",
                      "expression": "SUM(`usage_count`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "monthly(usage_date)",
                  "scale": {
                    "type": "temporal"
                  },
                  "displayName": "Period"
                },
                "y": {
                  "fieldName": "sum(usage_count)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Read Events"
                }
              },
              "frame": {
                "showTitle": true,
                "showDescription": true,
                "title": "Table Usage (Last 12 Months)",
                "description": "See read events for tables over time"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 19,
            "width": 12,
            "height": 7
          }
        },
        {
          "widget": {
            "name": "b78ba2ba",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1eab9fe1",
                  "fields": [
                    {
                      "name": "score_percentage",
                      "expression": "`score_percentage`"
                    },
                    {
                      "name": "threshold_percentage",
                      "expression": "`threshold_percentage`"
                    },
                    {
                      "name": "threshold_met",
                      "expression": "`threshold_met`"
                    },
                    {
                      "name": "waf_id",
                      "expression": "`waf_id`"
                    },
                    {
                      "name": "principle",
                      "expression": "`principle`"
                    },
                    {
                      "name": "description",
                      "expression": "`description`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 1,
              "invisibleColumns": [
                {
                  "booleanValues": [
                    "false",
                    "true"
                  ],
                  "imageUrlTemplate": "{{ @ }}",
                  "imageTitleTemplate": "{{ @ }}",
                  "imageWidth": "",
                  "imageHeight": "",
                  "linkUrlTemplate": "{{ @ }}",
                  "linkTextTemplate": "{{ @ }}",
                  "linkTitleTemplate": "{{ @ }}",
                  "linkOpenInNewTab": true,
                  "name": "implemented",
                  "type": "string",
                  "displayAs": "string",
                  "order": 4,
                  "title": "implemented",
                  "allowSearch": false,
                  "alignContent": "left",
                  "allowHTML": false,
                  "highlightLinks": false,
                  "useMonospaceFont": false,
                  "preserveWhitespace": false
                }
              ],
              "allowHTMLByDefault": false,
              "itemsPerPage": 25,
              "paginationSize": "default",
              "condensed": true,
              "withRowNumber": false,
              "frame": {
                "title": "WAF Controls Table",
                "showTitle": true
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "score_percentage",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "decimal",
                    "displayAs": "number",
                    "visible": true,
                    "order": 0,
                    "title": "score_percentage",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "threshold_percentage",
                    "numberFormat": "0",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "integer",
                    "displayAs": "number",
                    "visible": true,
                    "order": 1,
                    "title": "threshold_percentage",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "threshold_met",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 2,
                    "title": "threshold_met",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "waf_id",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 3,
                    "title": "waf_id",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "principle",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 5,
                    "title": "principle",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "description",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 6,
                    "title": "description",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 10,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "ca7cc5ad",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "95258030",
                  "fields": [
                    {
                      "name": "sum(completion_percent)",
                      "expression": "SUM(`completion_percent`)"
                    },
                    {
                      "name": "principle",
                      "expression": "`principle`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "sum(completion_percent)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Sum of completion_percent"
                },
                "y": {
                  "fieldName": "principle",
                  "scale": {
                    "type": "categorical",
                    "sort": {
                      "by": "x-reversed"
                    }
                  },
                  "displayName": "principle"
                }
              },
              "frame": {
                "title": "Completion percentage of implemented controls per principle",
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 4,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "4b2ce052",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "920a8759",
                  "fields": [
                    {
                      "name": "avg(completion_percent)",
                      "expression": "AVG(`completion_percent`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "avg(completion_percent)",
                  "displayName": "Average completion_percent"
                }
              },
              "frame": {
                "title": "Completion Percentage",
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 2,
            "width": 12,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "afce077c",
            "multilineTextboxSpec": {
              "lines": [
                "### Principle"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 39,
            "width": 2,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "5938b707",
            "multilineTextboxSpec": {
              "lines": [
                "### Signal"
              ]
            }
          },
          "position": {
            "x": 2,
            "y": 39,
            "width": 10,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "00d40a61",
            "multilineTextboxSpec": {
              "lines": [
                "#### DG-01-03\n",
                "&nbsp;\n",
                "\n",
                "**Track [data and AI lineage](https://docs.databricks.com/aws/en/data-governance/unity-catalog/data-lineage) to drive visibility of the data**\n",
                "\n",
                "1. Are you using unity catalog to access data in order to track lineage?\n",
                "\n",
                "2. Are you using unity catalog to register your models?"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 40,
            "width": 2,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "e4d9261a",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "8486d58c",
                  "fields": [
                    {
                      "name": "sum(total_tables)",
                      "expression": "SUM(`total_tables`)"
                    },
                    {
                      "name": "sum(lineage_tables)",
                      "expression": "SUM(`lineage_tables`)"
                    },
                    {
                      "name": "table_type",
                      "expression": "`table_type`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fields": [
                    {
                      "fieldName": "sum(total_tables)",
                      "displayName": "Sum of total_tables"
                    },
                    {
                      "fieldName": "sum(lineage_tables)",
                      "displayName": "Sum of lineage_tables"
                    }
                  ],
                  "scale": {
                    "type": "quantitative"
                  }
                },
                "y": {
                  "fieldName": "table_type",
                  "scale": {
                    "type": "categorical"
                  },
                  "displayName": "table_type"
                }
              },
              "frame": {
                "showDescription": true,
                "description": "Objects with captured lineage information",
                "title": "Comparison",
                "showTitle": true
              },
              "mark": {
                "layout": "group"
              }
            }
          },
          "position": {
            "x": 2,
            "y": 40,
            "width": 10,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "320b2a12",
            "multilineTextboxSpec": {
              "lines": [
                "#### DG-01-04\n",
                "&nbsp;\n",
                "\n",
                "**Add consistent descriptions to your metadata**\n",
                "\n",
                "Are you adding comments to your objects?\n"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 47,
            "width": 2,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "50d62bb0",
            "multilineTextboxSpec": {
              "lines": [
                "---"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 46,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "71c7137f",
            "multilineTextboxSpec": {
              "lines": [
                "---"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 53,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "b7a1c2ed",
            "multilineTextboxSpec": {
              "lines": [
                "#### DG-01-05\n",
                "&nbsp;\n",
                "\n",
                "**Allow easy data discovery for data consumers**\n",
                "\n",
                "Are you adding tags to your objects?\n"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 54,
            "width": 2,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "5373c79b",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "913b3827",
                  "fields": [
                    {
                      "name": "sum(count)",
                      "expression": "SUM(`count`)"
                    },
                    {
                      "name": "label",
                      "expression": "`label`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(count)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": " "
                },
                "color": {
                  "fieldName": "label",
                  "scale": {
                    "type": "categorical",
                    "mappings": [
                      {
                        "value": "Untagged",
                        "color": "#919191"
                      },
                      {
                        "value": "Tagged",
                        "color": "#00A972"
                      }
                    ]
                  },
                  "displayName": "Legend"
                },
                "label": {
                  "show": true
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Table Tag Usage",
                "showDescription": false,
                "description": "See the breakdown of tagged and untagged tables"
              }
            }
          },
          "position": {
            "x": 2,
            "y": 54,
            "width": 4,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "59d1606b",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "788914b8",
                  "fields": [
                    {
                      "name": "sum(usage_count)",
                      "expression": "SUM(`usage_count`)"
                    },
                    {
                      "name": "tag_name",
                      "expression": "`tag_name`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "sum(usage_count)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Usage Count"
                },
                "y": {
                  "fieldName": "tag_name",
                  "scale": {
                    "type": "categorical",
                    "sort": {
                      "by": "x-reversed"
                    }
                  },
                  "displayName": "Tag Name"
                },
                "label": {
                  "show": false
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Most Popular Table Tags",
                "showDescription": false,
                "description": ""
              },
              "mark": {
                "colors": [
                  "#AB4057",
                  "#FFAB00",
                  "#00A972",
                  "#FF3621",
                  "#8BCAE7",
                  "#AB4057",
                  "#99DDB4",
                  "#FCA4A1",
                  "#919191",
                  "#BF7080"
                ]
              }
            }
          },
          "position": {
            "x": 6,
            "y": 54,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "c6204dab",
            "multilineTextboxSpec": {
              "lines": [
                "---"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 60,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "764be487",
            "multilineTextboxSpec": {
              "lines": [
                "#### DG-02-01\n",
                "&nbsp;\n",
                "\n",
                "**Centralize access control for all data and AI assets**\n",
                "\n",
                "1. Are you using row level filters?\n",
                "\n",
                "2. Are you using column masking?\n"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 61,
            "width": 2,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "f7938519",
            "multilineTextboxSpec": {
              "lines": [
                "---"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 67,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "b2b6be1d",
            "multilineTextboxSpec": {
              "lines": [
                "#### DG-02-02\n",
                "&nbsp;\n",
                "\n",
                "**Configure audit logging**\n",
                "\n",
                "\n",
                "\n",
                "Are you aware of how to audit events?"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 68,
            "width": 2,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "f1234e40",
            "multilineTextboxSpec": {
              "lines": [
                "---"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 74,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "af95532b",
            "multilineTextboxSpec": {
              "lines": [
                "#### DG-02-03\n",
                "&nbsp;\n",
                "\n",
                "**Audit data platform events**\n",
                "\n",
                "1. Do you use delta shares?\n",
                "2. Are you aware of how to track data requests for your published assets?\n",
                "\n"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 75,
            "width": 2,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "6275cccb",
            "multilineTextboxSpec": {
              "lines": [
                "---"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 81,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "7b489f51",
            "multilineTextboxSpec": {
              "lines": [
                "#### DG-03-02\n",
                "&nbsp;\n",
                "\n",
                "**Use data quality tools for profiling, cleansing, validating, and monitoring data**\n",
                "\n",
                "1. Are you using expectations in Lakeflow Declarative Pipelines?\n",
                "\n",
                "2. Are you leveraging Lakehouse Monitoring?\n"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 82,
            "width": 2,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "57b77b61",
            "multilineTextboxSpec": {
              "lines": [
                "---"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 88,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "3a71edd7",
            "multilineTextboxSpec": {
              "lines": [
                "#### DG-03-03\n",
                "&nbsp;\n",
                "\n",
                "**Implement and enforce standardized data formats and definitions**\n",
                "\n",
                "What type of data formats are you using today?\n",
                "\n"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 89,
            "width": 2,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "dfe2f7a1",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "16facbed",
                  "fields": [
                    {
                      "name": "sum(count_of_tables)",
                      "expression": "SUM(`count_of_tables`)"
                    },
                    {
                      "name": "data_source_format",
                      "expression": "`data_source_format`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(count_of_tables)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Sum of count_of_tables"
                },
                "color": {
                  "fieldName": "data_source_format",
                  "scale": {
                    "type": "categorical"
                  },
                  "displayName": "data_source_format"
                }
              },
              "frame": {
                "title": "Distribution",
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 2,
            "y": 89,
            "width": 4,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "1a05ee4a",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "16facbed",
                  "fields": [
                    {
                      "name": "table_type",
                      "expression": "`table_type`"
                    },
                    {
                      "name": "data_source_format",
                      "expression": "`data_source_format`"
                    },
                    {
                      "name": "sum(count_of_tables)",
                      "expression": "SUM(`count_of_tables`)"
                    }
                  ],
                  "cubeGroupingSets": {
                    "sets": [
                      {
                        "fieldNames": [
                          "table_type"
                        ]
                      },
                      {
                        "fieldNames": [
                          "data_source_format"
                        ]
                      }
                    ]
                  },
                  "disaggregated": false,
                  "orders": [
                    {
                      "direction": "ASC",
                      "expression": "`table_type`"
                    },
                    {
                      "direction": "ASC",
                      "expression": "`data_source_format`"
                    }
                  ]
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "pivot",
              "encodings": {
                "rows": [
                  {
                    "fieldName": "table_type",
                    "displayName": "table_type"
                  }
                ],
                "columns": [
                  {
                    "fieldName": "data_source_format",
                    "displayName": "data_source_format"
                  }
                ],
                "cell": {
                  "type": "multi-cell",
                  "fields": [
                    {
                      "fieldName": "sum(count_of_tables)",
                      "cellType": "text",
                      "displayName": "Sum of count_of_tables"
                    }
                  ]
                }
              }
            }
          },
          "position": {
            "x": 6,
            "y": 89,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "8de06bb7",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "16facbed",
                  "fields": [
                    {
                      "name": "count_of_tables",
                      "expression": "`count_of_tables`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`table_type` IN ('STREAMING_TABLE')"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "count_of_tables",
                  "displayName": "count_of_tables"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Streaming Tables",
                "showDescription": true,
                "description": "See the count of Streaming Tables"
              }
            }
          },
          "position": {
            "x": 2,
            "y": 82,
            "width": 4,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "b4791872",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "16facbed",
                  "fields": [
                    {
                      "name": "count_of_tables",
                      "expression": "`count_of_tables`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`table_type` IN ('MATERIALIZED_VIEW')"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "count_of_tables",
                  "displayName": "count_of_tables"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Materialized Views",
                "showDescription": true,
                "description": "See the count of materialized views"
              }
            }
          },
          "position": {
            "x": 2,
            "y": 85,
            "width": 4,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "b8c4d566",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "f7dd8a02",
                  "fields": [
                    {
                      "name": "count_tables",
                      "expression": "`count_tables`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "count_tables",
                  "displayName": "count_tables"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Lakehouse Monitoring",
                "showDescription": true,
                "description": "See the count of drift metrics or profile metrics tables"
              }
            }
          },
          "position": {
            "x": 6,
            "y": 82,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "6bd69b8f",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1ab4ec65",
                  "fields": [
                    {
                      "name": "sum(cnt)",
                      "expression": "SUM(`cnt`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Delta share events in the last 30 days"
              },
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "sum(cnt)"
                }
              }
            }
          },
          "position": {
            "x": 2,
            "y": 75,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "c4b3d045",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "5b3944b6",
                  "fields": [
                    {
                      "name": "audit_level",
                      "expression": "`audit_level`"
                    },
                    {
                      "name": "sum(count_of_events)",
                      "expression": "SUM(`count_of_events`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "audit_level",
                  "scale": {
                    "type": "categorical",
                    "sort": {
                      "by": "y-reversed"
                    }
                  },
                  "displayName": "audit_level"
                },
                "y": {
                  "fieldName": "sum(count_of_events)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Sum of count_of_events"
                }
              },
              "frame": {
                "title": "Count of audit events by type (Last 30 days)",
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 2,
            "y": 68,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "3a695476",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "5b3944b6",
                  "fields": [
                    {
                      "name": "sum(count_of_events)",
                      "expression": "SUM(`count_of_events`)"
                    },
                    {
                      "name": "workspace_id",
                      "expression": "`workspace_id`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`workspace_id` NOT IN ('0')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "sum(count_of_events)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "title": "Count of Events"
                  },
                  "displayName": "Count of Events"
                },
                "y": {
                  "fieldName": "workspace_id",
                  "scale": {
                    "type": "categorical",
                    "sort": {
                      "by": "x-reversed"
                    }
                  },
                  "axis": {
                    "title": "Workspace ID"
                  },
                  "displayName": "Workspace ID"
                }
              },
              "frame": {
                "title": "Most popular workspace (Last 30 days)",
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 8,
            "y": 68,
            "width": 4,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "b21db0e5",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "6b0c95c6",
                  "fields": [
                    {
                      "name": "sum(count)",
                      "expression": "SUM(`count`)"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`object_type` IN ('row_filters')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "sum(count)",
                  "displayName": "Sum of count"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Number of total row filters"
              }
            }
          },
          "position": {
            "x": 2,
            "y": 61,
            "width": 4,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "34358997",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "6b0c95c6",
                  "fields": [
                    {
                      "name": "object_type",
                      "expression": "`object_type`"
                    },
                    {
                      "name": "sum(count)",
                      "expression": "SUM(`count`)"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`object_type` IN ('column_masks', 'table_with_masks')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "object_type",
                  "scale": {
                    "type": "categorical"
                  },
                  "axis": {
                    "hideTitle": true
                  },
                  "displayName": "object_type"
                },
                "y": {
                  "fieldName": "sum(count)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "title": "Count"
                  },
                  "displayName": "Count"
                },
                "label": {
                  "show": false
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Number of column masks and number of tables with column masks"
              }
            }
          },
          "position": {
            "x": 6,
            "y": 61,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "84d35a18",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "e097b5c1",
                  "fields": [
                    {
                      "name": "object_type",
                      "expression": "`object_type`"
                    },
                    {
                      "name": "count_comment",
                      "expression": "`count_comment`"
                    },
                    {
                      "name": "overall_count",
                      "expression": "`overall_count`"
                    },
                    {
                      "name": "perc_comment",
                      "expression": "`perc_comment`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 1,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "object_type",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100000,
                    "title": "Object",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "object_type"
                  },
                  {
                    "fieldName": "count_comment",
                    "numberFormat": "0",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "integer",
                    "displayAs": "number",
                    "visible": true,
                    "order": 100001,
                    "title": "# with comments",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "count_comment"
                  },
                  {
                    "fieldName": "overall_count",
                    "numberFormat": "0",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "integer",
                    "displayAs": "number",
                    "visible": true,
                    "order": 100002,
                    "title": "Total count",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "overall_count"
                  },
                  {
                    "fieldName": "perc_comment",
                    "numberFormat": "0.00%",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "float",
                    "displayAs": "number",
                    "visible": true,
                    "order": 100003,
                    "title": "% with comments",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "scalePercentBy100": true,
                    "displayName": "perc_comment"
                  }
                ]
              },
              "invisibleColumns": [],
              "allowHTMLByDefault": false,
              "itemsPerPage": 25,
              "paginationSize": "default",
              "condensed": true,
              "withRowNumber": true,
              "frame": {
                "showTitle": true,
                "title": "Details"
              }
            }
          },
          "position": {
            "x": 2,
            "y": 47,
            "width": 10,
            "height": 6
          }
        }
      ],
      "pageType": "PAGE_TYPE_CANVAS",
      "layoutVersion": "GRID_V1"
    },
    {
      "name": "e290aac3",
      "displayName": "Cost  Optimisation",
      "layout": [
        {
          "widget": {
            "name": "96877a12",
            "multilineTextboxSpec": {
              "lines": [
                "# Cost Optimisation"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 12,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "42a0abd4",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "dbdc9433",
                  "fields": [
                    {
                      "name": "waf_id",
                      "expression": "`waf_id`"
                    },
                    {
                      "name": "principle",
                      "expression": "`principle`"
                    },
                    {
                      "name": "best_practice",
                      "expression": "`best_practice`"
                    },
                    {
                      "name": "score_percentage",
                      "expression": "`score_percentage`"
                    },
                    {
                      "name": "threshold_percentage",
                      "expression": "`threshold_percentage`"
                    },
                    {
                      "name": "threshold_met",
                      "expression": "`threshold_met`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 1,
              "invisibleColumns": [
                {
                  "booleanValues": [
                    "false",
                    "true"
                  ],
                  "imageUrlTemplate": "{{ @ }}",
                  "imageTitleTemplate": "{{ @ }}",
                  "imageWidth": "",
                  "imageHeight": "",
                  "linkUrlTemplate": "{{ @ }}",
                  "linkTextTemplate": "{{ @ }}",
                  "linkTitleTemplate": "{{ @ }}",
                  "linkOpenInNewTab": true,
                  "name": "implemented",
                  "type": "string",
                  "displayAs": "string",
                  "order": 3,
                  "title": "implemented",
                  "allowSearch": false,
                  "alignContent": "left",
                  "allowHTML": false,
                  "highlightLinks": false,
                  "useMonospaceFont": false,
                  "preserveWhitespace": false
                }
              ],
              "allowHTMLByDefault": false,
              "itemsPerPage": 25,
              "paginationSize": "default",
              "condensed": true,
              "withRowNumber": false,
              "frame": {
                "title": "WAF Controls Table",
                "showTitle": true
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "waf_id",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 0,
                    "title": "waf_id",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "principle",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 1,
                    "title": "principle",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "best_practice",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 2,
                    "title": "best_practice",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "score_percentage",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "decimal",
                    "displayAs": "number",
                    "visible": true,
                    "order": 4,
                    "title": "score_percentage",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "threshold_percentage",
                    "numberFormat": "0",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "integer",
                    "displayAs": "number",
                    "visible": true,
                    "order": 5,
                    "title": "threshold_percentage",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "threshold_met",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 6,
                    "title": "threshold_met",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 10,
            "width": 12,
            "height": 7
          }
        },
        {
          "widget": {
            "name": "35c49ee2",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "81f0a6aa",
                  "fields": [
                    {
                      "name": "sum(completion_percent)",
                      "expression": "SUM(`completion_percent`)"
                    },
                    {
                      "name": "principle",
                      "expression": "`principle`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "sum(completion_percent)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Sum of completion_percent"
                },
                "y": {
                  "fieldName": "principle",
                  "scale": {
                    "type": "categorical",
                    "sort": {
                      "by": "x-reversed"
                    }
                  },
                  "displayName": "principle"
                }
              },
              "frame": {
                "title": "Completion percentage of implemented controls per principle",
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 4,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "04def979",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "06f2987c",
                  "fields": [
                    {
                      "name": "avg(completion_percent)",
                      "expression": "AVG(`completion_percent`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "avg(completion_percent)",
                  "displayName": "Average completion_percent"
                }
              },
              "frame": {
                "title": "Completion Percentage",
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 2,
            "width": 12,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "4c37a8d4",
            "multilineTextboxSpec": {
              "lines": [
                "---"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 17,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "0b04dde5",
            "multilineTextboxSpec": {
              "lines": [
                "### CO-01-01 - Use performance optimized data formats ([Delta Lake](https://docs.databricks.com/aws/en/delta/))\n",
                "<p>&nbsp;</p>\n",
                "\n",
                "Those metrics are at a Unity Catalog metastore level, and cannot be filtered down at a workspace level.\n",
                "<p>&nbsp;</p>\n"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 18,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "e357302e",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "c4255501",
                  "fields": [
                    {
                      "name": "sum(count_of_tables)",
                      "expression": "SUM(`count_of_tables`)"
                    },
                    {
                      "name": "data_lake_format",
                      "expression": "`data_lake_format`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "Table formats"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(count_of_tables)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Table formats"
                },
                "color": {
                  "fieldName": "data_lake_format",
                  "legend": {
                    "hideTitle": true
                  },
                  "scale": {
                    "type": "categorical"
                  }
                },
                "label": {
                  "show": true
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 21,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "009b71f1",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "c4255501",
                  "fields": [
                    {
                      "name": "sum(count_of_tables)",
                      "expression": "SUM(`count_of_tables`)"
                    },
                    {
                      "name": "table_type",
                      "expression": "`table_type`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`data_lake_format` IN ('DELTA', 'ICEBERG')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "title": "Managed Lakehouse (Delta and Iceberg)",
                "showTitle": true
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(count_of_tables)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Table types"
                },
                "color": {
                  "fieldName": "table_type",
                  "legend": {
                    "hideTitle": true
                  },
                  "displayName": "table_type",
                  "scale": {
                    "type": "categorical"
                  }
                },
                "label": {
                  "show": true
                }
              }
            }
          },
          "position": {
            "x": 6,
            "y": 21,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "0b0c4104",
            "multilineTextboxSpec": {
              "lines": [
                "### CO-01-02 - Use job clusters ([Databricks Workflows](https://www.databricks.com/product/data-engineering/workflows))"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 41,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "99b1a37d",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    },
                    {
                      "name": "billing_origin_product",
                      "expression": "`billing_origin_product`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('JOBS', 'INTERACTIVE')"
                    },
                    {
                      "expression": "`classic_or_serverless` IN ('CLASSIC')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "title": "All Purpose vs Job clusters (Classic Compute)",
                "showTitle": true
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(dbu_usage_total)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "hideTitle": false,
                    "title": "Total DBU"
                  },
                  "displayName": "DBU (not $DBU)d"
                },
                "color": {
                  "fieldName": "billing_origin_product",
                  "displayName": "billing_origin_product",
                  "scale": {
                    "type": "categorical"
                  }
                },
                "label": {
                  "show": true
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 44,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "cb9c0e9e",
            "multilineTextboxSpec": {
              "lines": [
                "1. Scheduled jobs running on AP can be moved to jobs clusters with an immediate 60% TCO reduction due to cheaper SKU rates"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 50,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "a1e036b9",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "feca6b37",
                  "fields": [
                    {
                      "name": "job_id",
                      "expression": "`job_id`"
                    },
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "title": "These jobs are configured to run on All Purpose clusters instead of Job clusters:",
                "showTitle": true,
                "headerAlignment": "left",
                "showDescription": false
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "job_id"
                  },
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 51,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "286ce2b0",
            "multilineTextboxSpec": {
              "lines": [
                "### CO-01-03 - Use [SQL Warehouses](https://docs.databricks.com/en/sql/admin/sql-warehouse.html) for SQL workloads"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 57,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "0ac81fcb",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "898f3132",
                  "fields": [
                    {
                      "name": "message",
                      "expression": "`message`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "rowsPerPage": 25,
              "displayRowNumbers": false,
              "frame": {
                "title": "BI tools connecting to All purpose vs DB SQL",
                "showTitle": true
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "message",
                    "useForSearch": false,
                    "displayName": "message",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 59,
            "width": 12,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "6283c9d0",
            "multilineTextboxSpec": {
              "lines": [
                "1. All BI usage should be powered by serverless to unlock better TCO and Performance"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 62,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "f67dc9c5",
            "multilineTextboxSpec": {
              "lines": [
                "### CO-01-04 -  Use up-to-date [Runtimes](https://docs.databricks.com/aws/en/release-notes/runtime/) for your workloads"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 68,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "fcb831ad",
            "multilineTextboxSpec": {
              "lines": [
                "1.  Teams must strive to use the latest runtime (at least the latest LTS runtime)\n",
                "2. Latest runtimes have better performance and security postures\n",
                "3. Adoption of serverless eliminates the admin overhead of managing runtime version upgrades"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 69,
            "width": 12,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "62314c18",
            "multilineTextboxSpec": {
              "lines": [
                "### CO-01-05 - Only use [GPUs](https://docs.databricks.com/aws/en/compute/gpu) for the right workload"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 81,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "0d1674a4",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "62126ae8",
                  "fields": [
                    {
                      "name": "message",
                      "expression": "`message`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "rowsPerPage": 25,
              "displayRowNumbers": false,
              "frame": {
                "title": "",
                "showTitle": false
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "message",
                    "useForSearch": false,
                    "displayName": "message",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 82,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "4290b1ba",
            "multilineTextboxSpec": {
              "lines": [
                "### CO-01-06 - Use [Serverless](https://docs.databricks.com/aws/en/compute/serverless/) for your workloads"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 88,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "72d9583b",
            "multilineTextboxSpec": {
              "lines": [
                "Serveless jobs unlock better TCO (auto tuning jobs configurations) and elimination of tech debt (cluster configurations and spark tuning)"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 89,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "e49c6507",
            "multilineTextboxSpec": {
              "lines": [
                "### CO-01-07 - Use the right instance type\n",
                "\n",
                "#### \n",
                "\n",
                "&nbsp;\n",
                "\n",
                "### CO-01-08 -  Choose the most [efficient cluster size](https://docs.databricks.com/aws/en/lakehouse-architecture/cost-optimization/best-practices#choose-the-most-efficient-cluster-size)"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 103,
            "width": 12,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "a4a15f20",
            "multilineTextboxSpec": {
              "lines": [
                "1.  Low CPU utilization should be mitigated by adopting a better instance family and hence reducing TCO\n",
                "2. Serverless should be considered to eliminate the overhead of utilization optimization"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 105,
            "width": 12,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "94a246b7",
            "multilineTextboxSpec": {
              "lines": [
                "1. Low Memory utilization should be mitigated by adopting a better instance family and hence reducing TCO\n",
                "2. Serverless should be considered to eliminate the overhead of utilization optimization"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 113,
            "width": 12,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "2a127d7b",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1de7073d",
                  "fields": [
                    {
                      "name": "message",
                      "expression": "`message`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "rowsPerPage": 25,
              "displayRowNumbers": false,
              "frame": {
                "title": "Model Serving Endpoint utilisation",
                "showTitle": true
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "message"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 115,
            "width": 12,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "9c7fbc03",
            "multilineTextboxSpec": {
              "lines": [
                "### CO-01-09 - Evaluate performance optimized query engines with [Photon](https://docs.databricks.com/aws/en/compute/configure#use-photon-acceleration)"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 136,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "0b447804",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "809dc7c9",
                  "fields": [
                    {
                      "name": "count(*)",
                      "expression": "COUNT(`*`)"
                    },
                    {
                      "name": "autoscaling_enabled",
                      "expression": "`autoscaling_enabled`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "title": "Job clusters with autoscaling enabled",
                "showTitle": true
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "count(*)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "hideTitle": true
                  },
                  "displayName": "Number of usage table reads"
                },
                "color": {
                  "fieldName": "autoscaling_enabled",
                  "legend": {
                    "title": "Autoscaling enabled"
                  },
                  "displayName": "date (day granularity)",
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 165,
            "width": 6,
            "height": 7
          }
        },
        {
          "widget": {
            "name": "a0de1765",
            "multilineTextboxSpec": {
              "lines": [
                "1. autoscaling in SQL warehouses can reduce TCO with Intelligent Workload Management"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 184,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "4252c35c",
            "multilineTextboxSpec": {
              "lines": [
                "### CO-02-02 - Use [auto termination](https://docs.databricks.com/aws/en/compute/configure#automatic-termination)"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 192,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "d4669fcb",
            "multilineTextboxSpec": {
              "lines": [
                "1. Auto termination when correctly configured can significantly reduce TCO\n",
                "2. Adopting Serverless can eliminate this admin overhead of tuning autoscaling"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 193,
            "width": 12,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "57ce5648",
            "multilineTextboxSpec": {
              "lines": [
                "1. All clusters should be built with cluster policies to reduce chances of runaway costs"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 214,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "d2eee859",
            "multilineTextboxSpec": {
              "lines": [
                "### CO-03-01 - Monitor costs\n",
                "\n",
                "&nbsp;\n",
                "\n",
                "### CO-03-02 - [Tag clusters](https://docs.databricks.com/aws/en/lakehouse-architecture/cost-optimization/best-practices#tag-clusters-for-cost-attribution) for cost attribution"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 233,
            "width": 12,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "d4ad6eaa",
            "multilineTextboxSpec": {
              "lines": [
                "### CO-03-03 - [Budgets](https://docs.databricks.com/en/admin/account-settings/budgets.html ) and Chargeback\n",
                "\n",
                "&nbsp;\n",
                "\n",
                "### CO-03-04 - Share cost reports regularly\n",
                "\n",
                "#### \n",
                "\n",
                "&nbsp;\n",
                "\n",
                "### CO-03-05 - Monitor and manage Delta Sharing egress costs\n",
                "<p>&nbsp;</p>\n",
                "\n",
                "1. Are you worried about users incurring unexpected costs? \n",
                "2. Have you setup [budgets](https://docs.databricks.com/en/admin/account-settings/budgets.html ) in Databricks or custom? \n",
                "3. How do you monitor Databricks cost including cost from cloud providers?\n",
                "4. Are you using the built-in [cost monitoring dashboard](https://docs.databricks.com/en/admin/account-settings/usage.html)?"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 247,
            "width": 12,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "cf9364cb",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    },
                    {
                      "name": "product_tier",
                      "expression": "`product_tier`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('SQL')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "title": "SQL warehouse sku",
                "showTitle": true
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(dbu_usage_total)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "title": "Warehouse type"
                  },
                  "displayName": "Serverless in SQL Warehouses"
                },
                "color": {
                  "fieldName": "product_tier",
                  "displayName": "product tier",
                  "scale": {
                    "type": "categorical"
                  }
                },
                "label": {
                  "show": false
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 63,
            "width": 6,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "f4396816",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "d0a01e50",
                  "fields": [
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "spot_placement",
                      "expression": "`spot_placement`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "All-purpose clusters - Spot placement"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name"
                  },
                  {
                    "fieldName": "spot_placement"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 252,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "4bae4638",
            "multilineTextboxSpec": {
              "lines": [
                "1. Lakehouse formats unlock better Performance & Cost (simpler maintance, better data skipping)\n",
                "2. Lakehouse formats unlock better Governance (Lineage, Metadata, Time Travel)"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 19,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "ad222c6c",
            "multilineTextboxSpec": {
              "lines": [
                "1. Managed tables reduce tech debt by unlocking automatic maintenance, indexing, anomaly detection and classification"
              ]
            }
          },
          "position": {
            "x": 6,
            "y": 19,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "f31c82df",
            "multilineTextboxSpec": {
              "lines": [
                "1. Federated sources should gradually be ingested into the lakehouse to unlock better performance & governance "
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 27,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "98769135",
            "multilineTextboxSpec": {
              "lines": [
                "1. Databricks Vector DB can be configued to be storage optimized for infrequent access indices and unlocking better TCO"
              ]
            }
          },
          "position": {
            "x": 6,
            "y": 27,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "b31a3db7",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "16facbed",
                  "fields": [
                    {
                      "name": "sum(count_of_tables)",
                      "expression": "SUM(`count_of_tables`)"
                    },
                    {
                      "name": "data_source_format",
                      "expression": "`data_source_format`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "Federated formats"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(count_of_tables)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Table formats"
                },
                "color": {
                  "fieldName": "data_source_format",
                  "legend": {
                    "hideTitle": true
                  },
                  "scale": {
                    "type": "categorical"
                  }
                },
                "label": {
                  "show": true
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 29,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "vector-db",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "a5da7a83",
                  "fields": [
                    {
                      "name": "message",
                      "expression": "`message`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Vector DB"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "message"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 6,
            "y": 29,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "d73753f0",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "a5da7a83",
                  "fields": [
                    {
                      "name": "message",
                      "expression": "`message`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Lakebase"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "message"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 35,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "88bd3001",
            "multilineTextboxSpec": {
              "lines": [
                "1. Reverse ETL systems can be hosted within Databricks unlocking simplified operations, reduced TCO & better app performance"
              ]
            }
          },
          "position": {
            "x": 6,
            "y": 35,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "9bf051ff",
            "multilineTextboxSpec": {
              "lines": [
                "1. Scheduled jobs should always be run on jobs clusters or as serveless jobs to unlock better TCO and elimination of tech debt (cluster configurations and spark tuning)\n",
                "2. Long running EDA jobs or unsupervised workloads should be run on jobs clusters to unlock better TCO"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 42,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "715ecf55",
            "multilineTextboxSpec": {
              "lines": [
                "1. Serverless jobs, especially with standard mode can unlock better TCO and eliminates administrative burden of fine tuning clusters and spark configurations"
              ]
            }
          },
          "position": {
            "x": 6,
            "y": 42,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "806ca6ee",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    },
                    {
                      "name": "classic_or_serverless",
                      "expression": "`classic_or_serverless`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('JOBS')"
                    },
                    {
                      "expression": "`classic_or_serverless` IN (`classic_or_serverless`) OR TRUE"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "title": "Jobs Classic vs Serverless",
                "showTitle": true
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(dbu_usage_total)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "hideTitle": false,
                    "title": "Total DBU"
                  },
                  "displayName": "DBU (not $DBU)d"
                },
                "color": {
                  "fieldName": "classic_or_serverless",
                  "displayName": "billing_origin_product",
                  "scale": {
                    "type": "categorical"
                  }
                },
                "label": {
                  "show": true
                }
              }
            }
          },
          "position": {
            "x": 6,
            "y": 44,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "eb08fa71",
            "multilineTextboxSpec": {
              "lines": [
                "1. All BI tooling should always connect to DB SQL Serverless to unlock better TCO and Performance"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 58,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "5e901f28",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "compute_id",
                      "expression": "`compute_id`"
                    },
                    {
                      "name": "dbu_usage_total",
                      "expression": "`dbu_usage_total`"
                    },
                    {
                      "name": "product_tier",
                      "expression": "`product_tier`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('SQL')"
                    },
                    {
                      "expression": "`classic_or_serverless` IN ('CLASSIC')"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "title": "SQL Warehouses running on Classic or Pro",
                "showTitle": true
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "compute_id"
                  },
                  {
                    "fieldName": "dbu_usage_total"
                  },
                  {
                    "fieldName": "product_tier",
                    "displayName": "product tier"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 6,
            "y": 63,
            "width": 6,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "runtime",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "f4e7201f",
                  "fields": [
                    {
                      "name": "count(cluster_id)",
                      "expression": "COUNT(`cluster_id`)"
                    },
                    {
                      "name": "runtime",
                      "expression": "`runtime`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "Runtime",
                "headerAlignment": "center"
              },
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "count(cluster_id)",
                  "scale": {
                    "type": "quantitative"
                  }
                },
                "y": {
                  "fieldName": "runtime",
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 71,
            "width": 12,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "646cc79c",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "f4e7201f",
                  "fields": [
                    {
                      "name": "runtime",
                      "expression": "`runtime`"
                    },
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Runtime",
                "headerAlignment": "center"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "runtime"
                  },
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 76,
            "width": 12,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "b40ad118",
            "multilineTextboxSpec": {
              "lines": [
                "Serverless SQL always provides better user experience with intelligent workload management and improved TCO"
              ]
            }
          },
          "position": {
            "x": 6,
            "y": 89,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "910c1635",
            "multilineTextboxSpec": {
              "lines": [
                "Serveless notebooks unlock better TCO (AI driven autoscaling and intelligent workload management) and elimination of tech debt (cluster configurations and spark tuning)"
              ]
            }
          },
          "position": {
            "x": 6,
            "y": 97,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "jobs-classic-vs-serverless",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    },
                    {
                      "name": "classic_or_serverless",
                      "expression": "`classic_or_serverless`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('JOBS')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "Jobs Classic vs Serverless"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(dbu_usage_total)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "title": "Total DBU"
                  }
                },
                "color": {
                  "fieldName": "classic_or_serverless",
                  "legend": {
                    "title": "Serverless"
                  },
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 91,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "111449d4",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    },
                    {
                      "name": "classic_or_serverless",
                      "expression": "`classic_or_serverless`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('SQL')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "SQL warehouse"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(dbu_usage_total)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "title": "Total DBU"
                  }
                },
                "color": {
                  "fieldName": "classic_or_serverless",
                  "legend": {
                    "title": "Serverless"
                  },
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 6,
            "y": 91,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "242210c8",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    },
                    {
                      "name": "classic_or_serverless",
                      "expression": "`classic_or_serverless`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('INTERACTIVE')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "Serverless vs Classic notebook"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(dbu_usage_total)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "title": "Total DBU"
                  }
                },
                "color": {
                  "fieldName": "classic_or_serverless",
                  "legend": {
                    "title": "Serverless"
                  },
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 97,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "cpu-utilisation-last-90-days",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "31958c67",
                  "fields": [
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "Avg CPU Utilization",
                      "expression": "`Avg CPU Utilization`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "CPU utilisation - last 90 days"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "cluster_name"
                  },
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "Avg CPU Utilization"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 107,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "a6f2d1ed",
            "multilineTextboxSpec": {
              "lines": [
                "1. Low utilization should be mitigated with downsizing the serving t-shirt size and adding scale-to-zero"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 124,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "8f74c3cb",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1de7073d",
                  "fields": [
                    {
                      "name": "message",
                      "expression": "`message`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "rowsPerPage": 25,
              "displayRowNumbers": false,
              "frame": {
                "title": "Model Serving Endpoint utilisation",
                "showTitle": true
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "message"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 125,
            "width": 12,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "memory-utilisation-last-90-days-1",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "781ee68b",
                  "fields": [
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "Avg Memory Utilization",
                      "expression": "`Avg Memory Utilization`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Memory utilisation - last 90 days"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "cluster_name"
                  },
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "Avg Memory Utilization"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 118,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "a7114ee8",
            "multilineTextboxSpec": {
              "lines": [
                "1. Low utilization should be mitigated with more aggressive autoscaling, autotermination and selection of right t-shirt size"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 128,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "e3abb40f",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1de7073d",
                  "fields": [
                    {
                      "name": "message",
                      "expression": "`message`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "rowsPerPage": 25,
              "displayRowNumbers": false,
              "frame": {
                "title": "SQL Warehouse utilisation",
                "showTitle": true
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "message"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 129,
            "width": 12,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "ee2dee96",
            "multilineTextboxSpec": {
              "lines": [
                "1. Low utilization should be mitigated wtih right sizing and setting up lifecycle management"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 132,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "41a2bae7",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1de7073d",
                  "fields": [
                    {
                      "name": "message",
                      "expression": "`message`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "rowsPerPage": 25,
              "displayRowNumbers": false,
              "frame": {
                "title": "Lakebase utilisation",
                "showTitle": true
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "message"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 133,
            "width": 12,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "jobs-photon-enabled-last-90-days",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    },
                    {
                      "name": "photon_or_non_photon",
                      "expression": "`photon_or_non_photon`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('JOBS')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "Jobs with Photon enabled - last 90 days"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(dbu_usage_total)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "title": "DBU"
                  }
                },
                "color": {
                  "fieldName": "photon_or_non_photon",
                  "legend": {
                    "title": "Photon Enabled"
                  },
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 137,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "9012104a",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    },
                    {
                      "name": "photon_or_non_photon",
                      "expression": "`photon_or_non_photon`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('INTERACTIVE')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "All purpose with Photon enabled - last 90 days"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(dbu_usage_total)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "title": "DBU"
                  }
                },
                "color": {
                  "fieldName": "photon_or_non_photon",
                  "legend": {
                    "title": "Photon Enabled"
                  },
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 6,
            "y": 137,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "all-purpose-clusters-last-90-days-photon-disabled",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "951a00c5",
                  "fields": [
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "is_photon",
                      "expression": "`is_photon`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`is_photon` IN (FALSE)"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "All purpose clusters used in the last 90 days with photon not enabled"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name"
                  },
                  {
                    "fieldName": "is_photon"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 143,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "cf506739",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1954cef2",
                  "fields": [
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "is_photon",
                      "expression": "`is_photon`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Job runs used in the last 90 days with photon not enabled"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name"
                  },
                  {
                    "fieldName": "is_photon"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 149,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "0eebcb04",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "cd07a984",
                  "fields": [
                    {
                      "name": "message",
                      "expression": "`message`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "message"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 155,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "1150da52",
            "multilineTextboxSpec": {
              "lines": [
                "1. Using standard mode can significantly reduce the overall TCO of workloads"
              ]
            }
          },
          "position": {
            "x": 6,
            "y": 155,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "ed1c5dc8",
            "multilineTextboxSpec": {
              "lines": [
                "1. autoscaling in AP clusters can reduce underutilized VMs and reduce TCO\n",
                "2. adopting servelress can eliminate this admin overhead of tuning autoscaling"
              ]
            }
          },
          "position": {
            "x": 6,
            "y": 157,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "06a2b812",
            "multilineTextboxSpec": {
              "lines": [
                "### CO-02-01 - Leverage [auto-scaling](https://docs.databricks.com/aws/en/compute/configure#enable-autoscaling) compute"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 161,
            "width": 12,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "c97aa624",
            "multilineTextboxSpec": {
              "lines": [
                "1.  autoscaling can reduce the TCO by intelligently scaling up and down as per workloads\n",
                "2. adopting serverless can eliminate this admin overhead of tuning autoscaling"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 163,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "b9736b2f",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "fbc6ed5e",
                  "fields": [
                    {
                      "name": "count(*)",
                      "expression": "COUNT(`*`)"
                    },
                    {
                      "name": "autoscaling_enabled",
                      "expression": "`autoscaling_enabled`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "title": "All purpose clusters with autoscaling enabled",
                "showTitle": true
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "count(*)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "hideTitle": true
                  },
                  "displayName": "Number of usage table reads"
                },
                "color": {
                  "fieldName": "autoscaling_enabled",
                  "legend": {
                    "title": "Autoscaling enabled"
                  },
                  "displayName": "date (day granularity)",
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 6,
            "y": 165,
            "width": 6,
            "height": 7
          }
        },
        {
          "widget": {
            "name": "job-clusters",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "809dc7c9",
                  "fields": [
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "autoscaling_enabled",
                      "expression": "`autoscaling_enabled`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Job clusters"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name"
                  },
                  {
                    "fieldName": "autoscaling_enabled"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 178,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "7980cdea",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "fbc6ed5e",
                  "fields": [
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "autoscaling_enabled",
                      "expression": "`autoscaling_enabled`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "All purpose clusters"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name"
                  },
                  {
                    "fieldName": "autoscaling_enabled"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 172,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "495d8220",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "4858cc4e",
                  "fields": [
                    {
                      "name": "count(*)",
                      "expression": "COUNT(`*`)"
                    },
                    {
                      "name": "autoscaling_enabled",
                      "expression": "`autoscaling_enabled`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "title": "SQL Warehouses with autoscaling enabled",
                "showTitle": true
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "count(*)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "hideTitle": true
                  },
                  "displayName": "Number of usage table reads"
                },
                "color": {
                  "fieldName": "autoscaling_enabled",
                  "legend": {
                    "title": "Autoscaling enabled"
                  },
                  "displayName": "date (day granularity)",
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 185,
            "width": 6,
            "height": 7
          }
        },
        {
          "widget": {
            "name": "model-serving-endpoints-auto-scaling-enabled",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "fd056256",
                  "fields": [
                    {
                      "name": "message",
                      "expression": "`message`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Model serving endpoints with auto-scaling enabled"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "message"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 6,
            "y": 185,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "all-purpose-clusters-auto-termination",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "d0192813",
                  "fields": [
                    {
                      "name": "count(*)",
                      "expression": "COUNT(`*`)"
                    },
                    {
                      "name": "autotermination_enabled",
                      "expression": "`autotermination_enabled`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "All purpose clusters with auto-termination enabled"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "count(*)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "hideTitle": true
                  }
                },
                "color": {
                  "fieldName": "autotermination_enabled",
                  "legend": {
                    "title": "Auto-termination enabled"
                  },
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 195,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "b6c5d8a1",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "07c3451a",
                  "fields": [
                    {
                      "name": "count(*)",
                      "expression": "COUNT(`*`)"
                    },
                    {
                      "name": "autotermination_enabled",
                      "expression": "`autotermination_enabled`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "SQL warehouses with auto-termination enabled"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "count(*)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "hideTitle": true
                  }
                },
                "color": {
                  "fieldName": "autotermination_enabled",
                  "legend": {
                    "title": "Auto-termination enabled"
                  },
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 6,
            "y": 195,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "all-purpose-clusters-auto-termination-disabled",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "d0192813",
                  "fields": [
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "autotermination_enabled",
                      "expression": "`autotermination_enabled`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`autotermination_enabled` IN ('No')"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "All-purpose clusters - Auto-termination not enabled"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name"
                  },
                  {
                    "fieldName": "autotermination_enabled"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 201,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "145f7c29",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "07c3451a",
                  "fields": [
                    {
                      "name": "warehouse_id",
                      "expression": "`warehouse_id`"
                    },
                    {
                      "name": "warehouse_name",
                      "expression": "`warehouse_name`"
                    },
                    {
                      "name": "autotermination_enabled",
                      "expression": "`autotermination_enabled`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "SQL Warehouses - Auto-termination not enabled"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "warehouse_id"
                  },
                  {
                    "fieldName": "warehouse_name"
                  },
                  {
                    "fieldName": "autotermination_enabled"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 207,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "ff79a737",
            "multilineTextboxSpec": {
              "lines": [
                "### CO-02-03 - Use [compute policies](https://docs.databricks.com/aws/en/admin/clusters/policies) to control costs"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 213,
            "width": 12,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "job-clusters-cluster-policy",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "98c1b821",
                  "fields": [
                    {
                      "name": "count(*)",
                      "expression": "COUNT(`*`)"
                    },
                    {
                      "name": "cluster_policy",
                      "expression": "`cluster_policy`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "All purpose clusters with a cluster policy"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "count(*)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "hideTitle": true
                  }
                },
                "color": {
                  "fieldName": "cluster_policy",
                  "legend": {
                    "title": "Cluster policy"
                  },
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 215,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "9ae15235",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "cc24226f",
                  "fields": [
                    {
                      "name": "count(*)",
                      "expression": "COUNT(`*`)"
                    },
                    {
                      "name": "cluster_policy",
                      "expression": "`cluster_policy`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "Job clusters with a cluster policy"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "count(*)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "hideTitle": true
                  }
                },
                "color": {
                  "fieldName": "cluster_policy",
                  "legend": {
                    "title": "Cluster policy"
                  },
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 6,
            "y": 215,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "all-purpose-clusters-without-cluster-policy",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "98c1b821",
                  "fields": [
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "cluster_policy",
                      "expression": "`cluster_policy`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "All-purpose clusters without a cluster policy"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name"
                  },
                  {
                    "fieldName": "cluster_policy"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 221,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "91fb528c",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "cc24226f",
                  "fields": [
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "cluster_policy",
                      "expression": "`cluster_policy`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Jobs clusters without a cluster policy"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name"
                  },
                  {
                    "fieldName": "cluster_policy"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 227,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "219a523b",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "bb77bb31",
                  "fields": [
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "All-purpose clusters without cluster tags"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 235,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "b01bc715",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "7abec3c3",
                  "fields": [
                    {
                      "name": "warehouse_id",
                      "expression": "`warehouse_id`"
                    },
                    {
                      "name": "warehouse_name",
                      "expression": "`warehouse_name`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "SQL warehouses without tags"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "warehouse_id"
                  },
                  {
                    "fieldName": "warehouse_name"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 241,
            "width": 12,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "03d31399",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "67073248",
                  "fields": [
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "spot_placement",
                      "expression": "`spot_placement`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Job clusters - Spot placement"
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name"
                  },
                  {
                    "fieldName": "spot_placement"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 258,
            "width": 12,
            "height": 6
          }
        }
      ],
      "pageType": "PAGE_TYPE_CANVAS",
      "layoutVersion": "GRID_V1"
    },
    {
      "name": "a273eac3",
      "displayName": "Performance Efficiency",
      "layout": [
        {
          "widget": {
            "name": "a4858bf5",
            "multilineTextboxSpec": {
              "lines": [
                "# Performance Efficiency"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "e8b637d7",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "87deca0d",
                  "fields": [
                    {
                      "name": "completion_percent",
                      "expression": "`completion_percent`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "title": "Completion Percentage",
                "showTitle": true
              },
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "completion_percent",
                  "displayName": "Average completion_percent"
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 2,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "26d96526",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "13e29e6c",
                  "fields": [
                    {
                      "name": "sum(completion_percent)",
                      "expression": "SUM(`completion_percent`)"
                    },
                    {
                      "name": "principle",
                      "expression": "`principle`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "title": "Completion percentage of implemented controls per principle",
                "showTitle": true
              },
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "sum(completion_percent)",
                  "displayName": "Sum of completion_percent",
                  "scale": {
                    "type": "quantitative"
                  }
                },
                "y": {
                  "fieldName": "principle",
                  "displayName": "principle",
                  "scale": {
                    "type": "categorical",
                    "sort": {
                      "by": "x-reversed"
                    }
                  }
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 4,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "591b619b",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "c3adf755",
                  "fields": [
                    {
                      "name": "waf_id",
                      "expression": "`waf_id`"
                    },
                    {
                      "name": "principle",
                      "expression": "`principle`"
                    },
                    {
                      "name": "best_practice",
                      "expression": "`best_practice`"
                    },
                    {
                      "name": "score_percentage",
                      "expression": "`score_percentage`"
                    },
                    {
                      "name": "threshold_percentage",
                      "expression": "`threshold_percentage`"
                    },
                    {
                      "name": "threshold_met",
                      "expression": "`threshold_met`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "title": "WAF Controls Table",
                "showTitle": true
              },
              "rowsPerPage": 25,
              "displayRowNumbers": false,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "waf_id",
                    "useForSearch": false,
                    "displayName": "WAF ID",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "principle",
                    "useForSearch": false,
                    "displayName": "Principle",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "best_practice",
                    "useForSearch": false,
                    "displayName": "Best Practice",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "score_percentage",
                    "format": {
                      "type": "number-plain",
                      "abbreviation": "none",
                      "decimalPlaces": {
                        "type": "exact",
                        "places": 0
                      },
                      "hideGroupSeparator": true
                    },
                    "displayName": "Score %"
                  },
                  {
                    "fieldName": "threshold_percentage",
                    "displayName": "Threshold %"
                  },
                  {
                    "fieldName": "threshold_met",
                    "displayName": "Threshold Status"
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 10,
            "width": 6,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "320a142e",
            "multilineTextboxSpec": {
              "lines": [
                "### PE-01-01 - Use [serverless](https://www.databricks.com/glossary/serverless-computing) architecture"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 15,
            "width": 6,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "551cc760",
            "multilineTextboxSpec": {
              "lines": [
                "1. Serverless jobs can outperform classic based jobs in Performance & TCO\n",
                "2. Serverless eliminates the need for admin - cluster sizing and tuning"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 16,
            "width": 6,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "56c3d5b0",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    },
                    {
                      "name": "classic_or_serverless",
                      "expression": "`classic_or_serverless`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('JOBS', 'SDP')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "title": "SDP and Lakeflow Jobs(1)",
                "showTitle": true,
                "showDescription": true,
                "description": "Classic vs Serverless"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(dbu_usage_total)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "DBU"
                },
                "color": {
                  "fieldName": "classic_or_serverless",
                  "legend": {
                    "hide": true
                  },
                  "displayName": "Classic Or Serverless",
                  "scale": {
                    "type": "categorical",
                    "mappings": [
                      {
                        "value": true,
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 3
                        }
                      },
                      {
                        "value": false,
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 2
                        }
                      },
                      {
                        "value": "CLASSIC",
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 2
                        }
                      },
                      {
                        "value": "SERVERLESS",
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 3
                        }
                      }
                    ]
                  }
                },
                "label": {
                  "show": false
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 17,
            "width": 2,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "7c1ad09d",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "unique_id",
                      "expression": "`unique_id`"
                    },
                    {
                      "name": "billing_origin_product",
                      "expression": "`billing_origin_product`"
                    },
                    {
                      "name": "dbu_usage_total",
                      "expression": "`dbu_usage_total`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('JOBS', 'SDP')"
                    },
                    {
                      "expression": "`classic_or_serverless` IN ('CLASSIC')"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Workflows on Classic Compute(1)"
              },
              "rowsPerPage": 25,
              "displayRowNumbers": false,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "unique_id",
                    "useForSearch": false,
                    "displayName": "Job/SDP ID",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "billing_origin_product",
                    "useForSearch": false,
                    "displayName": "Product",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "dbu_usage_total",
                    "useForSearch": false,
                    "format": {
                      "type": "numeral.js",
                      "format": "0,0.00"
                    },
                    "displayName": "DBU",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  }
                ]
              }
            }
          },
          "position": {
            "x": 2,
            "y": 17,
            "width": 4,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "24f01235",
            "multilineTextboxSpec": {
              "lines": [
                "Performance mode can increase the performance significantly, but its gains must be deliberated with the TCO impact"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 21,
            "width": 6,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "4aab3253",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    },
                    {
                      "name": "performance_target",
                      "expression": "`performance_target`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('JOBS', 'SDP')"
                    },
                    {
                      "expression": "`classic_or_serverless` IN ('SERVERLESS')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "title": "SDP and Lakeflow Jobs(1)",
                "showTitle": true,
                "showDescription": true,
                "description": "Standard vs Performance Mode"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(dbu_usage_total)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "DBU"
                },
                "color": {
                  "fieldName": "performance_target",
                  "legend": {
                    "hide": true
                  },
                  "displayName": "Mode",
                  "scale": {
                    "type": "categorical",
                    "mappings": [
                      {
                        "value": true,
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 3
                        }
                      },
                      {
                        "value": false,
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 2
                        }
                      },
                      {
                        "value": "CLASSIC",
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 2
                        }
                      },
                      {
                        "value": "SERVERLESS",
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 3
                        }
                      }
                    ]
                  }
                },
                "label": {
                  "show": false
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 22,
            "width": 2,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "b945fdcf",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "unique_id",
                      "expression": "`unique_id`"
                    },
                    {
                      "name": "billing_origin_product",
                      "expression": "`billing_origin_product`"
                    },
                    {
                      "name": "dbu_usage_total",
                      "expression": "`dbu_usage_total`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('JOBS', 'SDP')"
                    },
                    {
                      "expression": "`classic_or_serverless` IN ('SERVERLESS')"
                    },
                    {
                      "expression": "`performance_target` IN ('PERFORMANCE_OPTIMIZED')"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Workflows on Serverless Performance Optimized Compute(1)"
              },
              "rowsPerPage": 25,
              "displayRowNumbers": false,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "unique_id",
                    "useForSearch": false,
                    "displayName": "Job/SDP ID",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "billing_origin_product",
                    "useForSearch": false,
                    "displayName": "Product",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "dbu_usage_total",
                    "useForSearch": false,
                    "format": {
                      "type": "numeral.js",
                      "format": "0,0.00"
                    },
                    "displayName": "DBU",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  }
                ]
              }
            }
          },
          "position": {
            "x": 2,
            "y": 22,
            "width": 4,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "8f7b4638",
            "multilineTextboxSpec": {
              "lines": [
                "1. Serverless Notebooks benefit from auto scaling to the user's needs\n",
                "2. Serverless NBs use intelligent workload management to reduce under utilization, reducing TCO"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 26,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "242cbe47",
            "multilineTextboxSpec": {
              "lines": [
                "Serverless SQL benefits from Intelligent Workload Management and Predictive Optimization that boosts query performance and user experience"
              ]
            }
          },
          "position": {
            "x": 2,
            "y": 26,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "f7fd0887",
            "multilineTextboxSpec": {
              "lines": [
                "Using managed services for GenAI can significantly optimize overall TCO"
              ]
            }
          },
          "position": {
            "x": 4,
            "y": 26,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "34da4d4f",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    },
                    {
                      "name": "classic_or_serverless",
                      "expression": "`classic_or_serverless`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('INTERACTIVE')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "title": "Notebooks(1)",
                "showTitle": true,
                "showDescription": true,
                "description": "Ratio of classic vs serverless"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(dbu_usage_total)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "DBU"
                },
                "color": {
                  "fieldName": "classic_or_serverless",
                  "legend": {
                    "hide": true
                  },
                  "displayName": "Classic Or Serverless",
                  "scale": {
                    "type": "categorical",
                    "mappings": [
                      {
                        "value": true,
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 3
                        }
                      },
                      {
                        "value": false,
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 2
                        }
                      },
                      {
                        "value": "CLASSIC",
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 2
                        }
                      },
                      {
                        "value": "SERVERLESS",
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 3
                        }
                      }
                    ]
                  }
                },
                "label": {
                  "show": false
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 28,
            "width": 2,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "46124e16",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    },
                    {
                      "name": "classic_or_serverless",
                      "expression": "`classic_or_serverless`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('SQL')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "title": "DBSQL(1)",
                "showTitle": true,
                "showDescription": true,
                "description": "Ratio of SQL Classic/Pro vs Serverless"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(dbu_usage_total)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "DBU"
                },
                "color": {
                  "fieldName": "classic_or_serverless",
                  "legend": {
                    "hide": true
                  },
                  "displayName": "Classic Or Serverless",
                  "scale": {
                    "type": "categorical",
                    "mappings": [
                      {
                        "value": true,
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 3
                        }
                      },
                      {
                        "value": false,
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 2
                        }
                      },
                      {
                        "value": "CLASSIC",
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 2
                        }
                      },
                      {
                        "value": "SERVERLESS",
                        "color": {
                          "themeColorType": "visualizationColors",
                          "position": 3
                        }
                      }
                    ]
                  }
                },
                "label": {
                  "show": false
                }
              }
            }
          },
          "position": {
            "x": 2,
            "y": 28,
            "width": 2,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "d4a7b901",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    },
                    {
                      "name": "billing_origin_product",
                      "expression": "`billing_origin_product`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('APPS', 'LAKEBASE', 'VECTOR_SEARCH')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "title": "GenAI / Applications(1)",
                "showTitle": true,
                "showDescription": true,
                "description": "Usage over L90 Days"
              },
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "sum(dbu_usage_total)",
                  "displayName": "DBU",
                  "scale": {
                    "type": "quantitative"
                  }
                },
                "y": {
                  "fieldName": "billing_origin_product",
                  "displayName": "SKU",
                  "scale": {
                    "type": "categorical"
                  }
                },
                "label": {
                  "show": true
                }
              }
            }
          },
          "position": {
            "x": 4,
            "y": 28,
            "width": 2,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "c2122948",
            "multilineTextboxSpec": {
              "lines": [
                "### PE-01-02 - Use an enterprise grade [model serving](https://www.databricks.com/product/model-serving) service"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 32,
            "width": 6,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "1782a61f",
            "multilineTextboxSpec": {
              "lines": [
                "FM API usage can be governed with AI Gateway for rate limiting and usage monitoring"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 33,
            "width": 6,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "8539a546",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "6576f362",
                  "fields": [
                    {
                      "name": "entity_name",
                      "expression": "`entity_name`"
                    },
                    {
                      "name": "dbu",
                      "expression": "`dbu`"
                    },
                    {
                      "name": "number_requests",
                      "expression": "`number_requests`"
                    },
                    {
                      "name": "avg_input_token",
                      "expression": "`avg_input_token`"
                    },
                    {
                      "name": "avg_output_token",
                      "expression": "`avg_output_token`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`entity_type` IN ('FOUNDATION_MODEL')"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "entity_name",
                    "displayName": "Endpoint",
                    "useForSearch": false,
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "dbu",
                    "displayName": "DBU",
                    "useForSearch": false,
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    },
                    "format": {
                      "type": "numeral.js",
                      "format": "0,0"
                    }
                  },
                  {
                    "fieldName": "number_requests",
                    "displayName": "# Requests",
                    "useForSearch": false,
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    },
                    "format": {
                      "type": "numeral.js",
                      "format": "0,0"
                    }
                  },
                  {
                    "fieldName": "avg_input_token",
                    "displayName": "Input Tokens (avg)",
                    "useForSearch": false,
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    },
                    "format": {
                      "type": "numeral.js",
                      "format": "0,0"
                    }
                  },
                  {
                    "fieldName": "avg_output_token",
                    "displayName": "Output Tokens (avg)",
                    "useForSearch": false,
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    },
                    "format": {
                      "type": "numeral.js",
                      "format": "0,0"
                    }
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "FM API usage(1)"
              },
              "rowsPerPage": 25,
              "displayRowNumbers": false
            }
          },
          "position": {
            "x": 0,
            "y": 34,
            "width": 6,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "34740bc5",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "6576f362",
                  "fields": [
                    {
                      "name": "endpoint_name",
                      "expression": "`endpoint_name`"
                    },
                    {
                      "name": "dbu",
                      "expression": "`dbu`"
                    },
                    {
                      "name": "number_requests",
                      "expression": "`number_requests`"
                    },
                    {
                      "name": "custom_model_compute_type",
                      "expression": "`custom_model_compute_type`"
                    },
                    {
                      "name": "custom_model_min_concurrency",
                      "expression": "`custom_model_min_concurrency`"
                    },
                    {
                      "name": "custom_model_max_concurrency",
                      "expression": "`custom_model_max_concurrency`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`entity_type` IN ('CUSTOM_MODEL')"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Model Serving Usage(1)"
              },
              "rowsPerPage": 25,
              "displayRowNumbers": false,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "endpoint_name",
                    "useForSearch": false,
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "dbu",
                    "useForSearch": false,
                    "format": {
                      "type": "numeral.js",
                      "format": "0,0"
                    },
                    "displayName": "DBU",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "number_requests",
                    "useForSearch": false,
                    "format": {
                      "type": "numeral.js",
                      "format": "0,0"
                    },
                    "displayName": "# Requests",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "custom_model_compute_type",
                    "useForSearch": false,
                    "displayName": "Compute",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "custom_model_min_concurrency",
                    "useForSearch": false,
                    "format": {
                      "type": "numeral.js",
                      "format": "0"
                    },
                    "displayName": "Min Concurrency",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "custom_model_max_concurrency",
                    "useForSearch": false,
                    "format": {
                      "type": "numeral.js",
                      "format": "0"
                    },
                    "displayName": "Max Concurrency",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 40,
            "width": 6,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "a550e3cb",
            "multilineTextboxSpec": {
              "lines": [
                "Low utilization should be mitigated with downsizing the serving t-shirt size and adding scale-to-zero"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 39,
            "width": 6,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "1b349276",
            "multilineTextboxSpec": {
              "lines": [
                "Low utilization indicated by low number of queries and no queuing time should be mitigated with more aggressive autoscaling, auto-termination and selection of right t-shirt size"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 45,
            "width": 6,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "be1319d3",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "c3a6d1af",
                  "fields": [
                    {
                      "name": "warehouse_id",
                      "expression": "`warehouse_id`"
                    },
                    {
                      "name": "total_queries",
                      "expression": "`total_queries`"
                    },
                    {
                      "name": "max_queue_time_seconds",
                      "expression": "`max_queue_time_seconds`"
                    },
                    {
                      "name": "avg_queue_time_seconds",
                      "expression": "`avg_queue_time_seconds`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "warehouse_id",
                    "displayName": "Warehouse ID",
                    "useForSearch": false,
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "total_queries",
                    "displayName": "Total Queries",
                    "useForSearch": false,
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    },
                    "format": {
                      "type": "numeral.js",
                      "format": "0,0"
                    }
                  },
                  {
                    "fieldName": "max_queue_time_seconds",
                    "displayName": "Max Queue Time in Seconds",
                    "useForSearch": false,
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    },
                    "format": {
                      "type": "numeral.js",
                      "format": "0,0.00"
                    }
                  },
                  {
                    "fieldName": "avg_queue_time_seconds",
                    "displayName": "Average Queue Time in Seconds",
                    "useForSearch": false,
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    },
                    "format": {
                      "type": "numeral.js",
                      "format": "0.00"
                    }
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "SQL Warehouse Utilization(1)"
              },
              "rowsPerPage": 25,
              "displayRowNumbers": false
            }
          },
          "position": {
            "x": 0,
            "y": 46,
            "width": 6,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "953f82ec",
            "multilineTextboxSpec": {
              "lines": [
                "### PE-02-08 - PE-02-16 **Design data layout for performance**"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 51,
            "width": 6,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "420e38d4",
            "multilineTextboxSpec": {
              "lines": [
                "Managed tables reduce tech debt by unlocking automatic maintenance, indexing, anomaly detection and classification"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 52,
            "width": 3,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "4d3ba097",
            "multilineTextboxSpec": {
              "lines": [
                "Federated sources should eventually be onboarded as ingestion sources for better performance and lakehouse capabilities"
              ]
            }
          },
          "position": {
            "x": 3,
            "y": 52,
            "width": 3,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "1b63e774",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "c4255501",
                  "fields": [
                    {
                      "name": "sum(count_of_tables)",
                      "expression": "SUM(`count_of_tables`)"
                    },
                    {
                      "name": "table_type",
                      "expression": "`table_type`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`table_type` IN ('EXTERNAL', 'MANAGED')"
                    },
                    {
                      "expression": "`data_source_format` IN ('DELTA', 'DELTA_UNIFORM_ICEBERG', 'DELTASHARING', 'ICEBERG')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "Managed vs External Tables(4)"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(count_of_tables)",
                  "scale": {
                    "type": "quantitative"
                  }
                },
                "color": {
                  "fieldName": "table_type",
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 54,
            "width": 3,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "b57a4744",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "c4255501",
                  "fields": [
                    {
                      "name": "sum(count_of_tables)",
                      "expression": "SUM(`count_of_tables`)"
                    },
                    {
                      "name": "data_source_format",
                      "expression": "`data_source_format`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "Federated Tables(4)"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(count_of_tables)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Tables"
                },
                "color": {
                  "fieldName": "data_source_format",
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 3,
            "y": 54,
            "width": 3,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "44af17c5",
            "multilineTextboxSpec": {
              "lines": [
                "Predictive optimization automatically takes care of caching, compaction, skipping, clustering and join tuning"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 58,
            "width": 3,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "a902013d",
            "multilineTextboxSpec": {
              "lines": [
                "DQ Monitoring can help identify data quality issues proactively and find remediation"
              ]
            }
          },
          "position": {
            "x": 3,
            "y": 58,
            "width": 3,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "7be46055",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('PREDICTIVE_OPTIMIZATION')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "DBU Usage for Predictive Optimization(1)"
              },
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "sum(dbu_usage_total)",
                  "displayName": "Sum of count"
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 59,
            "width": 3,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "bb62efc9",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "sum(dbu_usage_total)",
                      "expression": "SUM(`dbu_usage_total`)"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('DATA_QUALITY_MONITORING')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "DBU Usage for DQ Monitoring(1)"
              },
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "sum(dbu_usage_total)",
                  "displayName": "Sum of count"
                }
              }
            }
          },
          "position": {
            "x": 3,
            "y": 59,
            "width": 3,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "0c2cf19d",
            "multilineTextboxSpec": {
              "lines": [
                "### PE-03-02 Take pre-warming of resources into account"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 61,
            "width": 6,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "78c83409",
            "multilineTextboxSpec": {
              "lines": [
                "1. Pools can significantly improve performance by reducing wait time before a job executes\n",
                "2. Clusters running on pools are great candidates for serverless jobs/notebooks to eliminate the cost of pre warmed VMs without giving up TCO benefits"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 62,
            "width": 6,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "e77b7d16",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "count(unique_id)",
                      "expression": "COUNT(`unique_id`)"
                    },
                    {
                      "name": "instance_pool_present",
                      "expression": "`instance_pool_present`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('JOBS', 'SDP')"
                    },
                    {
                      "expression": "`classic_or_serverless` IN ('CLASSIC')"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "Jobs and SDP with and without Pools(1)"
              },
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "count(unique_id)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Jobs and SDP count"
                },
                "color": {
                  "fieldName": "instance_pool_present",
                  "displayName": "Using Instance Pools",
                  "scale": {
                    "type": "categorical"
                  }
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 63,
            "width": 2,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "dea3d7dd",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "1327fa8d",
                  "fields": [
                    {
                      "name": "unique_id",
                      "expression": "`unique_id`"
                    },
                    {
                      "name": "dbu_usage_total",
                      "expression": "`dbu_usage_total`"
                    },
                    {
                      "name": "instance_pool_id",
                      "expression": "`instance_pool_id`"
                    }
                  ],
                  "filters": [
                    {
                      "expression": "`billing_origin_product` IN ('JOBS', 'SDP')"
                    },
                    {
                      "expression": "`classic_or_serverless` IN ('CLASSIC')"
                    },
                    {
                      "expression": "`instance_pool_present` IN ('YES')"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "frame": {
                "showTitle": true,
                "title": "Jobs and SDP workflows using Pools(1)"
              },
              "rowsPerPage": 25,
              "displayRowNumbers": false,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "unique_id",
                    "useForSearch": false,
                    "displayName": "Job/SDP ID",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "dbu_usage_total",
                    "useForSearch": false,
                    "format": {
                      "type": "numeral.js",
                      "format": "0,0.00"
                    },
                    "displayName": "DBU",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  },
                  {
                    "fieldName": "instance_pool_id",
                    "useForSearch": false,
                    "displayName": "Pool ID",
                    "actions": {
                      "hover": {
                        "type": "tooltip",
                        "tooltipTemplate": "{{ @ }}"
                      }
                    }
                  }
                ]
              }
            }
          },
          "position": {
            "x": 2,
            "y": 63,
            "width": 4,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "2d85d5c1",
            "multilineTextboxSpec": {
              "lines": [
                "### PE-03-03 Identify bottlenecks. See [best practices](https://docs.databricks.com/gcp/en/data-engineering/observability-best-practices)."
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 67,
            "width": 6,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "0a42b5c9",
            "multilineTextboxSpec": {
              "lines": [
                "### PE-04-01 Monitor query performanance. See [query profile](https://docs.databricks.com/aws/en/sql/user/queries/query-profile), [DB SQL Advisor](https://medium.com/dbsql-sme-engineering/the-new-databricks-sql-warehouse-advisor-dashboard-a89771bbee3e)"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 68,
            "width": 6,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "5aef4ef3",
            "multilineTextboxSpec": {
              "lines": [
                "### PE-04-02 Monitor streaming workloads. See [best practices](https://docs.databricks.com/aws/en/data-engineering/best-practices)."
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 69,
            "width": 6,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "a37693e1",
            "multilineTextboxSpec": {
              "lines": [
                "### PE-04-03 Monitor job performance. See [monitoring and observability](https://docs.databricks.com/aws/en/jobs/monitor) for Lakeflow Jobs."
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 70,
            "width": 6,
            "height": 1
          }
        }
      ],
      "pageType": "PAGE_TYPE_CANVAS"
    },
    {
      "name": "3be344ef",
      "displayName": "Reliability",
      "layout": [
        {
          "widget": {
            "name": "e9309306",
            "multilineTextboxSpec": {
              "lines": [
                "# Reliability"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "530fa633",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "60cfe928",
                  "fields": [
                    {
                      "name": "waf_id",
                      "expression": "`waf_id`"
                    },
                    {
                      "name": "principle",
                      "expression": "`principle`"
                    },
                    {
                      "name": "best_practice",
                      "expression": "`best_practice`"
                    },
                    {
                      "name": "score_percentage",
                      "expression": "`score_percentage`"
                    },
                    {
                      "name": "threshold_percentage",
                      "expression": "`threshold_percentage`"
                    },
                    {
                      "name": "threshold_met",
                      "expression": "`threshold_met`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 1,
              "invisibleColumns": [
                {
                  "booleanValues": [
                    "false",
                    "true"
                  ],
                  "imageUrlTemplate": "{{ @ }}",
                  "imageTitleTemplate": "{{ @ }}",
                  "imageWidth": "",
                  "imageHeight": "",
                  "linkUrlTemplate": "{{ @ }}",
                  "linkTextTemplate": "{{ @ }}",
                  "linkTitleTemplate": "{{ @ }}",
                  "linkOpenInNewTab": true,
                  "name": "implemented",
                  "type": "string",
                  "displayAs": "string",
                  "order": 100006,
                  "title": "implemented",
                  "allowSearch": false,
                  "alignContent": "left",
                  "allowHTML": false,
                  "highlightLinks": false,
                  "useMonospaceFont": false,
                  "preserveWhitespace": false
                }
              ],
              "allowHTMLByDefault": false,
              "itemsPerPage": 25,
              "paginationSize": "default",
              "condensed": true,
              "withRowNumber": false,
              "frame": {
                "title": "WAF Controls Table",
                "showTitle": true
              },
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "waf_id",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100000,
                    "title": "waf_id",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "principle",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100001,
                    "title": "principle",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "best_practice",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100002,
                    "title": "best_practice",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "score_percentage",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "decimal",
                    "displayAs": "number",
                    "visible": true,
                    "order": 100003,
                    "title": "score_percentage",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "threshold_percentage",
                    "numberFormat": "0",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "integer",
                    "displayAs": "number",
                    "visible": true,
                    "order": 100004,
                    "title": "threshold_percentage",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  },
                  {
                    "fieldName": "threshold_met",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100005,
                    "title": "Threshold Met",
                    "allowSearch": false,
                    "alignContent": "center",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false
                  }
                ]
              }
            }
          },
          "position": {
            "x": 0,
            "y": 10,
            "width": 6,
            "height": 8
          }
        },
        {
          "widget": {
            "name": "4c6080fc",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "011cf80a",
                  "fields": [
                    {
                      "name": "sum(completion_percent)",
                      "expression": "SUM(`completion_percent`)"
                    },
                    {
                      "name": "principle",
                      "expression": "`principle`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "bar",
              "encodings": {
                "x": {
                  "fieldName": "sum(completion_percent)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Sum of completion_percent"
                },
                "y": {
                  "fieldName": "principle",
                  "scale": {
                    "type": "categorical",
                    "sort": {
                      "by": "x-reversed"
                    }
                  },
                  "displayName": "principle"
                }
              },
              "frame": {
                "title": "Completion percentage of implemented controls per principle",
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 4,
            "width": 6,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "f05f948d",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "03babf4f",
                  "fields": [
                    {
                      "name": "avg(completion_percent)",
                      "expression": "AVG(`completion_percent`)"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "avg(completion_percent)",
                  "displayName": "Average completion_percent"
                }
              },
              "frame": {
                "title": "Completion Percentage",
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 0,
            "y": 2,
            "width": 6,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "7736691f",
            "multilineTextboxSpec": {
              "lines": [
                "### Principle"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 18,
            "width": 1,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "912b9d1e",
            "multilineTextboxSpec": {
              "lines": [
                "### Signal"
              ]
            }
          },
          "position": {
            "x": 1,
            "y": 18,
            "width": 5,
            "height": 1
          }
        },
        {
          "widget": {
            "name": "40470a83",
            "multilineTextboxSpec": {
              "lines": [
                "#### R-01-01\n",
                "&nbsp;\n",
                "\n",
                "**Use a data format that supports ACID transactions ([Delta Lake](https://docs.databricks.com/aws/en/delta/))**\n",
                "\n",
                "1. What file formats do you use and why? If not using Delta, what prevents you from defaulting to Delta Lake?\n",
                "\n",
                "2. What clients/connectors do you use and do they support Delta Lake?"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 19,
            "width": 1,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "11a1aa40",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "a5da7a83",
                  "fields": [
                    {
                      "name": "sum(no_of_tables)",
                      "expression": "SUM(`no_of_tables`)"
                    },
                    {
                      "name": "tables_format",
                      "expression": "`tables_format`"
                    }
                  ],
                  "disaggregated": false
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "sum(no_of_tables)",
                  "scale": {
                    "type": "quantitative"
                  },
                  "axis": {
                    "title": "Table Formats"
                  },
                  "displayName": "Table Formats"
                },
                "color": {
                  "fieldName": "tables_format",
                  "scale": {
                    "type": "categorical"
                  },
                  "displayName": "tables_format"
                },
                "label": {
                  "show": true
                }
              },
              "frame": {
                "title": "Distribution",
                "showTitle": true
              }
            }
          },
          "position": {
            "x": 1,
            "y": 19,
            "width": 5,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "c8ff09f3",
            "multilineTextboxSpec": {
              "lines": [
                "#### R-03-02\n",
                "&nbsp;\n",
                "\n",
                "**Use autoscaling for SQL Warehouses**"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 43,
            "width": 1,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "75b3a2e8",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "db7bc0c3",
                  "fields": [
                    {
                      "name": "workspace_id",
                      "expression": "`workspace_id`"
                    },
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "owned_by",
                      "expression": "`owned_by`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 1,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "workspace_id",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100000,
                    "title": "workspace_id",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "workspace_id"
                  },
                  {
                    "fieldName": "cluster_id",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100001,
                    "title": "cluster_id",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100002,
                    "title": "cluster_name",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "cluster_name"
                  },
                  {
                    "fieldName": "owned_by",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100003,
                    "title": "owned_by",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "owned_by"
                  }
                ]
              },
              "invisibleColumns": [],
              "allowHTMLByDefault": false,
              "itemsPerPage": 25,
              "paginationSize": "default",
              "condensed": true,
              "withRowNumber": false,
              "frame": {
                "showTitle": true,
                "title": "All purpose cluster which do not have auto-termination configured"
              }
            }
          },
          "position": {
            "x": 1,
            "y": 25,
            "width": 5,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "1df808a3",
            "multilineTextboxSpec": {
              "lines": [
                "#### R-03-01\n",
                "&nbsp;\n",
                "\n",
                "**Enable autoscaling for ETL workloads**"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 37,
            "width": 1,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "a90d04b7",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "27265888",
                  "fields": [
                    {
                      "name": "warehouse_id",
                      "expression": "`warehouse_id`"
                    },
                    {
                      "name": "warehouse_name",
                      "expression": "`warehouse_name`"
                    },
                    {
                      "name": "warehouse_type",
                      "expression": "`warehouse_type`"
                    },
                    {
                      "name": "warehouse_size",
                      "expression": "`warehouse_size`"
                    },
                    {
                      "name": "min_clusters",
                      "expression": "`min_clusters`"
                    },
                    {
                      "name": "max_clusters",
                      "expression": "`max_clusters`"
                    },
                    {
                      "name": "auto_stop_minutes",
                      "expression": "`auto_stop_minutes`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 1,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "warehouse_id",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100000,
                    "title": "warehouse_id",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "warehouse_id"
                  },
                  {
                    "fieldName": "warehouse_name",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100001,
                    "title": "warehouse_name",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "warehouse_name"
                  },
                  {
                    "fieldName": "warehouse_type",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100002,
                    "title": "warehouse_type",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "warehouse_type"
                  },
                  {
                    "fieldName": "warehouse_size",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100003,
                    "title": "warehouse_size",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "warehouse_size"
                  },
                  {
                    "fieldName": "min_clusters",
                    "numberFormat": "0",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "integer",
                    "displayAs": "number",
                    "visible": true,
                    "order": 100004,
                    "title": "min_clusters",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "min_clusters"
                  },
                  {
                    "fieldName": "max_clusters",
                    "numberFormat": "0",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "integer",
                    "displayAs": "number",
                    "visible": true,
                    "order": 100005,
                    "title": "max_clusters",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "max_clusters"
                  },
                  {
                    "fieldName": "auto_stop_minutes",
                    "numberFormat": "0",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "integer",
                    "displayAs": "number",
                    "visible": true,
                    "order": 100006,
                    "title": "auto_stop_minutes",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "auto_stop_minutes"
                  }
                ]
              },
              "invisibleColumns": [],
              "allowHTMLByDefault": false,
              "itemsPerPage": 25,
              "paginationSize": "default",
              "condensed": true,
              "withRowNumber": false,
              "frame": {
                "showTitle": true,
                "title": "These warehouses do not have autoscaling configured"
              }
            }
          },
          "position": {
            "x": 1,
            "y": 31,
            "width": 5,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "f87d77aa",
            "multilineTextboxSpec": {
              "lines": [
                "#### R-01-04\n",
                "&nbsp;\n",
                "\n",
                "**Configure jobs for automatic retries and termination**"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 25,
            "width": 1,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "74d18572",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "95b08392",
                  "fields": [
                    {
                      "name": "workspace_id",
                      "expression": "`workspace_id`"
                    },
                    {
                      "name": "cluster_id",
                      "expression": "`cluster_id`"
                    },
                    {
                      "name": "cluster_name",
                      "expression": "`cluster_name`"
                    },
                    {
                      "name": "owned_by",
                      "expression": "`owned_by`"
                    },
                    {
                      "name": "worker_count",
                      "expression": "`worker_count`"
                    },
                    {
                      "name": "create_time",
                      "expression": "`create_time`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 1,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "workspace_id",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100000,
                    "title": "workspace_id",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "workspace_id"
                  },
                  {
                    "fieldName": "cluster_id",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100001,
                    "title": "cluster_id",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "cluster_id"
                  },
                  {
                    "fieldName": "cluster_name",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100002,
                    "title": "cluster_name",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "cluster_name"
                  },
                  {
                    "fieldName": "owned_by",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100003,
                    "title": "owned_by",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "owned_by"
                  },
                  {
                    "fieldName": "worker_count",
                    "numberFormat": "0",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "integer",
                    "displayAs": "number",
                    "visible": true,
                    "order": 100004,
                    "title": "worker_count",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "worker_count"
                  },
                  {
                    "fieldName": "create_time",
                    "dateTimeFormat": "DD/MM/YYYY HH:mm:ss.SSS",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "datetime",
                    "displayAs": "datetime",
                    "visible": true,
                    "order": 100005,
                    "title": "create_time",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "create_time"
                  }
                ]
              },
              "invisibleColumns": [],
              "allowHTMLByDefault": false,
              "itemsPerPage": 25,
              "paginationSize": "default",
              "condensed": true,
              "withRowNumber": false,
              "frame": {
                "showTitle": true,
                "title": "Job runs from past 7 days which do not have autoscaling configured"
              }
            }
          },
          "position": {
            "x": 1,
            "y": 31,
            "width": 5,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "261db1e1",
            "multilineTextboxSpec": {
              "lines": [
                "#### R-01-05\n",
                "&nbsp;\n",
                "\n",
                "**Use a scalable and production-grade model serving infrastructure**"
              ]
            }
          },
          "position": {
            "x": 0,
            "y": 31,
            "width": 1,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "f5746bba",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ea93f04e",
                  "fields": [
                    {
                      "name": "endpoint_name",
                      "expression": "`endpoint_name`"
                    },
                    {
                      "name": "billing_origin_product",
                      "expression": "`billing_origin_product`"
                    },
                    {
                      "name": "usage_dbus",
                      "expression": "`usage_dbus`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 1,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "endpoint_name",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100000,
                    "title": "endpoint_name",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "endpoint_name"
                  },
                  {
                    "fieldName": "billing_origin_product",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "string",
                    "displayAs": "string",
                    "visible": true,
                    "order": 100001,
                    "title": "billing_origin_product",
                    "allowSearch": false,
                    "alignContent": "left",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "billing_origin_product"
                  },
                  {
                    "fieldName": "usage_dbus",
                    "booleanValues": [
                      "false",
                      "true"
                    ],
                    "imageUrlTemplate": "{{ @ }}",
                    "imageTitleTemplate": "{{ @ }}",
                    "imageWidth": "",
                    "imageHeight": "",
                    "linkUrlTemplate": "{{ @ }}",
                    "linkTextTemplate": "{{ @ }}",
                    "linkTitleTemplate": "{{ @ }}",
                    "linkOpenInNewTab": true,
                    "type": "decimal",
                    "displayAs": "number",
                    "visible": true,
                    "order": 100002,
                    "title": "usage_dbus",
                    "allowSearch": false,
                    "alignContent": "right",
                    "allowHTML": false,
                    "highlightLinks": false,
                    "useMonospaceFont": false,
                    "preserveWhitespace": false,
                    "displayName": "usage_dbus"
                  }
                ]
              },
              "invisibleColumns": [],
              "allowHTMLByDefault": false,
              "itemsPerPage": 25,
              "paginationSize": "default",
              "condensed": true,
              "withRowNumber": false,
              "frame": {
                "showTitle": true,
                "title": "Model Serving DBU usage the last 7 days"
              }
            }
          },
          "position": {
            "x": 1,
            "y": 31,
            "width": 5,
            "height": 6
          }
        }
      ],
      "pageType": "PAGE_TYPE_CANVAS"
    }
  ],
  "uiSettings": {
    "theme": {
      "widgetHeaderAlignment": "ALIGNMENT_UNSPECIFIED"
    },
    "applyModeEnabled": false
  }
}
